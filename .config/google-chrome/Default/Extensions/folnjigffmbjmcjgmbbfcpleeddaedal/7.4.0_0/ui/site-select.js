$(document).on("ui",function(f,b){var h=b.sites.sort(function(j,i){return j.name.toLowerCase()<i.name.toLowerCase()?-1:(j.name.toLowerCase()>i.name.toLowerCase()?1:0)});var g=b.target;var e=$("<table cellspacing='0' cellpadding='0'>").append($.map(h,function(k){var j=[{text:translate._("Login"),icon:"far fa-sign-in-alt",click:function(){$.logmeonce.fireEvent("loginSite",{id:k.id,sso:true});c.dialog("option","hide",null).dialog("close")}},{text:translate._("Fill out"),icon:"far fa-arrow-alt-down",allowed:k.inputs.length>0,click:function(){$.logmeonce.fireEvent("loginSite",{id:k.id,sso:false});c.dialog("option","hide",null).dialog("close")}},{text:translate._("View Note"),icon:"far fa-sticky-note",disabled:k.note==null,click:function(l){$(this).notesdialog({title:k.name,note:k.note},c)}}];if(g!=null){var i=$.grep(k.inputs||[],function(l){if(l.label==null&&l.flags&2&&g.type!=="password"){l.label=translate._("Username");l.action="username";return true}if(l.label==null&&l.flags&4&&g.type==="password"){l.label=translate._("Password");l.action="password";return true}if(l.label==null&&l.flags&32){l.label=translate._("Totp code");l.action="totp";return true}return false});i.length>0&&j.splice.apply(j,[2,0].concat($.map(i,function(l){var m=l.label!=null&&l.label.length>0?l.label:(l.name!=null&&l.name.length>0?l.name:"("+translate._("Empty").toLowerCase()+")");return{text:translate._("Fill")+" "+m,icon:"far fa-arrow-alt-down",click:function(n){$.ui.logmeonce.message({ui:"target",target:g.ui,name:"login",site:k.id,action:l.action});c.dialog("option","hide",null).dialog("close")}}})))}return $("<tr class='searchable'>").append($("<td>").append($("<div class='icon'>").append(k.icon!=null?$("<img>").attr("src",k.icon):"")),$("<td>").text(k.name),$("<td align='center'>").append($("<a class='more'>").attr("title",translate._("More")).append($("<i class='far fa-ellipsis-h'>")))).sitecontext({site:k,user:b.user,deleted:function(){$("[site="+k.id+"]",c).remove();$("[site]",c).length<=0&&c.dialog("close")},items:j}).attr("site",k.id).attr("title",k.name).data("site",k)})).append($("<tr>").append($("<td>"),$("<td id='cancel' colspan='2'>").text(translate._("Do not login")+" ")));if(h.length>=8){e=e.before($("<div class='search-panel'>").append($("<div class='search'>").append($("<button>").attr("title",translate._("Click to search")).append($("<i class='far fa-search'>")),$("<input type='text' name='search'>").attr("placeholder",translate._("Search here")))))}if(h.length<=0){e=$("<div class='empty'>").text(translate._("No sites found"))}if($("#ui-select").length>0){$("#ui-select").dialog("destroy").remove();window.lmoDialogs--}var d,a;var c=$("<div id='ui-select' class='select-dialog'>").append(e).dialog({title:b.action==="totp"?translate._("Totp code"):translate._("Login as"),target:g,width:g!=null?300:400,minHeight:0,minWidth:300,maxWidth:600,resizable:false,modal:true,autoOpen:g==null,icons:["password-generate","autofill-profile","autofill-cards"],open:function(){if(g==null){var i=this;d=0;a=setInterval(function(){if(++d>30){if($("#idle",i).length<=0){$("#cancel",i).append("<span id='idle' class='info'></div>")}if(d>=60){clearInterval(a);$(c).dialog("close")}$("#idle",i).html("("+translate.sprintf("Closing in %s",translate.duration(60-d))+")")}},1000);$(document).on("mousemove",function(){d=0;$("#idle",i).remove()})}$("img",this).on("error",function(){$(this).hide()});$(this).css({height:"auto",minHeight:"auto"}).on("click","[site]",function(){if(g!=null){$.ui.logmeonce.message({ui:"target",target:g.ui,name:"login",site:$(this).attr("site"),action:b.action})}if(b.action!="totp"){$.logmeonce.fireEvent("loginSite",{id:$(this).attr("site"),force:true})}$(c).dialog("option","hide",null).dialog("close")}).on("click","#cancel",function(j){$(c).dialog("option","hide",null).dialog("close")}).on("click","a.more",function(j){j.preventDefault();j.stopPropagation();$(this).closest(".contextmenu").trigger({type:"contextmenu",position:{my:"right top",at:"right bottom",of:this}})})}}).on("search",function(j){var i=$(".search-panel input",this).val().toLowerCase().trim();$(".searchable",this).each(function(){$(this).toggle(i.length<=0||$(this).text().toLowerCase().indexOf(i)>=0||$(this).data("site").username.toLowerCase().indexOf(i)>=0)})}).on("click",".search-panel button",function(){$(this).closest(".select-dialog").triggerHandler("search")}).on("keyup",".search-panel input",function(){$(this).debounce(200,function(){$(this).closest(".select-dialog").triggerHandler("search")})});if(g!=null){$(c).dialog("widget").css("visibility","hidden");$(c).dialog("open");$(c).dialog("widget").css("visibility","visible")}});