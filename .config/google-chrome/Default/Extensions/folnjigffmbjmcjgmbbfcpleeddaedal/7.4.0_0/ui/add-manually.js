$(document).on("ui",function(f,d){var c=d.form!=null?d.form:{manual:"username",flags:0,inputs:[]};var e=false;var b=$("<div class='manual'>").on("username-render",function(){$.logmeonce.fireEvent("loadPasswordManager",$.extend(c,{manual:"username"}));$(this).empty().append($("<h4>").text(translate._("Welcome")),$("<div>").text(translate._("Add manually username step")),$("<p>").append($("<div>").append($("<i class='far fa-spinner fa-spin'>"),$("<span>").text(translate._("Waiting for username")+"..."))));$(this).siblings(".ui-dialog-buttonpane").find("button:last-child").addClass("ui-state-disabled").children("span").text(translate._("Next"));$(this).siblings(".ui-dialog-buttonpane").find("a").hide();var g=$.grep(c.inputs,function(h){return h.flags&2}).shift();g!=null&&$(this).trigger("username-event",g,c.url);$.ui.logmeonce.resize.call(this)}).on("username-event",function(j,i,g){if(i.type==null||$.inArray(i.type,["button","submit","image","password"])>=0){return}var k=$.extend(i,{flags:2|1});var h=$.grep(c.inputs,function(l){return l.flags&2}).shift();h==null&&c.inputs.push(k);h!=null&&$.extend(h,k);$("p",this).empty().append($("<div class='color-success'>").append($("<i class='far fa-check-circle'>"),$("<span>").text(translate._("Username field detected"))),k.value.length>0?$("<div class='color-success'>").append($("<i class='far fa-check-circle'>"),$("<b>").text(k.value)):$("<div>").append($("<i class='far fa-spinner fa-spin'>"),$("<span>").text(translate._("Enter your username"))));$(this).siblings(".ui-dialog-buttonpane").find("button:last-child").toggleClass("ui-state-disabled",k.value.length<=0);$.ui.logmeonce.resize.call(this);$.logmeonce.fireEvent("loadPasswordManager",$.extend(c,{url:g}))}).on("password-render",function(){$.logmeonce.fireEvent("loadPasswordManager",$.extend(c,{manual:"password"}));$(this).empty().append($("<h4>").text(translate._("Password")),$("<div>").text(translate._("Add manually password step")),$("<p>").append($("<div>").append($("<i class='far fa-spinner fa-spin'>"),$("<span>").text(translate._("Waiting for password")+"..."))));$(this).siblings(".ui-dialog-buttonpane").find("button:last-child").addClass("ui-state-disabled").children("span").text(translate._("Next"));$(this).siblings(".ui-dialog-buttonpane").find("a").hide();var g=$.grep(c.inputs,function(h){return h.flags&4}).shift();g!=null&&$(this).trigger("password-event",g,c.url);$.ui.logmeonce.resize.call(this)}).on("password-event",function(k,j,h){if(j.type==null||j.type!=="password"){return}var g=$.extend(j,{flags:4|1});var i=$.grep(c.inputs,function(l){return l.flags&4}).shift();i==null&&c.inputs.push(g);i!=null&&$.extend(i,g);$("p",this).empty().append($("<div class='color-success'>").append($("<i class='far fa-check-circle'>"),$("<span>").text(translate._("Password field detected"))),g.value.length>0?$("<div class='color-success'>").append($("<i class='far fa-check-circle'>"),$("<b>").text(g.value.replace(/./gi,"*"))):$("<div>").append($("<i class='far fa-spinner fa-spin'>"),$("<span>").text(translate._("Enter your password"))));$(this).siblings(".ui-dialog-buttonpane").find("button:last-child").toggleClass("ui-state-disabled",g.value.length<=0);$.ui.logmeonce.resize.call(this);$.logmeonce.fireEvent("loadPasswordManager",$.extend(c,{flags:c.url!=h?c.flags|256:c.flags}))}).on("remember-render",function(i,h){var j=$.grep(c.inputs,function(k){return k.flags&2}).shift();var g=logmeonce.tools.parseHost(c.url);$.logmeonce.fireEvent("loadPasswordManager",$.extend(c,{manual:"remember"}));$(this).empty().append($("<table>").append($("<tr>").append($("<td>").append($("<div class='image-key'>")),$("<td>").append($("<span class='message'>").text(translate.sprintf(translate.sprintf(translate._("Remember Password for %s on %s?"),j.value,g)))))),$("<table align='center'>").append($("<tr>").append($("<td>").append($("<span class='info'>").text(translate._("Groups")+":")),$("<td>").append($("<select name='group'>").append($.map(d.groups,function(k){return $("<option>").attr("value",k.id).prop("selected",!!k.selected).text(k.path||k.name)}))))));$(this).siblings(".ui-dialog-buttonpane").find("button:last-child").removeClass("ui-state-disabled").children("span").text(translate._("Remember"));$(this).siblings(".ui-dialog-buttonpane").find("a").show();$.ui.logmeonce.resize.call(this)}).on("fields-render",function(h,g){$.logmeonce.fireEvent("loadPasswordManager",$.extend(c,{manual:"fields"}));$(this).empty().append($("<h4>").text(translate._("More fields")),$("<div>").text(translate._("Add manually fields step")),$("<table class='fields'>"));$(this).trigger("fields-render-list");$(this).siblings(".ui-dialog-buttonpane").find("button:last-child").removeClass("ui-state-disabled").children("span").text(translate._("Next"));$(this).siblings(".ui-dialog-buttonpane").find("a").hide();$.ui.logmeonce.resize.call(this)}).on("fields-render-list",function(g){$("table",this).empty().append($.map(c.inputs,function(h){var i=h.name!=null?h.name:h.type;var j=h.value!=null?(h.type=="password"?h.value.replace(/./gi,"*"):h.value):"";if(h.flags&2){i=translate._("Username")}if(h.flags&4){i=translate._("Password")}return $("<tr>").append($("<td>").text(i),$("<td>").text(j),$("<td>").append($("<a>").text(translate._("Remove").toLowerCase()).on("click",function(){if(h.flags&1&&!confirm(translate._("Remove Confirmation"))){return}$(this).closest("tr").remove();var k=c.inputs.indexOf(h);c.inputs.splice(k,1);if(h.flags&2){b.trigger("username-render")}else{if(h.flags&4){b.trigger("password-render")}else{$.logmeonce.fireEvent("loadPasswordManager",c)}}}))).data("input",h)}))}).on("fields-event",function(j,i){if(i.name==null){return}var g=this;var h=false;$("table tr",this).each(function(l,m){var k=$(m).data("input");if(k.name==i.name){k.value=i.value;$("td:eq(1)",m).text(i.value!=null?(i.type=="password"?i.value.replace(/./gi,"*"):i.value):"");$.logmeonce.fireEvent("loadPasswordManager",c);$.ui.logmeonce.resize.call(g);h=true}});if(!h&&typeof i.type==="string"&&$.inArray(i.type,["button","submit","image"])<0){c.inputs.push(i);$(this).trigger("fields-render-list");$.logmeonce.fireEvent("loadPasswordManager",c);$.ui.logmeonce.resize.call(this)}}).dialog({title:translate._("Add Site Manually"),width:"400px",height:"auto",minHeight:"auto",draggable:true,resizable:false,show:d.form!=null?"none":"slide",autoOpen:false,buttons:[{text:translate._("Cancel"),click:function(h){var g=$(h.target).is(".ui-button-text")?$(h.target).parent():$(h.target);if(g.is(".ui-state-disabled")){return}$.logmeonce.fireEvent("savePasswordManager",{ui:"skip"});$(this).dialog("close")}},{text:translate._("Next"),click:function(h){var g=$(h.target).is(".ui-button-text")?$(h.target).parent():$(h.target);if(g.is(".ui-state-disabled")){return}if(c.manual==="username"){b.trigger("password-render")}else{if(c.manual==="password"||c.manual=="fields"){b.trigger("remember-render")}else{if(c.manual==="remember"){$(this).siblings(".ui-dialog-buttonpane").find("button").addClass("ui-state-disabled");$.logmeonce.fireEvent("savePasswordManager",{ui:"save",group:$("select[name=group]",this).length>0?$("select[name=group]",this).val():null});$(this).dialog("close")}}}}}],open:function(){$(this).siblings(".ui-dialog-buttonpane").children(".ui-dialog-buttonset").prepend($("<a class='more'>").on("click",function(){b.trigger("fields-render")}).text(translate._("More fields")+"?").css({color:"#9697a7"}).toggle(c.manual==="remember"))}});b.trigger(c.manual+"-render");b.dialog("open");function a(g){if((g.type=="lmoClick"&&$.inArray(g.target.type,["button","submit","image"])>=0)||(g.type=="lmoSubmit")){e=true}if(g.type=="lmoContentLoaded"&&e&&!(c.flags&256)){$.logmeonce.fireEvent("loadPasswordManager",$.extend(c,{flags:c.flags|256}))}if(g.type=="lmoFocus"&&g.target.type=="password"&&c.manual=="username"&&$.grep(c.inputs,function(h){return h.flags&2&&h.value.length>0}).length>0){b.trigger("password-render")}b.trigger(c.manual+"-event",[g.target,g.url])}window.addEventListener("message",function(g){if(g.data.type==="uiEvent"&&$.inArray(g.data.detail.type,["lmoFocus","lmoClick","lmoKeyup","lmoContentLoaded","lmoSubmit"])>=0){a(g.data.detail)}},false)});