(function(f){var b=4;var h=function(k){var j=Array.prototype.slice.call(k);return $.each(j,function(m,n){if(n instanceof HTMLDocument){var l=$.extend({},n.location);j[m]={document:"contentscript",location:$.each(l,function(o,p){typeof p==="function"&&delete l[o]}),tab:g.tab}}})};var g={connected:false,tab:{id:0},offset:0,top:0,left:0,frame:window==window.top?0:Math.floor(Math.random()*65535),events:[],};var a={supported:{},deferral:{},instance:null,deferred:function(j,k){return function(){var l=Math.floor(Math.random()*65535);a.deferral[l]=$.Deferred();a.message({call:j,args:h(arguments),callback:l},k);return a.deferral[l]}},override:function(k,j){var l=f[k];return function(){a.message({call:k,args:h(arguments)});return j===true?l.apply(this,arguments):false}},message:function(l,j){if(typeof j=="number"){return setTimeout(a.message,j,l)}try{a.instance.postMessage(l)}catch(k){if(k.code==DOMException.DATA_CLONE_ERR){a.instance.postMessage(JSON.stringify(l))}else{f.log("Background message error: "+k)}}}};function i(j){if(!g.connected){g.events.push(function(){i(j)});return}try{f.onEvent(j.target,j.detail)}catch(j){f.log(j)}}function e(j){try{f.formSubmited(j.target)}catch(j){f.log(j)}}function c(j){if(j.target instanceof HTMLDocument){if(!g.connected){g.events.push(function(){c(j)});return}try{if(document.location.href==f.server+"newtab"){if(f.config.user!=null){document.body.style.opacity=0;$("<iframe name='ui-logmeonce-newtab' frameBorder='0'>").attr("src",f.includeUrl("/html/newtab.html")).css({width:"100%",height:"100%"}).appendTo(document.body)}else{window.location=f.server+"login"}}else{document.defaultViewEdgeFix=window;f.contentLoaded(document,g.tab)}}catch(j){f.log("onContentLoaded: "+j)}}}if(typeof bridgeLog!=="undefined"){bridgeLog.VerboseLogging=false}f.browser.incognito=chrome.extension.inIncognitoContext;f.browser.history=function(j){var k=Math.floor(Math.random()*65535);a.deferral[k]=$.Deferred();a.message({history:j,callback:k});return a.deferral[k]};f.window=function(j){return function(k,m){var l=k.defaultView||k.parentWindow;if(m!=null&&m=="close"){l.onbeforeunload=null;a.message({close:"tab"});return l}if(m!=null&&m=="tab"){return g.tab}return j.apply(f,arguments)}}(f.window);f.testing=function(j){return function(){j.apply(this,arguments);if(args.length==3&&args[2]=="start"&&args[1].testing!=null&&args[1].testing.timeout!=null){clearTimeout(args[1].testing.timeout);args[1].testing.timeout=null}a.message({call:"testing",args:h(arguments)})}}(f.testing);f.includeUrl=function(j){return chrome.extension.getURL(j)};f.load=function(j){return function(){j.apply(this,arguments);f.config.get=a.deferred("config.get");f.config.set=function(){a.message({call:"config.set",args:Array.prototype.slice.call(arguments)})};document.lmoContentLoaded=null}}(f.load);f.handleEvent=function(j){return function(k,l){if(k.document=="contentscript"){j.call(this,window.document,l);return}if(typeof l.ui==="string"&&l.ui.indexOf(":")>0&&$.inArray(l.name,["loginSite"])>=0){a.message({call:"handleEvent",args:[{document:"contentscript",origin:l.ui.substring(l.ui.indexOf(":")+1)},l]});return}return j.apply(this,arguments)}}(f.handleEvent);f.passwordManager=function(j){return function(){a.message({call:"passwordManager",args:[j.apply(this,arguments)]})}}(f.passwordManager);f.ajax=function(j){var k=Math.floor(Math.random()*65535);a.deferral[k]=$.Deferred();a.deferral[k].abort=function(){a.deferral[k]=null;a.message({call:"ajax",args:[{abort:k}]})};a.message({call:"ajax",args:[$.extend(j,{abortable:k})],callback:k});return a.deferral[k]};f.loginList=a.override("loginList",true);f.logoutList=a.override("logoutList",true);f.about=a.deferred("about");f.exporting=a.deferred("exporting");f.importing=a.deferred("importing");f.importAdapter=a.deferred("importAdapter");f.readFileDialog=a.deferred("readFileDialog");f.importEvent=a.deferred("importEvent");f.loadDesktopMode=a.deferred("loadDesktopMode");f.domain=a.override("domain");f.push=a.deferred("push");f.sso=a.deferred("sso");f.urlGoto=a.override("urlGoto");f.removeCookies=a.override("removeCookies");f.passwordGenerated=a.override("passwordGenerated");f.reloadWindows=a.override("reloadWindows");f.copyToClipboard=a.override("copyToClipboard");f.loginTesting=a.override("loginTesting");f.enable=function(j,k){};f.disable=a.override("disable");f.savePasswordManager=a.deferred("savePasswordManager");f.notes=a.deferred("notes");f.offline=a.deferred("offline");f.passwordChanger=a.deferred("passwordChanger");f.saveSite=a.deferred("saveSite");f.loadUser=a.deferred("loadUser");f.usb=a.deferred("usb");f.storage=a.deferred("storage");f.loadApp=function(j){return function(k,l){if(typeof l==="object"&&l.contentscript===true){return j.apply(this,arguments)}return a.deferred("loadApp",0).apply(this,arguments)}}(f.loadApp);f.autofillSave=function(j){return a.deferred("autofillSave",0).apply(this,arguments).then(function(k){return f.autofillLoad(j,k)})};f.autofillDelete=function(j){return a.deferred("autofillDelete",0).apply(this,arguments).then(function(k){return f.autofillLoad(j,k)})};f.login=function(j,k){return a.deferred("login",0).apply(this,arguments).then(null,function(n,m){if(m!=null&&m.trigger!=null){var l=$.Deferred();f.loginActions(j,m).then(function(o){l.reject(n,o)});return l.promise()}return $.Deferred().reject(n,m).promise()})};f.contentLoaded=function(j){return function(){j.apply(this,arguments);a.message({call:"contentLoaded",args:h(arguments)})}}(f.contentLoaded);f.loadKey=function(j){return function(k){return a.deferred("loadKey",0).apply(this,arguments).then(function(l){return j.apply(f,[k,l])})}}(f.loadKey);f.site=function(j){return function(l,m,k){if(l=="changepassword"&&k.changepassword.timeout!=null){delete k.changepassword.timeout}j.apply(f,arguments);if(l=="changepassword"&&k.changepassword.timeout!=null){clearTimeout(k.changepassword.timeout);delete k.changepassword.timeout}if(typeof m==="function"){a.message({call:"site",args:[l,true,k]})}}}(f.site);f.sites=function(j){return function(k,l){if(this.config.user!=null&&this.config.user.sites!=null&&l.remove!=null){a.message({call:"sites",args:h(arguments)})}return j.apply(f,arguments)}}(f.sites);f.deleteSite=function(j,k){return a.deferred("deleteSite").apply(this,arguments).then(function(l){f.sites(j,{remove:k.site});return l})};f.log=function(k,j){if(k!=null){a.message({call:"log",args:["CS (Tab:"+g.tab.id+"): "+k]})}else{return a.deferred("log",0).apply(this,arguments)}};f.formSubmit=function(j){return function(){var l=arguments;var k=this.config.user!=null&&!(this.config.user.settings.flags&8192)&&a.supported.passwordSavingEnabled;return k&&!a.passwordSavingToggling?a.deferred("passwordSavingEnable").call(this,"disable").then(function(m){a.passwordSavingToggling=true;return j.apply(f,l)}).then(function(){a.deferred("passwordSavingEnable").call(this,"clear").then(function(){a.passwordSavingToggling=false})}):j.apply(f,l)}}(f.formSubmit);f.formSubmited=function(j){return function(l){var k=this.config.user!=null&&!(this.config.user.settings.flags&8192)&&a.supported.passwordSavingEnabled;var m=$.grep(l.elements,function(n){return n.lmoFilled===true});if(k&&!a.passwordSavingToggling&&m.length>0){a.passwordSavingToggling=true;a.deferred("passwordSavingEnable").call(this,"toggle").then(function(){a.passwordSavingToggling=false})}return j.apply(f,arguments)}}(f.formSubmited);f.dispatchUiTargets=[];f.dispatchUiEvent=function(j){return function(p,m,o,n){if(f.dispatchUiListeners>0&&typeof p=="object"&&p.dispatch===true){j.apply(this,arguments)}else{if(f.dispatchUiListeners>0){var l=j.call(this,p,m,o,"detail");if(typeof l.target.left==="number"&&typeof l.target.top==="number"){var k=l.target.top+l.target.height;l.target.left+=g.left;l.target.top+=g.top;if(g.frame!=0&&g.offset+k<0){l.target.top-=g.offset+k}}chrome.runtime.sendMessage({type:m,uiEvent:l})}}}}(f.dispatchUiEvent);f.injectAutofillCardsUi=function(j){return function(){var m=this;var l=arguments;var k=this.config.user!=null&&!(this.config.user.settings.flags&16384)&&a.supported.autofillCreditCardEnabled;return k?a.deferred("autofillCreditCardEnabled").call(this,"disable").then(function(n){a.deferred("autofillCreditCardEnabled").call(this,"clear");return j.apply(m,l)}):j.apply(m,l)}}(f.injectAutofillCardsUi);f.injectAutofillProfileUi=function(j){return function(){var m=this;var l=arguments;var k=this.config.user!=null&&!(this.config.user.settings.flags&16384)&&a.supported.autofillAddressEnabled;return k?a.deferred("autofillAddressEnabled").call(this,"disable").then(function(n){a.deferred("autofillAddressEnabled").call(this,"clear");return j.apply(m,l)}):j.apply(m,l)}}(f.injectAutofillProfileUi);f.injectUi=function(j){return function(k,l){if(window!=window.top){if(l.top==null||l.top==true||l.target!=null){l.frame=g.frame;l.target!=null&&$.each(l.args,function(n,m){if(typeof m==="object"&&typeof m.target==="object"){m.target.left+=g.left;m.target.top+=g.top}});a.message({call:"injectUi",args:h(arguments)});return}}else{if(l.name=="newtab"){l.args=[f.includeUrl(f.config.user==null?"/html/login.html":"/html/newtab.html")]}if(k.document=="contentscript"&&k.origin!=null){return j.call(this,window.document,$.extend(l,{id:Math.round(Math.random()*1000000)+":"+k.origin}))}}return j.apply(this,arguments)}}(f.injectUi);f.injectUiEvents.target=function(j){return function(k,m,l){if(l!=null&&l.frame&&l.id.indexOf(":")>0){a.message({call:"injectUiEvents.target",args:[{document:"contentscript",tab:l.tab,frame:l.frame},m,{target:l.target}]})}else{return j.apply(this,arguments)}}}(f.injectUiEvents.target);f.injectUiEvents.open=function(j){return function(k,m,l){if(l!=null&&l.frame){this.getAttribute("ui-listener")!=null&&chrome.runtime.sendMessage({uiEvent:m.ui});this.getAttribute("ui-target")!=null&&chrome.runtime.sendMessage({uiEvent:m.ui,target:this.getAttribute("ui-target")})}else{this.getAttribute("ui-listener")!=null&&chrome.runtime.sendMessage({uiEvent:m.ui});f.dispatchUiListeners=++f.dispatchUiListeners}return j.apply(this,arguments)}}(f.injectUiEvents.open);f.injectUiEvents.close=function(j){return function(k,m,l){if(l!=null&&l.frame){this.getAttribute("ui-listener")!=null&&chrome.runtime.sendMessage({uiEvent:m.ui});this.getAttribute("ui-target")!=null&&chrome.runtime.sendMessage({uiEvent:m.ui,target:this.getAttribute("ui-target")})}else{this.getAttribute("ui-listener")!=null&&chrome.runtime.sendMessage({uiEvent:m.ui});f.dispatchUiListeners=--f.dispatchUiListeners}return j.apply(this,arguments)}}(f.injectUiEvents.close);f.translate.translate=function(j){try{var l=""+j;$.each([" ","%","?","'","&",".","/","-","#","!",":",","],function(m,n){l=l.replace(new RegExp("\\"+n,"g"),"_"+n.charCodeAt(0)+"_")});return chrome.i18n.getMessage(l)}catch(k){return j}};setTimeout(function(){a.instance=chrome.runtime.connect({name:JSON.stringify({frame:g.frame})});a.instance.onMessage.addListener(function(k){try{if(k.load!=null){$.ajax=f.ajax;a.supported=k.load.supported;g.connected=true;g.frame=k.load.frame;g.tab.id=k.load.tab;f.server=k.load.server;f.load(k.load.config,$);g.events.length>0&&setTimeout(function(l){$.each(l,function(m,n){n()})},0,g.events);g.events=[];if(window.location.href.indexOf(chrome.extension.getURL(""))===0&&f.browser.type=="mozilla"){$(document).trigger({type:"extension",logmeonce:f})}}if(k.unload!=null){f.config.user=null;f.config.password=null;f.config.loginList=[];f.config.logoutList=[];f.config.cookieList={}}if(k.call!=null&&typeof f[k.call]=="function"){if(k.args!=null&&k.args.length>0&&k.args[0]!=null&&k.args[0].document=="background"){k.args[0]=document}f[k.call].apply(f,k.args)}if(k.resolve!=null&&typeof a.deferral[k.resolve]=="object"){a.deferral[k.resolve].resolve.apply(this,k.arguments)}if(k.reject!=null&&typeof a.deferral[k.reject]=="object"){a.deferral[k.reject].reject.apply(this,k.arguments)}if(k.notify!=null&&typeof a.deferral[k.notify]=="object"){a.deferral[k.notify].notify.apply(this,k.arguments)}}catch(j){}});a.instance.onDisconnect.addListener(function(){a.instance=null})},0);chrome.runtime.onMessage.addListener(function(q,l,n){try{if(q.confirm!=null){g.frame<=0&&n(confirm(q.confirm));return}if(q.contextmenu!=null){if(f.contextMenu[q.contextmenu].available(document,f.contextMenuTarget)){f.contextMenu[q.contextmenu].click(document,f.contextMenuTarget)}}if(q.frameEvent!=null){if(q.data.ui==="target"){if(q.frameId==g.frame){f.injectUiEvents.target.call(f,document,q.data);n({success:true})}}else{var m=document.querySelector("iframe[name="+q.frameEvent+"]");if(m!=null&&m.getAttribute("ui-id")==q.ui){f.injectUiEvents[q.data.ui].call(m,document,q.data,{frame:q.frameId});n({success:true})}}return}if(q.uiEvent!=null){if(q.uiEvent=="open"){f.dispatchUiListeners=++f.dispatchUiListeners;var p;if(q.target!=null&&(p=document.querySelector("input[lmoName='"+q.target+"']"))!=null){if(p.style.display=="none"){chrome.runtime.sendMessage({uiEvent:"remove",target:q.target})}else{if(f.dispatchUiTargets.indexOf(p)<0){f.dispatchUiTargets.push(p)}}}}else{if(q.uiEvent=="close"){f.dispatchUiListeners=--f.dispatchUiListeners;var p;if(q.target!=null&&(p=document.querySelector("input[lmoName='"+q.target+"']"))!=null){var k;if((k=f.dispatchUiTargets.indexOf(p))>=0){f.dispatchUiTargets.splice(k,1)}}}else{if(q.uiEvent=="remove"&&q.target!=null){f.dispatchUiListeners=--f.dispatchUiListeners;$("iframe[ui-target='"+q.target+"']").remove()}else{f.dispatchUiEvent({ownerDocument:document,dispatch:true},q.type,{},q.uiEvent)}}}}if(q.call!=null&&typeof f[q.call]=="function"){if(q.args!=null&&q.args.length>0&&q.args[0]!=null&&typeof q.args[0].document=="string"&&$.inArray(q.args[0].document,["background","ui"])>=0){q.args[0]=document}var j=f[q.call].apply(f,q.args);if(q.callback!=null&&q.ui!=null){var m=document.querySelector("iframe[ui-id='"+q.ui+"']");if($.inArray(typeof j,["object","function"])>=0&&typeof j.then=="function"&&m!=null){j.then(function(){m.contentWindow.postMessage({resolve:q.callback,arguments:Array.prototype.slice.call(arguments)},"*")},function(){m.contentWindow.postMessage({reject:q.callback,arguments:Array.prototype.slice.call(arguments)},"*")},function(){m.contentWindow.postMessage({notify:q.callback,arguments:Array.prototype.slice.call(arguments)},"*")})}else{if(m!=null){m.contentWindow.postMessage({resolve:q.callback,arguments:[j]},"*")}}}}if(q.call!=null&&q.call=="injectUiEvents.target"){q.args[0]=document;f.injectUiEvents.target.apply(f,q.args)}n({success:true})}catch(o){n({success:false,error:o})}});var d={ctrlLeft:false,ctrl:0,altLeft:false,alt:0};window.addEventListener("DOMContentLoaded",c,false);window.addEventListener("LMOMessageEvent",i,false,true);window.addEventListener("LMOSubmitEvent",e,false,true);window.addEventListener("message",function(j){if(typeof j.data==="object"&&j.data.type==="lmocspos"){g.offset=j.data.offset;g.top=j.data.top;g.left=j.data.left;$.each(f.dispatchUiTargets,function(l,k){k.lmoLeft=0;k.lmoTop=0})}});window.addEventListener("keydown",function(j){if(j.keyCode==17){d.ctrl=new Date().getTime();d.ctrlLeft=true}else{if(j.keyCode==18){d.alt=new Date().getTime();d.altLeft=true;if(d.ctrl>0&&d.alt-d.ctrl<3){d.ctrlLeft=d.altLeft=false}}else{if(j.keyCode==76&&d.ctrlLeft&&d.altLeft){if(f.regex.test(window.location.href,f.regex.server(".*"),"i")){f.log(null,{action:"ui"})}d.ctrlLeft=false;d.altLeft=false}}}});window.addEventListener("keyup",function(j){if(j.keyCode==17){d.ctrl=0;d.ctrlLeft=false}else{if(j.keyCode==18){d.alt=0;d.altLeft=false}}});document.addEventListener("mousedown",function(k){for(var j in f.contextMenu){chrome.runtime.sendMessage({contextmenu:j,enabled:f.contextMenu[j].available(document,k.target)})}f.contextMenuTarget=k.target})})(logmeonce);