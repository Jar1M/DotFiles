(function(h){var o={each:function(e){$.each(this,function(q,p){if(typeof p=="object"){e.call(this,p)}})}};var c=false;var j={text:null,searching:false,promise:null};var d;if(typeof bridgeLog!=="undefined"){bridgeLog.VerboseLogging=false}h.browser.history=function(e){j.text=e.toLowerCase();if(j.searching){return j.promise}j.searching=true;j.promise=$.Deferred();chrome.history.search({text:"",startTime:new Date().getTime()-10*24*60*60*1000,endTime:new Date().getTime(),maxResults:5000},function(p){var i=[];$(p).each(function(q,r){if(r.url.indexOf(j.text)>=0||r.title.indexOf(j.text)>=0){i.push({url:r.url,title:r.title,used:r.visitCount+r.typedCount})}return i.length<500});j.searching=false;j.promise.resolve(i)});return j.promise};h.config.get=function(e){return $.Deferred().resolve(localStorage[e])};h.config.set=function(e,i){if(i!=null){localStorage[e]=i}else{localStorage.removeItem(e)}};h.browser.setIcon=function(e,p){var i="icon";i+=e?"_on":"_off";i+=p?"_load":"";chrome.browserAction.setIcon({path:i+".png"});if(e){chrome.browserAction.setPopup({popup:"html/menu.html"})}else{if($.grep(h.notification.list,function(q){return !q.viewed}).length<=0){chrome.browserAction.setPopup({popup:""})}}};h.browser.setBadge=function(e){chrome.browserAction.setBadgeText({text:e});if(e.length>0&&h.config.user==null){chrome.browserAction.setPopup({popup:"html/menu.html"})}else{if(e.length<=0&&h.config.user==null){chrome.browserAction.setPopup({popup:""})}}};h.confirm=function(e){return function(p,q){if($.inArray(this.browser.type,["mozilla","edge"])>=0&&p!=null&&p.defaultView!=null){return p.defaultView.confirm(q)?$.Deferred().resolve():$.Deferred().reject()}if($.inArray(this.browser.type,["mozilla","edge"])>=0){var i=$.Deferred();chrome.tabs.query({currentWindow:true,active:true},function(r){r.length>0?chrome.tabs.sendMessage(r[0].id,{confirm:q},function(s){i[arguments.length>0&&s?"resolve":"reject"].call(this)}):i.reject()});return i.promise()}return e.apply(this,arguments)}}(h.confirm);h.window=function(e){return function(i,p){if(i.tab!=null){if(p!=null&&p=="close"){chrome.tabs.sendMessage(i.tab.id,{call:"window",args:[{document:"background"},p]});setTimeout(function(q){return function(){chrome.tabs.remove(q)}}(i.tab.id),500)}if(p!=null&&p=="tab"){return i.tab}}return e.apply(h,arguments)}}(h.window);h.closeAllTabsBesideDocument=function(e){chrome.tabs.query({},function(i){i.forEach(function(p){if(p.id!=e.tab.id){h.window({tab:p,document:"background"},"close")}})})};h.testing=function(e){return function(i,q,p){if(h.config.user!=null&&h.config.user.sites!=null){var r=$.grep(h.config.user.sites,function(u,t){return u.id==q.id});if(r.length>0){if(r[0].testing==null&&q.testing!=null){r[0].testing=q.testing}e.call(h,i,r[0],p)}}}}(h.testing);h.includeUrl=function(e){if(e=="about:newtab"){if(h.config.user!=null&&h.config.user.offline===true){return chrome.extension.getURL("/html/newtab.html")}return h.config.user!=null?h.server+"newtab":h.server+"login"}return chrome.extension.getURL(e)};h.about=function(e){return function(i,p){if(i!=null&&i.tab!=null&&i.document=="contentscript"&&p!=null&&p.get==="version"){if(!i.tab.active&&c){chrome.tabs.update(i.tab.id,{active:true,highlighted:true})}c=false}return e.apply(this,arguments)}}(h.about);h.urlGoto=function(e){return function(p,i){p=e.apply(this,arguments);chrome.tabs.query({currentWindow:true},function(q){q.forEach(function(r){if(i!=null&&i.tab!=null?i.tab.id==r.id:r.active){if(i!=null&&i.newtab){chrome.tabs.create({url:p,active:true})}else{if(r.url!=p){chrome.tabs.update(r.id,{url:p})}else{chrome.tabs.reload(r.id)}}}})})}}(h.urlGoto);h.savePasswordManager=function(e){return function(i,p){return e.apply(this,arguments).then(function(q){if(i!=null&&i.client!=null&&i.document=="contentscript"){if(o[i.client]!=null){o[i.client].postMessage({call:"passwordManager",args:[h.config.passwordManager]})}}return q})}}(h.savePasswordManager);h.ssoRefresh=function(e){return function(i,p){if(i!=null&&i.client!=null&&i.document=="contentscript"){if(o[i.client]!=null){o[i.client].postMessage({call:"ssoRefresh",args:[{document:"background"},p]})}}}}(h.ssoRefresh);h.saveSiteTotp=function(e){return function(i,p){return e.apply(this,arguments).then(function(q){chrome.tabs.query({lastFocusedWindow:true,active:true},function(r){chrome.tabs.sendMessage(r[0].id,{call:"loadApp",args:[{document:"background"},{site:q.site,refresh:true,contentscript:true}]})});return q})}}(h.saveSiteTotp);h.loadApp=function(e){return function(i,p){return e.apply(this,arguments).then(function(q){if(i!=null&&i.client!=null&&i.document=="contentscript"&&p.site!=null){if(o[i.client]!=null){o[i.client].postMessage({call:"site",args:[null,true,q]})}}return q})}}(h.loadApp);h.removeCookies=function(e){var i=e.host.toLowerCase();i=i.length>1&&i.indexOf(".")<=0?i.substring(i.indexOf(".")+1,i.length):i;chrome.cookies.getAll({url:"https://"+i},function(p){$.each(p,function(r,q){chrome.cookies.remove({url:"http"+(q.secure?"s":"")+"://"+h.tools.ltrim(q.domain,".")+q.path,name:q.name})})})};h.reloadWindows=function(i,e){var p=[h.server+"newtab",h.server+"login",h.includeUrl("/html/login.html"),h.includeUrl("/html/newtab.html")];var q=i.toLowerCase().replace("www.","");chrome.tabs.query({},function(r){r.forEach(function(s){var t=h.tools.parseUri(s.url);t.host=t.host.replace("www.","");if((e!=null&&e.skip!=null&&e.skip.document!=null&&e.skip.document=="contentscript"&&e.skip.tab!=null&&e.skip.tab.id==s.id)||h.regex.test(s.url,h.regex.server("getting(.)?started*"),"i")||h.regex.test(s.url,h.regex.server("download"),"i")){return}if(q=="about:newtab"&&$.inArray(s.url,p)>=0){chrome.tabs.update(s.id,{url:h.includeUrl("about:newtab"),active:false},function(v){v.url===h.server+"login"&&chrome.tabs.onUpdated.addListener(u);function u(w,x){x.status==="complete"&&w===v.id&&navigator.onLine===false&&h.config.get("offline.login").then(function(y){chrome.tabs.onUpdated.removeListener(u);y==="1"&&chrome.tabs.update(v.id,{url:h.includeUrl("/html/login.html")})})}})}else{if(t.source==q||(q.indexOf(".")===0?t.host.toLowerCase().indexOf(q.substring(1))!=-1:(t.host.toLowerCase()==q||t.host.toLowerCase()=="."+q))){chrome.tabs.update(s.id,{url:s.url,active:false})}}})})};h.injectUi=function(e){return function(i,q,p){if(i!=null&&i.body!=null){e.call(h,arguments)}else{if(i!=null&&i.tab!=null&&i.document=="contentscript"){if(o[i.tab.id]!=null){o[i.tab.id].postMessage({call:"injectUi",args:[{document:"contentscript",origin:i.client},q,p]})}}else{chrome.tabs.query({currentWindow:true,active:true},function(s){var t=s[0];var u=chrome.extension.getViews({type:"tab",windowId:t.windowId});for(var r=0;r<u.length;r++){if(u[r].tabId===t.id){return e.call(h,u[r].document,q,$.extend(true,{inline:q},p))}}if(o[t.id]!=null){o[t.id].postMessage({call:"injectUi",args:[{document:"background"},q,p]})}else{d=[{document:"background"},q,p];h.urlGoto("about:newtab",{newtab:true})}})}}}}(h.injectUi);h.handleEvent=function(e){return function(i,p){if(i.tab!=null&&i.document=="contentscript"){if(i.origin!=null){if(o[i.origin]!=null){o[i.origin].postMessage({call:"handleEvent",args:[{document:"contentscript",origin:i.client},p]})}}else{if(o[i.client]!=null){o[i.client].postMessage({call:"handleEvent",args:[{document:"background"},p]})}}return}return e.call(h,i,p)}}(h.handleEvent);h.enable=function(e){return function(p,q){e.apply(this,arguments);this.passwordSavingEnable(q.settings.flags&8192?"disable-force":"clear");this.autofillAddressEnabled(q.settings.flags&16384?"disable-force":"clear");this.autofillCreditCardEnabled(q.settings.flags&16384?"disable-force":"clear");var s=chrome.extension.getViews({type:"popup"});for(var t=0;t<s.length;t++){s[t].close()}var r=$.extend({},h.config);$.each(r,function(i,u){typeof u==="function"&&delete r[i]});o.each(function(i){i.postMessage({call:"load",args:[r]})})}}(h.enable);h.disable=function(e){return function(i,p){e.apply(this,arguments);this.passwordSavingEnable("clear");this.autofillAddressEnabled("clear");this.autofillCreditCardEnabled("clear");o.each(function(q){q.postMessage({unload:true})})}}(h.disable);h.contentLoaded=function(){h.config.session.idle=new Date().getTime()};h.loginActions=function(e){return function(i,p){return $.isPlainObject(i)?$.Deferred().resolve(p):e.apply(this,arguments)}}(h.loginActions);h.load=function(e){return function(){e.apply(this,arguments);h.browser.setIcon(false,false);h.browser.setBadge("")}}(h.load);h.chromePrivacyService=function(i,p){var e=$.Deferred();if(p==="disable"){chrome.privacy.services[i].get({},function(q){if(q.value&&$.inArray(q.levelOfControl,["controllable_by_this_extension","controlled_by_this_extension"])>=0){chrome.privacy.services[i].set({value:false},function(r){h.log("Disabling "+i+" "+(chrome.runtime.lastError||"success"));e.resolve()})}else{e.resolve()}})}else{if(p==="disable-force"){chrome.privacy.services[i].set({value:false},function(q){h.log("Disabling "+i+" "+(chrome.runtime.lastError||"success"));e.resolve()})}else{if(p==="clear"){setTimeout(function(){chrome.privacy.services[i].get({},function(q){if($.inArray(q.levelOfControl,["controllable_by_this_extension","controlled_by_this_extension"])>=0){h.log("Clearing "+i+" to default");chrome.privacy.services[i].clear({})}e.resolve()})},1000)}else{if(p==="toggle"){return h.chromePrivacyService(i,"disable").then(function(){return h.chromePrivacyService(i,"clear")})}}}}return e.promise()};h.autofillAddressEnabled=function(e){if(typeof chrome.privacy==="object"&&typeof chrome.privacy.services==="object"&&typeof chrome.privacy.services.autofillAddressEnabled==="object"){return this.chromePrivacyService("autofillAddressEnabled",e)}return $.Deferred().reject()};h.autofillCreditCardEnabled=function(e){if(typeof chrome.privacy==="object"&&typeof chrome.privacy.services==="object"&&typeof chrome.privacy.services.autofillCreditCardEnabled==="object"){return this.chromePrivacyService("autofillCreditCardEnabled",e)}return $.Deferred().reject()};h.passwordSavingEnable=function(e){if(typeof chrome.privacy==="object"&&typeof chrome.privacy.services==="object"&&typeof chrome.privacy.services.passwordSavingEnabled==="object"){return this.chromePrivacyService("passwordSavingEnabled",e)}return $.Deferred().reject()};h.translate.translate=function(i){try{var q=""+i;$.each([" ","%","?","'","&",".","/","-","#","!",":",","],function(e,r){q=q.replace(new RegExp("\\"+r,"g"),"_"+r.charCodeAt(0)+"_")});return chrome.i18n.getMessage(q)}catch(p){return i}};h.extension=function(p,i){var e={ctrlLeft:false,ctrl:0,altLeft:false,alt:0};p.addEventListener("LMOMessageEvent",function(q){try{h.onEvent(q.target,q.detail)}catch(q){h.log(q)}},false);p.addEventListener("keydown",function(q){if(q.keyCode==17){e.ctrl=new Date().getTime();e.ctrlLeft=true}else{if(q.keyCode==18){e.alt=new Date().getTime();e.altLeft=true;if(e.ctrl>0&&e.alt-e.ctrl<3){e.ctrlLeft=e.altLeft=false}}else{if(q.keyCode==76&&e.ctrlLeft&&e.altLeft){h.log(p.document,{action:"ui"});return false}}}});i.tabs.getCurrent(function(q){p.tabId=q.id;p.document.tab=q});return this};chrome.runtime.onConnect.addListener(function(i){if(i!=null&&i.sender.tab!=null){var s=JSON.parse(i.name);var q=i.sender.tab.id;var r=typeof i.sender.frameId!=="undefined"?i.sender.frameId:s.frame;var e=r<=0?q:q+":"+r;o[e]=i;i.onMessage.addListener(function(w){try{if(typeof w==="string"){w=JSON.parse(w)}if(w.close!=null&&w.close=="tab"){chrome.tabs.remove(i.sender.tab.id)}if(w.call!=null&&typeof h[w.call]=="function"){if(w.args!=null&&w.args.length>0&&w.args[0]!=null&&w.args[0].document=="contentscript"){w.args[0].client=e;w.args[0].frame=r;w.args[0].tab=i.sender.tab}var u=h.apply(w.call,w.args);if(w.callback!=null){if($.inArray(typeof u,["object","function"])>=0&&typeof u.then=="function"){u.then(function(){i.postMessage({resolve:w.callback,arguments:Array.prototype.slice.call(arguments)})},function(){i.postMessage({reject:w.callback,arguments:Array.prototype.slice.call(arguments)})},function(){i.postMessage({notify:w.callback,arguments:Array.prototype.slice.call(arguments)})})}else{if(typeof u=="undefined"||u!=null){i.postMessage({resolve:w.callback,arguments:[u]})}}}}else{if(w.call!=null&&w.call=="config.get"){h.config.get(w.args[0]).then(function(){i.postMessage({resolve:w.callback,arguments:Array.prototype.slice.call(arguments)})})}else{if(w.call!=null&&w.call=="config.set"){h.config.set.apply(h.config.set,w.args)}else{if(w.call!=null&&w.call=="injectUiEvents.target"){var t=w.args[0];w.args[0]={document:"background"};chrome.tabs.sendMessage(t.tab,{call:"injectUiEvents.target",args:w.args},{frameId:t.frame})}else{if(w.history!=null){h.browser.history(w.history).then(function(){i.postMessage({resolve:w.callback,arguments:Array.prototype.slice.call(arguments)})})}}}}}}catch(v){}});i.onDisconnect.addListener(function(){delete o[e]});var p=$.extend({},h.config);i.postMessage({load:{tab:q,frame:r,server:h.server,config:$.each(p,function(t,u){typeof u==="function"&&delete p[t]}),supported:{passwordSavingEnabled:typeof chrome.privacy==="object"&&typeof chrome.privacy.services==="object"&&typeof chrome.privacy.services.passwordSavingEnabled==="object",autofillAddressEnabled:typeof chrome.privacy==="object"&&typeof chrome.privacy.services==="object"&&typeof chrome.privacy.services.autofillAddressEnabled==="object",autofillCreditCardEnabled:typeof chrome.privacy==="object"&&typeof chrome.privacy.services==="object"&&typeof chrome.privacy.services.autofillCreditCardEnabled==="object"}}});if(d!=null&&i.sender.tab.url===h.includeUrl("about:newtab")){setTimeout(function(t){o[q].postMessage({call:"injectUi",args:t})},0,d);d=null}}});chrome.browserAction.onClicked.addListener(function(e){chrome.tabs.query({currentWindow:true},function(i){i.forEach(function(p){p.active&&chrome.tabs.create({url:h.server+"login",active:true},function(r){chrome.tabs.onUpdated.addListener(q);function q(s,t){t.status==="complete"&&s===r.id&&navigator.onLine===false&&h.config.get("offline.login").then(function(u){chrome.tabs.onUpdated.removeListener(q);u==="1"&&chrome.tabs.update(r.id,{url:h.includeUrl("/html/login.html")})})}})})})});chrome.runtime.onMessage.addListener(function(p,i,e){if(p.contextmenu!=null){if(h.contextMenu[p.contextmenu]!=null&&h.contextMenu[p.contextmenu].id!=null){chrome.contextMenus.update(h.contextMenu[p.contextmenu].id,{enabled:p.enabled})}}if(p.uiEvent!=null){chrome.tabs.sendMessage(i.tab.id,{type:p.type,target:p.target,uiEvent:p.uiEvent})}if(p.lmocspos!=null){chrome.tabs.sendMessage(i.tab.id,{lmocspos:p.lmocspos})}});chrome.runtime.onInstalled.addListener(function(i){if(i.reason==="install"){c=true}});chrome.cookies.onChanged.addListener(function(i){try{if(i.removed==false){h.cookieChanged({host:i.cookie.domain,name:i.cookie.name},"added")}if(i.removed==true&&i.cause!="overwrite"){h.cookieChanged({host:i.cookie.domain,name:i.cookie.name},"deleted")}}catch(p){}});function l(e){$.each(e.responseHeaders,function(p,q){if(q.name.match(/Location/i)){h.pageRedirected(e.url,q.value);return false}})}try{chrome.webRequest.onHeadersReceived.addListener(l,{urls:["http://*/*","https://*/*"],types:["main_frame","sub_frame","xmlhttprequest"]},["responseHeaders"])}catch(k){}function m(p){if(p.tabId<0){return}var i=p.type=="xmlhttprequest";if(i||(p.method=="GET"&&p.url.indexOf("callback")>0)){if(p.method=="GET"){var e=p.url;if(e.indexOf("?")>0||e.indexOf("&")>0){var q=e.substring(e.indexOf(e.indexOf("?")>0?"?":"&")+1);chrome.tabs.sendMessage(p.tabId,{call:"ajaxRequest",args:[{document:"background"},p.url,p.method,q,{id:p.tabId}]})}}else{if(p.method=="POST"){var q=null;if(p.requestBody!=null&&p.requestBody.formData!=null){q=JSON.stringify(p.requestBody.formData)}else{if(p.requestBody!=null&&p.requestBody.raw!=null&&p.requestBody.raw.length==1){q=String.fromCharCode.apply(null,new Uint8Array(p.requestBody.raw[0].bytes))}}q!=null&&chrome.tabs.sendMessage(p.tabId,{call:"ajaxRequest",args:[{document:"background"},p.url,p.method,q,{id:p.tabId}]})}}}}try{chrome.webRequest.onBeforeRequest.addListener(m,{urls:["http://*/*","https://*/*"],types:["sub_frame","script","object","xmlhttprequest","other"]},["requestBody"])}catch(k){}function n(e){if(e.method=="GET"&&h.regex.test(e.error,/connection(.)?refused/,"i")&&(e.url==h.server||h.regex.test(e.url,h.regex.server("login*"),"i"))){chrome.tabs.update(e.tabId,{url:chrome.extension.getURL("/html/login.html"),active:false})}}try{chrome.webRequest.onErrorOccurred.addListener(n,{urls:["http://*.logmeonce.com/*","https://*.logmeonce.com/*"],types:["main_frame","sub_frame"]})}catch(k){}var a=chrome.contextMenus.create({title:h.translate.company,contexts:["all"]});for(var g in h.contextMenu){h.contextMenu[g].id=chrome.contextMenus.create({title:h.translate._(h.contextMenu[g].label),contexts:["all"],parentId:a,enabled:false,onclick:function(r,q){for(var p in h.contextMenu){if(h.contextMenu[p].id==r.menuItemId){chrome.tabs.sendMessage(q.id,{contextmenu:p});break}}}})}function f(){var e=$.Deferred();if(typeof chrome.runtime.connectNative!=="function"){h.log("Native messaging not supported.");return e.reject()}if(h.plugin!=null&&h.pluginLoader!=null){return e.resolve(h.pluginLoader.version)}window.wyrmhole.create("com.logmeonce.host","application/x-logmeonce").then(function(i){i.onDisconnect(function(q){h.log("Native Messaging host disconnected - reconnecting in 5 seconds");h.plugin=null;h.pluginLoader.version=null;h.pluginLoader.timeout=setTimeout(f,5000)});var p=new FireWyrmJS(i);return p.create("application/x-logmeonce")}).then(function(i){i.version.then(function(p){h.plugin=i;h.pluginLoader.version=p;h.log("Loading Native Messaging host - "+p);$.each(h.pluginLoader.promises,function(q,s){try{s.notify({plugin:$.extend(h.pluginLoader.update||{version:p},{installed:p})})}catch(r){}});h.pluginLoader.promises=[];e.resolve(p)});i.getDeviceInfo("name").then(function(p){h.pluginLoader.device.name=typeof p==="string"?p:null});i.getDeviceInfo("modelname").then(function(p){h.pluginLoader.device.model=typeof p==="string"?p:null});i.getDeviceInfo("serialnumber").then(function(p){h.pluginLoader.device.serial=typeof p==="string"?p:null})},function(i){e.reject();h.log("Wyrmhole error - "+i)});return e.promise()}window.addEventListener("load",function(){h.load(null,$);h.passwordSavingEnable("clear");h.autofillAddressEnabled("clear");h.autofillCreditCardEnabled("clear");h.pluginLoader.load=f;h.pluginLoader.load();h.config.get("domain").then(function(e){return e!=null?h.domain(e,"load").then(function(){return e}):null}).always(function(e){typeof e==="string"&&h.domain(e,"brand");setTimeout(function(){h.loadUser(null,{alert:false}).fail(function(){h.reloadWindows(h.tools.parseUri(h.server).host)})},500)})},false);if(navigator.userAgent.indexOf("Firefox")<0){var b=chrome.runtime.getManifest();chrome.tabs.query({},function(e){e.forEach(function(p){if(p.status=="complete"&&/^(http|https):\/\/*/.test(p.url)){var i=$.Deferred().resolve();$.each(b.content_scripts[0].js,function(r,q){i=i.then(function(){var s=$.Deferred();chrome.tabs.executeScript(p.id,{file:q},s.resolve);return s.promise()})})}})})}})(logmeonce);