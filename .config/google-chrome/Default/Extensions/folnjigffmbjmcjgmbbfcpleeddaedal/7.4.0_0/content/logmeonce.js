var logmeonce=(function(){var p="7.4.0";var q=4;var i=1;var r=2;var t=1;var e=2;var k=4;var h=16;var u=4096;var s=1;var c=2;var d=4;var n=8;var m=16;var o=32;var f=null;var a=function(y){var w="";var v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";var z=v.length;for(var x=0;x<y;x++){w+=v.charAt(Math.floor(Math.random()*z))}return w};var g=function(w){var v=w.getBoundingClientRect();if(document.all&&!v.width&&!v.height){v={width:v.right-v.left,height:v.bottom-v.top,right:v.right,left:v.left,top:v.top,bottom:v.bottom}}return v};var l=function(C,E){if(C.ownerDocument!=null&&C==C.ownerDocument.lmoForm){return true}if(E!=null&&E.cache!=null&&E.cache.isVisible!=null){for(var A=0;A<E.cache.isVisible.length;A++){if(E.cache.isVisible[A].target==C){return E.cache.isVisible[A].visible}}}var F=C.ownerDocument;var D=logmeonce.window(F);var G=logmeonce.window(F,"scrollOffset");var x=g(C);var y=f(C).is(":visible")&&(f(C).css("opacity")>0.1&&f(C).css("visibility")!="hidden")&&(G.scrollLeft+x.left+x.width>0&&G.scrollTop+x.top+x.height>0);if(y){f(C).parents().each(function(){y=f(this).css("opacity")>0.1;if(y&&this!=C&&f(this).css("overflow")=="hidden"){var H=g(this);if(H.width>0&&H.height>0){y=!(x.left>H.right||H.left>x.right||x.top>H.bottom||H.top>x.bottom)}}return y})}if(y&&x.width>1&&x.height>1&&(E==null||E.coverage==null||E.coverage==true)){var B={top:0,left:0,right:f(D).width(),bottom:f(D).height()};if(B.top<=x.top&&B.left<=x.left&&B.right>x.right&&B.bottom>x.bottom){var z=Math.min(x.width/4,x.height/4);var w=0;var v=[{x:x.left+x.width/2,y:x.top+x.height/2}];if(x.width>20&&x.height>20){v=f.merge(v,[{x:x.left+z,y:x.top+z},{x:x.left+z,y:x.bottom-1-z},{x:x.right-1-z,y:x.top+z},{x:x.right-1-z,y:x.bottom-1-z}])}f.each(v,function(L,H){var K=F.elementFromPoint(H.x,H.y);var I=function(O,M){var N=O.parentNode;while(N!=null){if(N==M){return true}N=N.parentNode}return false};var J=function(O,N){if(logmeonce.regex.is(O.id,"placeholder")||logmeonce.regex.is(O.className,"placeholder")){var M=g(O);return(Math.ceil(M.left)>=Math.floor(x.left)&&Math.ceil(M.top)>=Math.floor(x.top)&&Math.floor(M.right)<=Math.ceil(x.right)&&Math.floor(M.bottom)<=Math.ceil(x.bottom))||f.grep(N.attributes,function(P,Q){return P.value==O.id}).length>0}return false};if(K!=null&&(K==C||I(K,C)||J(K,C)||K.ownerDocument!=C.ownerDocument||f(K).hasClass("ui-logmeonce")||f(K).css("opacity")<0.9)){w++}return w<=0});y=w>0}}if(E!=null&&E.cache!=null&&E.cache.isVisible!=null){E.cache.isVisible.push({target:C,visible:y})}return y};var b=function(v){return typeof v==="function"||(document.all&&document.documentMode<=8&&typeof v=="object"&&(""+v).indexOf("function")===1)};function j(x,v){if(typeof v=="object"){for(var w in v){this[w]=v[w]}}this.message=""+x;this.toString=function(){return this.message},this.toObject=function(){return f.extend({message:this.message},typeof v=="object"?v:{})}}return{server:"https://secure.logmeonce.com/",$:null,plugin:null,config:{session:{id:0},brand:{},user:null,password:null,securitykey:null,pcr:null,push:null,loginList:[],logoutList:[],cookieList:{},portable:false,referred:null,passwordManager:{},ui:null,qr:{},get:function(v){return null},set:function(v,w){}},importList:{},passwordEvent:null,logs:"",browser:{name:null,type:null,version:null,platform:null,history:function(){return f.Deferred().reject()},setIcon:function(v,w){},setBadge:function(v){}},sync:{sites:null,},ajaxXhr:{},ajax:function(v){if(typeof v.abort!="undefined"){this.ajaxXhr[v.abort]!=null&&this.ajaxXhr[v.abort].abort();delete logmeonce.ajaxXhr[v.abort];return}var w=f.ajax(v);if(typeof v.abortable!="undefined"){logmeonce.ajaxXhr[v.abortable]=w}return w.then(function(x){if(typeof v.abortable!="undefined"){delete logmeonce.ajaxXhr[v.abortable]}return x},function(z,y,x){if(typeof v.abortable!="undefined"){delete logmeonce.ajaxXhr[v.abortable]}return f.Deferred().reject({readyState:z.readyState,status:z.status},y,x)})},privacy:function(x){var v=f.Deferred();var y=f.extend({camera:true,location:true},typeof x=="object"?x:{});if(this.config.user!=null&&(y.username==null||y.username==this.config.user.name)){var w=this.config.user;v.resolve(f.extend(y,{camera:typeof w.settings.camera==="number",location:(w.settings.flags&1024)!=1024}))}else{if(y.username!=null){this.config.get(logmeonce.tools.hash("sha1","privacy."+y.username)).then(function(z){try{v.resolve(JSON.parse(logmeonce.tools.decrypt(z,"privacy."+y.username)))}catch(A){v.resolve(y)}},v.reject)}else{v.resolve(y)}}return v.promise()},geolocation:function(x,y){var w=f.Deferred();var v=x.navigator;if(v.geolocation){v.geolocation.getCurrentPosition(function(z){w.resolveWith(logmeonce,[z.coords])},function(z){w.rejectWith(logmeonce,[z])});y!=null&&setTimeout(function(){w.rejectWith(logmeonce)},y)}else{w.rejectWith(this,[{message:"Geolocation is not supported"}])}return w},contextMenu:{openid:{label:"Your OpenID Identifier",available:function(v,w){return logmeonce.config.user!=null&&w instanceof HTMLInputElement&&f.inArray(w.type,["text","email","number","tel"])>=0},click:function(v,w){if(logmeonce.config.user.openid!=null){logmeonce.inputFill(w,logmeonce.config.user.openid,{filled:false})}}},passwordGenerate:{label:"Password Generate",available:function(v,w){return w instanceof HTMLInputElement&&w.type=="password"},click:function(v,w){logmeonce.attachPasswordGenerateEvent(w,true,{injectEvent:false});logmeonce.injectPasswordGenerateUi(v,w)}},autofillMapping:{label:"Autofill mapping",available:function(v,w){return logmeonce.config.user!=null&&logmeonce.config.user.settings.flags&128&&w instanceof HTMLInputElement&&f.inArray(w.type,["text","password","email","number","tel"])>=0},click:function(v,w){logmeonce.attachAutofillMappingEvent(w,true,{injectEvent:false});logmeonce.injectAutofillMappingUi(v,w)}}},domain:function(w,A){var C=f||jQuery;var v=C.Deferred();if(A=="brand"&&typeof w=="string"){v.resolve(w)}else{if(A=="load"&&typeof w=="string"){var z=w;var y=this.tools.parseUri(this.server).host;var B=y.split(".");if(B.length==3&&B.slice(-2).join(".")=="logmeonce.com"&&y!=z){this.server=this.server.replace(y,z);this.log("Changing server - "+this.server);v.resolve(z)}else{this.config.set("domain",null);v.reject()}}else{var B=this.tools.parseUri(this.server).host.split(".");var x=w.location.hostname.split(".");if(B.length==3&&B.slice(-2).join(".")=="logmeonce.com"&&B.length==x.length&&B[0]!=x[0]){var z=x[0];this.config.set("domain",z+".logmeonce.com");this.server=this.server.replace(B.join("."),z+".logmeonce.com");this.log("Changing server - "+this.server);v.resolve(z)}else{v.reject()}}}return v.then(function(D){return f!=null?f.ajax({url:logmeonce.server+"rest/branding",dataType:"logmeonce-binary",}).then(function(E){!f.isEmptyObject(E)&&logmeonce.log("Loading branding: "+JSON.stringify(E));return f.extend(E,{domain:D})}):{}}).then(function(D){logmeonce.config.brand=D},function(){logmeonce.config.brand={}}).promise()},regex:{server:function(x){var v=logmeonce.tools.parseUri(logmeonce.server).host;var w=v.split(".");if(w.length>2){w=["([^/]+)"].concat(w.slice(w.length-2))}return"^"+logmeonce.server.replace(v,w.join("."))+(x||"")},url:function(v){var w=logmeonce.tools.parseUri(v).host;var x=w.split(".");var y=2;if(x.length>y&&f.inArray(x[x.length-2],["com","net","org","edu","gov","mil","co"])>=0){y++}if(x.length>y&&f.inArray(x[0],["www","secure","ssl","login","my","mobile","m","signin","reg","register","signup","account","member"])>=0){x.shift()}return"^(http|https)://([^/]+.)?"+x.join(".")+".*"},group:function(v,x,w){w=w||"(.)?";return"("+v+w+x+")|("+x+w+v+")"},words:function(x){var v=[];for(var w=typeof x=="boolean"?1:0;w<arguments.length;w++){v.push("(?=.*\\b"+arguments[w]+"\\b)")}return"^"+v.join("")+".+"+(x===true?"|"+Array.prototype.slice.call(arguments).splice(1,arguments.length-1).join("(.)?"):"")},is:function(v,w){switch(w){case"placeholder":return this.test(v,"(place|p)(.)?holder|fake","ig");case"captcha":return this.test(v,"captcha","i")||this.test(v,"check(.)?code","i");case"email":return this.test(v,"[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+.[a-zA-Z]{2,4}","i");case"password-change":return this.test(v,this.group("(update|reset|change)","(password|passwd|pass)"),"i");case"password-forgot":return this.test(v,this.group("(forgot|remind)","(password|passwd|pass)"),"i");case"password-current":return this.test(v,this.group("(?:existing|old|cur|curr|former)","(?:pass|pw|p)",".*"),"i");case"password-new":return this.test(v,this.group("(?:new)","pass",".*"),"i");case"password-repeat":return this.test(v,this.group("(?:repeat|retype|confirm|again)","pass",".*"),"i");case"password-strength-meter":return this.test(v,this.group("(rate|strength|meter|validation|validate)","(account|pass)"),"i");case"sign-in":return this.test(v,"log(.)?in|sign(.)?in|sign(.)?on","i");case"sign-up":return this.test(v,"registration|register|sign(.)?up|join(.)?new|join(.)?form|new(.)?user","i")||this.test(v,this.group("create","account"),"i")||f.inArray(v,["reg"])>=0;case"2fa":return this.test(v,"two(.)?step|2fa|two(.)?factor","i");case"totp":return this.test(v,this.group("(verify|verification|validate|check|otp)","(code|pin|otp)"),"i");default:throw"Unknown regex"}},test:function(v,x,w){return v!=null&&v.length>0&&new RegExp(x,w).test(v)}},equals:function(w,v,z){switch(z!=null?z:""){case"username":w=w!=null&&w.length>0?w.toLowerCase().trim():null;v=v!=null&&v.length>0?v.toLowerCase().trim():null;return w!=null&&v!=null&&w==v;case"url":function x(B){return logmeonce.tools.rtrim(B.split("?")[0].split("#")[0],"/")}return w!=null&&w.length>0&&v!=null&&v.length>0&&x(w)==x(v);case"*":function A(D,B,C){return D.substr(0,B)+C+D.substr(B+1)}if(w!=null&&v!=null&&w.length===v.length){for(var y=0;y<w.length;y++){if(v[y]=="*"){v=A(v,y,w[y])}}}return w==v;default:return w==v}},log:function(x,w){if(x!=null){var y=new Date();var v=y.getFullYear()+"-"+(y.getMonth()+1)+"-"+y.getDate()+" "+y.getHours()+":"+y.getMinutes()+":"+y.getSeconds()+"."+y.getMilliseconds()+": "+x+"\n";this.logs+=v;this.config.user!=null&&(this.config.user.type&q)==q&&console.log(v)}switch(w!=null&&w.action!=null?w.action:""){case"clear":this.logs="";break;case"ui":return this.injectUi(null,{name:"logs",args:[this.config.user!=null&&(this.config.user.type&q)==q]});case"send":return f.ajax({url:this.server+"rest/logs/",data:{description:w.description!=null?w.description:"",logs:logmeonce.logs},dataType:"logmeonce-binary",type:"POST"}).then(function(){},function(){});case"get":return this.logs}},getDiskDriveList:function(v){if(this.plugin!=null&&this.plugin.getDiskDriveList!=null){return this.plugin.getDiskDriveList(v!=null&&v.length>0?v:"")}return f.Deferred().reject()},usb:function(v,x){function C(E,D){return E.name+"/LogmeOnce/oath/"+logmeonce.tools.hash("md5",D)+".oath"}if(x!=null&&x.install!=null){var w=f.Deferred();var B={key:x.install.oath.key,model:x.install.drive.model,serialNumber:x.install.drive.serialNumber};var A=this.tools.encrypt(JSON.stringify(B),x.install.aes.key,true,"string");var z=f.grep(x.install.drive.partitions,function(E,D){return E.freeSpace!=null&&E.freeSpace>0});logmeonce.log("USB Install - checking drive: "+x.install.drive.model+" / "+x.install.drive.serialNumber);function y(E){var D=C(z[E],x.install.aes.key);logmeonce.writeFile(D,A).then(function(){logmeonce.log("USB Install - writting to "+D+" - success");w.resolve(true)},function(){logmeonce.log("USB Install - writting to "+D+" - failed");if(++E<z.length){y(E)}else{w.resolve(false)}})}if(z.length>0){y(0)}else{logmeonce.log("USB Install - no partitions");w.resolve(false)}return w}if(x!=null&&x.verify!=null){var w=f.Deferred();this.getDiskDriveList("USB").then(function(D){var E=[];f.each(D,function(F,G){logmeonce.log("USB Verification - checking drive: "+G.model+" / "+G.serialNumber);f.each(G.partitions,function(J,I){if(I.freeSpace!=null&&I.freeSpace>0){var H=f.Deferred();logmeonce.readFile(C(I,x.verify.aes.key)).then(function(M){try{var K=logmeonce.tools.decrypt(M,x.verify.aes.key);var L=JSON.parse(K);if(G.model==L.model&&(G.serialNumber==null||G.serialNumber.length<=0||L.serialNumber==null||L.serialNumber.length<=0||G.serialNumber==L.serialNumber)){logmeonce.log("USB Verification - (partition "+I.name+") Generating OTP");H.resolve(f.extend(G,{otp:logmeonce.tools.totp(L.key)}))}else{logmeonce.log("USB Verification failed - (partition "+I.name+") file is configured for "+L.model+" / "+L.serialNumber);H.resolve()}}catch(N){H.resolve()}},function(){H.resolve()});E.push(H)}})});f.when.apply(f,E).then(function(G){var F=f.grep(Array.prototype.slice.call(arguments),function(H){return typeof H=="object"});w.resolve(F)})},function(){w.resolve(false)});return w}var w=f.Deferred();logmeonce.getDiskDriveList("USB").then(function(D){w.resolve(D)},function(){w.resolve(false)});return w},allowed:function(z,w,y){if(z==null||this.config.user==null){return false}var y=f.extend({_group_privileges:true},typeof y==="object"?y:{});var v=this.config.user;var A=typeof v.allowed==="number"?{site:v.allowed}:v.allowed;var x={create:1,read:2,update:4,"delete":8,owner:16};z==="site"&&f.extend(x,{personal:32,note:64,storage:128,"export":256,"import":512});if(typeof w==="string"){w=x[w]!=null?x[w]:null}if(typeof z==="string"){var B=A[z]!=null&&(w!=null?(A[z]&w)===w:(A[z]>=65535));if(z==="site"&&y._group_privileges&&!B){B=f.grep(this.config.user.groups,function(C){return C.privileges!=null&&w!=null&&C.privileges&w}).length>0}return B}if(typeof z==="object"&&typeof z.id==="number"&&typeof z.name==="string"&&typeof z.login==="object"){if(typeof v.owner=="undefined"){return typeof z.user==="undefined"||(typeof z.privileges==="number"&&(z.privileges&w)===w)}if(typeof z.user=="undefined"){return this.allowed("site","personal")&&typeof w==="number"&&f.inArray(w,[x.create,x.read,x.update,x["delete"]])>=0}if(v.owner==z.user){return this.allowed("site",w)||(typeof z.privileges==="number"&&(z.privileges&w)===w)}}return false},confirm:function(v,w){return confirm(w)?f.Deferred().resolve():f.Deferred().reject()},pluginLoader:{load:function(){return f.Deferred().reject()},update:null,version:null,timeout:null,device:{},promises:[]},update:function(w,y){var v=f.Deferred();var x=0;var z=3000;function A(B){logmeonce.pluginLoader.load().then(function(C){if(logmeonce.tools.versioncmp(C,B.version)>=0){var D=logmeonce.pluginLoader.promises;logmeonce.pluginLoader.timeout!=null&&clearTimeout(logmeonce.pluginLoader.timeout);logmeonce.pluginLoader.timeout=null;logmeonce.pluginLoader.update=null;logmeonce.pluginLoader.promises=[];v.resolve({plugin:f.extend(B,{installed:C,updated:true})});f.each(D,function(E,G){try{G.resolve({plugin:B})}catch(F){}})}else{v.notify({plugin:f.extend(B,{installed:C})})}});if(++x<=400&&B.updated!==true){logmeonce.pluginLoader.timeout!=null&&clearTimeout(logmeonce.pluginLoader.timeout);logmeonce.pluginLoader.timeout=setTimeout(A,z,B)}else{logmeonce.pluginLoader.timeout=null;logmeonce.pluginLoader.promises=[]}}logmeonce.pluginLoader.timeout!=null&&clearTimeout(logmeonce.pluginLoader.timeout);logmeonce.pluginLoader.timeout=null;logmeonce.pluginLoader.update=null;y.then(function(B){return f.ajax({url:logmeonce.server+"rest/extension/update",data:B,dataType:"logmeonce-binary"}).then(function(C){if(C.plugin!=null&&B.plugin!=null){C.plugin.installed=B.plugin;if(C.plugin.version>p){delete C.plugin}}return C},function(E,D,C){return D})}).then(function(B){if(B.plugin!=null&&(B.update==null||logmeonce.tools.versioncmp(B.plugin.version,p)<=0)){logmeonce.pluginLoader.update=B.plugin;logmeonce.pluginLoader.timeout!=null&&clearTimeout(logmeonce.pluginLoader.timeout);logmeonce.pluginLoader.timeout=setTimeout(A,z,B.plugin)}v.notify(B)},function(B){v.reject(B)});logmeonce.pluginLoader.promises.push(v);return v.promise()},about:function(v,x){if(x!=null&&x.get==="version"){return p}if(x!=null&&x.get==="plugin"){return this.plugin!=null&&this.plugin.version!=null?this.plugin.version:f.Deferred().reject()}if(x!=null&&x.get==="desktopmode"){return this.plugin!=null&&this.plugin.readFile!=null&&this.plugin!=null&&this.plugin.writeFile!=null}if(x!=null&&x.get==="browser"){return this.plugin!=null&&this.plugin.about!=null?this.plugin.about("browser"):false}if(x!=null&&x.get==="update"){return this.update(v,w())}if(typeof x=="string"&&x==="device"){var z=f.extend({},this.pluginLoader.device,{screen:this.tools.screen()});return f.each(z,function(B,A){A===null&&delete z[B]})}if(typeof x=="string"&&x==="logmeonce"){function y(B){var A=[];f.each(B,function(E,D){if(f.isPlainObject(D)){f.isEmptyObject(D)==false&&A.push(logmeonce.tools.capitalize(E)+" ("+y(D)+")")}else{if(D!=null){var F=D.replace(/\(/g,"\\(");var C=unescape(encodeURIComponent(F));A.push(logmeonce.tools.capitalize(E)+"/"+C)}}});return A.join("; ")}return y({extension:p,plugin:this.pluginLoader.version,device:this.about(v,"device")})}function w(){var A=f.Deferred();if(logmeonce.plugin!=null){logmeonce.plugin.version.then(function(B){A.resolve({version:p,plugin:B})},function(){A.resolve({version:p})})}else{A.resolve({version:p})}return A}w().then(function(){logmeonce.injectUi(v,{name:"about",args:Array.prototype.slice.call(arguments)})})},logout:function(v){f.ajax({url:this.server+"rest/authenticate/logout",dataType:"logmeonce-binary"}).always(function(){logmeonce.disable(null,v)})},agent:function(){function v(y,z){if(!("WebSocket" in window)){return f.Deferred().reject({exception:{message:"This browser is not supported for Directory Authentication. Please upgrade your browser to newer version."}})}var x=f.Deferred();var w=new WebSocket(y);w.onopen=function(A){z!=null&&w.send(JSON.stringify(z))};w.onmessage=function(B){var A=JSON.parse(B.data);if(A.exception!=null){x.rejectWith(w,[A]);w.close();w=null}else{x.notifyWith(w,[A])}};w.onerror=function(A){x.rejectWith(w)};w.onclose=function(A){x.rejectWith(w);w=null};return x.done(function(){w.close();w=null})}return{authenticate:function(x,w){logmeonce.log("Websocket authenticate ["+x.id+"] for "+w.username);var y=v(x.ws+"directory/authenticate/"+x.id,{authenticate:w});return y.then(function(z){logmeonce.log("Websocket authenticate ["+x.id+"] is successful");return z},function(A){var z=A!=null&&A.exception!=null?A.exception.message:"";logmeonce.log("Websocket authenticate ["+x.id+"] failed: "+z);return A},function(z){z.authenticate!=null&&y.resolve(z.authenticate)})}}}(),push:function(F,L){var M=f.Deferred();var I=L.device;var B=L.authentication;var x=L.mobileconnect;var w=L.username;var H=L.wait;var y={};var J={};var z={FailedFrontImage:1,SuccessFrontImage:16};var A=1000;var K=logmeonce.privacy(L);var D=K.then(function(O){return O.location?logmeonce.geolocation(window,A):f.Deferred().reject()});var G=true;var v=K.then(function(O){G=O.camera&&(typeof L.authentication==="undefined"||L.authentication==="push-login");return G?logmeonce.webcam(A).fail(function(P){G=typeof P=="object"&&typeof P.then=="function";G&&P.then(function(Q){f.extend(true,y,{image:Q});y.token!=null&&y.image!=null&&E(y)},function(){G=false})}):f.Deferred().reject()});delete L.device;delete L.mobileconnect;delete L.username;delete L.authentication;delete L.wait;function N(R,Q){if(logmeonce.browser.type=="ie"||logmeonce.browser.type=="safari"){R.data.image={binary:Q,type:"image/jpeg"};R.processData=false}else{if(typeof FormData!=="undefined"){try{var O=R.data;O.image=new Blob([new Uint8Array(Q)],{type:"image/jpeg"});R.data=new FormData();f.each(O,function(S,T){R.data.append(S,T)});R.contentType=false;R.processData=false}catch(P){logmeonce.log("Webcam image available - but fails with: "+P)}}}return R}function E(O){f.ajax(N({url:logmeonce.server+"push/image/"+O.token,type:"POST",data:{},dataType:"json"},O.image))}function C(P,O){f.ajax(N({url:logmeonce.server+"rest/events/"+P.id,type:"POST",data:P.token!=null?{token:P.token}:{},headers:P.token==null&&O!=null?{Authorization:"Token "+O}:{},dataType:"logmeonce-binary"},P.image))}f.when.apply(f,f.map([D,v],function(P){var O=f.Deferred();P.always(function(){O.resolve.apply(this,Array.prototype.slice.call(arguments))});return O.promise()})).always(function(O,P){var Q={url:logmeonce.server+"push/send/"+I,type:"POST",data:f.extend({secret:sjcl.codec.base64.fromBits(sjcl.random.randomWords(8))},L),dataType:"json"};if(typeof O=="object"&&O.latitude!=null&&O.longitude!=null){Q.data.latitude=O.latitude;Q.data.longitude=O.longitude}if(f.isArray(P)&&P.length>0){N(Q,P)}else{if(!G){Q.data.image="false"}}f.ajax(Q).then(function(S){if(S.image!=null){f.extend(true,y,{token:S.image});delete S.image}y.token!=null&&y.image!=null&&E(y);M.notify(S);var R={};if(x!=null){R.mobileconnect=x}if(H!=null){R.wait=H}function T(){return f.ajax({url:logmeonce.server+"push/wait/"+S.challenge,type:f.isEmptyObject(R)?"GET":"POST",data:R,dataType:"json"}).then(function(V,U,W){if(W.status===204){return T()}return V})}return T()}).then(function(R){if(R.event!=null){f.extend(true,J,R.event)}return R!=null&&R.token!=null&&R.secret!=null?f.ajax({url:logmeonce.server+"rest/authenticate/",type:"POST",data:{token:R.token},dataType:"logmeonce-binary"}).then(function(T){if(J.id!=null&&J.mugshot&z.SuccessFrontImage){K.then(function(V){V.camera&&logmeonce.webcam(10000).then(function(W){C(f.extend(J,{image:W}),T.token)})})}try{var S=logmeonce.tools.decrypt(R.secret,logmeonce.tools.base64.decode(Q.data.secret));logmeonce.config.push=logmeonce.tools.encrypt(S,T.session);logmeonce.config.set("sek",logmeonce.config.push)}catch(U){}logmeonce.config.set("user",[w,B].join(","));logmeonce.config.get("logins").then(function(Y){if(typeof Y==="string"&&Y.length>0){var X=new Date();X.setHours(0,0,0,0);X.setDate(X.getDate()-1);var V=typeof Y==="string"&&Y.length>0?f.map(Y.split(","),function(Z){return parseInt(Z)||0}):[0,0];var W=new Date(V.length>1?V[1]:0);V[0]>0&&W.getTime()>X.getTime()&&f.ajax({url:logmeonce.server+"rest/events/login",data:{logins:V[0],time:Math.round(V[1]/1000)},beforeSend:function(Z){Z.setRequestHeader("Authorization","Token "+T.token)},type:"POST",dataType:"logmeonce-binary"});logmeonce.config.set("logins",null)}});return T}):R}).then(function(R){M.resolve(R)},function(T,S,R){if(R.exception!=null&&R.exception.event!=null&&R.exception.event.id!=null&&R.exception.event.token!=null){f.extend(true,J,R.exception.event)}if(J.id!=null&&J.token!=null&&J.mugshot&z.FailedFrontImage){K.then(function(U){U.camera&&logmeonce.webcam(10000).then(function(V){C(f.extend(J,{image:V}))})})}M.reject({text:S,exception:R.exception})})});return M.promise()},loginActions:function(C,z){function E(I,H){return Math.random()*(H-I)+I}function y(J,H){var K=E(-J,J);var I=Math.round(Math.abs(K)*H)/H;return(K>=0||-1)*I}function x(J,O,I){var H=f.Deferred();try{var K=J.animate(O,I);K.onfinish=H.resolve}catch(M){var N="anim-"+Math.random().toString(36).substr(2);var L="@keyframes "+N+" {"+f.map(O,function(Q,P){return Math.round(((P+1)*100)/O.length)+"% {"+f.map(Q,function(S,R){return R+": "+S})+"}"}).join(" ")+"}";logmeonce.injectStyle(C,{text:L});J.style.animationDuration=I.duration+"ms";J.style.animationIterationCount=I.iterations;J.style.animationName=N;setTimeout(H.resolve,I.duration*I.iterations)}return H.promise()}var D={duration:20};var G=f.Deferred();var A={audio:function(K){var J=f.Deferred();var I=f.extend(D,K.audio!=null?(typeof K.audio=="object"?K.audio:{url:K.audio}):{});var H=new Audio();H.addEventListener("ended",J.resolve);H.addEventListener("error",J.resolve);H.addEventListener("timeupdate",function(){if(H.currentTime>I.duration){J.resolve()}});H.volume=1;H.src=I.url;H.play();setTimeout(J.resolve,I.duration*1000+1000);return J.then(function(){if(H.duration>0&&!H.paused){H.pause()}}).promise()},flash:function(K){var J=f.extend(D,K.flash!=null?(typeof K.flash=="object"?K.flash:{duration:K.flash}):{});var H=f(C.body).css({overflow:"hidden"});var I=f("<div>",C).css({display:"block",position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"radial-gradient(transparent 10px, white 5%)",zIndex:2147483647}).appendTo(H);var L=[{transform:"scale(1)",},{transform:"scale(15)",},{transform:"scale(1)",}];return x(I.get(0),L,{duration:2000,iterations:J.duration/2}).then(function(){H.css({overflow:""});I.remove()}).promise()},morse:function(L){var K=f.Deferred();var J=f.extend({morse:["000","111"]},D,L.morse!=null?(typeof L.morse=="object"?L.morse:{duration:L.morse}):{});var I=f("<div>",C).css({display:"block",position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"transparent",zIndex:2147483647}).appendTo(C.body);function H(O){var N=f.Deferred();if(K.state()==="resolved"){return N.reject()}I.css("background","#fff");setTimeout(function(){I.css("background","transparent");setTimeout(N.resolve,O*0.4)},O*0.6);return N.promise()}M();function M(){var N=f.Deferred().resolve();f.each(J.morse,function(P,Q){for(var O=0;O<Q.length;O++){N=N.then(function(R){return function(){return H(R)}}(Q[O]=="0"?250:700))}N=N.then(function(){var R=f.Deferred();setTimeout(R.resolve,400);return R.promise()})});return N.then(M)}setTimeout(function(){K.resolve();I.remove()},J.duration*1000);return K.promise()},shake:function(K){var J=f.Deferred();var I=f.extend(D,K.shake!=null?(typeof K.shake=="object"?K.shake:{duration:K.shake}):{});var L=[];for(var H=0;H<80;H++){L.push({transform:"translate("+y(30,1)+"px,"+y(30,1)+"px) rotate("+y(4,10)+"deg)"})}return x(C.body,L,{duration:5000,iterations:I.duration/5})},vibrate:function(J){var I=f.extend(D,J.shake!=null?(typeof J.shake=="object"?J.shake:{duration:J.shake}):{});var K=[];for(var H=0;H<20;H++){K.push({transform:"translate("+y(4,1)+"px,"+y(4,1)+"px) scale("+E(0.99,1)+")"})}return x(C.body,K,{duration:150,iterations:I.duration/0.1})},view:function(J){var I=f.Deferred();var H=f.extend({message:J.message||""},D,J.view!=null?(typeof J.view=="object"?J.view:{name:J.view}):{});if(H.url==null){logmeonce.log("Login action view - no url");return I.resolve().promise()}logmeonce.injectUi(C,{name:"action-view",top:false,args:[H]});f.extend(J,{ui:true});setTimeout(I.resolve,H.duration*1000);return I.promise()}};var w=f.grep(z.trigger,function(H){return typeof H==="string"&&typeof A[H]==="function"});var F=f.grep(z.trigger,function(H){return typeof H==="object"});var v=f.when.apply(f,f.map(w,function(H){logmeonce.log("Login action "+H+" start");try{return A[H](z).then(function(){logmeonce.log("Login action "+H+" complete")})}catch(I){logmeonce.log("Login action "+H+" failed: "+I);return f.Deferred().resolve().promise()}}));for(var B=0;B<F.length;B++){v=v.then(function(H){return function(){logmeonce.log("Login action bundle with "+H.trigger.length+" actions");return logmeonce.loginActions(C,f.extend(true,{message:z.message},H)).then(function(I){I.ui===true&&f.extend(z,{ui:true})})}}(F[B]))}return v.then(function(){return z})},login:function(F,E){var I=f.Deferred();var z=E.data;var y=E.authenticate||"password";var H=E.password;var A=E.securitykey;var B=E.wait;var G=1000;var v={};var K={FailedFrontImage:1,SuccessFrontImage:16};function C(M,L){var N=M.token!=null?{token:M.token}:{};var P={url:logmeonce.server+"rest/events/"+M.id,type:"POST",data:N,headers:M.token==null&&L!=null?{Authorization:"Token "+L}:{},dataType:"logmeonce-binary"};if(logmeonce.browser.type=="ie"||logmeonce.browser.type=="safari"){N.image={binary:M.image,type:"image/jpeg"};P.processData=false}else{if(typeof FormData!=="undefined"){try{N.image=new Blob([new Uint8Array(M.image)],{type:"image/jpeg"});P.data=new FormData();f.each(N,function(Q,R){P.data.append(Q,R)});P.contentType=false;P.processData=false}catch(O){logmeonce.log("Webcam image available - but fails with: "+O);return f.Deferred().reject()}}}return f.ajax(P)}function J(L,M){return f.ajax({url:L,type:f.isEmptyObject(M)?"GET":"POST",data:M,dataType:"json"}).then(function(O,N,P){if(P.status===204){return J(L,M)}return O},function(P,O,N){return{text:O,exception:N.exception}})}var w=logmeonce.privacy(z);var D=w.then(function(L){return L.location?logmeonce.geolocation(window,G):f.Deferred().reject()});var x=null;f.when.apply(f,f.map([D],function(M){var L=f.Deferred();M.always(function(){L.resolve.apply(this,Array.prototype.slice.call(arguments))});return L.promise()})).always(function(L){var M={url:logmeonce.server+"rest/authenticate/"+y,type:"POST",data:z,dataType:"logmeonce-binary"};if(typeof L=="object"&&L.latitude!=null&&L.longitude!=null){M.data.latitude=L.latitude;M.data.longitude=L.longitude}if(y=="mobileconnect"&&z.code!=null&&z.state!=null){M.data.secret=sjcl.codec.base64.fromBits(sjcl.random.randomWords(8))}if(y==="qr"){M.url=logmeonce.server+"qr/login";M.dataType="json";x=sjcl.codec.base64url.fromBits(sjcl.random.randomWords(8))}f.ajax(M).then(function(N){if(y==="qr"&&N.challenge!=null){I.notify({challenge:N.challenge,secret:x});return J(logmeonce.server+"qr/wait/"+N.challenge,{wait:B}).then(function(O){if(O.event!=null){f.extend(true,v,O.event)}return O.token!=null&&O.secret!=null?f.ajax({url:logmeonce.server+"rest/authenticate",type:"POST",data:{token:O.token},dataType:"logmeonce-binary"}).then(function(R){try{var S=sjcl.codec.base64url.toBits(x);var Q=sjcl.codec.bytes.fromBits(S);var P=logmeonce.tools.decrypt(O.secret,logmeonce.tools.binary.fromBytes(Q));logmeonce.config.set("sek",logmeonce.tools.encrypt(P,R.session))}catch(T){}return R}):O})}return N},function(P,O,N){return{text:O,exception:N.exception,offline:P.readyState===0&&P.status===0}}).then(function(N){if(N.event!=null){f.extend(true,v,N.event)}if(v.id!=null&&v.mugshot&K.SuccessFrontImage){w.then(function(P){P.camera&&logmeonce.webcam(10000).then(function(Q){C(f.extend(v,{image:Q}),N.token)})})}if(y=="mobileconnect"&&z.secret!=null&&N.secret!=null){try{logmeonce.config.pcr=logmeonce.tools.decrypt(N.secret,logmeonce.tools.base64.decode(z.secret));logmeonce.config.password=null}catch(O){}delete N.secret}logmeonce.config.set("user",[z.username,y].join(","));logmeonce.config.get("logins").then(function(S){if(typeof S==="string"&&S.length>0){var R=new Date();R.setHours(0,0,0,0);R.setDate(R.getDate()-1);var P=typeof S==="string"&&S.length>0?f.map(S.split(","),function(T){return parseInt(T)||0}):[0,0];var Q=new Date(P.length>1?P[1]:0);P[0]>0&&Q.getTime()>R.getTime()&&f.ajax({url:logmeonce.server+"rest/events/login",data:{logins:P[0],time:Math.round(P[1]/1000)},beforeSend:function(T){T.setRequestHeader("Authorization","Token "+N.token)},type:"POST",dataType:"logmeonce-binary"});logmeonce.config.set("logins",null)}});if(typeof H==="string"){logmeonce.config.password=H}if(typeof A==="string"&&typeof z.id==="string"){logmeonce.config.securitykey={id:z.id,key:A}}I.resolve(N)},function(Q){if(Q.exception!=null&&Q.exception.event!=null&&Q.exception.event.id!=null&&Q.exception.event.token!=null){f.extend(true,v,Q.exception.event)}if(v.id!=null&&v.token!=null&&v.mugshot&K.FailedFrontImage){w.then(function(S){S.camera&&logmeonce.webcam(10000).then(function(T){C(f.extend(v,{image:T}))})})}if(Q.offline){var N=logmeonce.config.portable?logmeonce.config.portable:"%user%/LogmeOnce";var R=N+"/profile/"+z.username+"/user.offline";var P=N+"/profile/"+z.username+"/user.logmeonce";var O={name:z.username};logmeonce.log("Offline Mode - Loading key: "+R);logmeonce.readFile(R).then(function(S){O.keys={password:logmeonce.tools.base64.encode(S)};logmeonce.log("Offline Mode - Loading desktop mode file info: "+P);return logmeonce.getFileInfo(P)}).then(function(S){O.info=S;I.reject("You are offline.",{offline:O})},function(){I.reject("You are offline.",Q.exception)})}else{if(Q.exception!=null&&Q.exception.trigger!=null){logmeonce.loginActions(F,Q.exception).then(function(S){I.reject(Q.text,S)})}else{I.reject(Q.text,Q.exception)}}})});return I.promise()},window:function(v,A){var z=v.defaultViewEdgeFix||v.defaultView||v.parentWindow;if(z!=null&&A!=null&&A=="close"){z.onbeforeunload=null;z.close()}if(z!=null&&A!=null&&A=="top"){try{if(z.top!=null&&z.top.document!=null){return z.top}}catch(B){}}if(A!=null&&A=="tab"){return null}if(A!=null&&A=="scrollOffset"){if("pageXOffset" in z){return{scrollLeft:z.pageXOffset,scrollTop:z.pageYOffset}}else{var x=1;if(v.body.getBoundingClientRect){var y=v.body.getBoundingClientRect();var C=y.right-y.left;var w=v.body.offsetWidth;x=Math.round((C/w)*100)/100}return{scrollLeft:Math.round(v.documentElement.scrollLeft/x),scrollTop:Math.round(v.documentElement.scrollTop/x)}}}return z},findLabel:function(z,y){var v=z.ownerDocument!=null?z.ownerDocument:z;var w=y!=null&&y.cache!=null?y.cache:null;var x="",B,C,A;if(w!=null&&(A=f.grep(w.findLabel,function(D){return D.target==z})).length>0){return A[0].label}if(z.id.length>0&&(B=f("label[for='"+z.id+"']",v)).length>0){x=B.text()}else{if((C=f(z).prevAll(z.parentElement!=null&&z.parentElement.tagName=="LABEL"?":first":"label:first")).length>0){x=C.contents().filter(function(){return this.nodeType==3}).text()}else{if(z.parentElement!=null&&z.parentElement.tagName=="TD"){x=f(z.parentElement).siblings("td").filter(function(){return this.childNodes.length==1&&this.firstChild.nodeType==3}).text()}else{if(z.parentElement!=null&&z.parentElement.childNodes.length>1){x=f(z.parentElement.childNodes).filter(function(){return this.nodeType==3}).text()}}}}w!=null&&w.findLabel.push({target:z,label:x});return x},findElements:function(z,w,x){var v=z.ownerDocument!=null?z.ownerDocument:z;var y=[];if(x!=null&&x.split===true){f.each(w.split(","),function(B,A){f(A,z).each(function(C,D){y.push(D)})})}else{f(w,z).each(function(A,B){y.push(B)})}if(w=="form"&&z==v){if(f("[ng-app]",v).length>0){f("[ng-form]",v).each(function(){if(f("[ng-form]",this).length===0){var A=this;A.action="";A.elements=[];f("input, select",this).each(function(){this.lmoForm=A;A.elements.push(this)});y.push(A)}})}if(v.lmoForm==null){v.lmoForm={_attrs:{},ownerDocument:v,action:v.location.href,getAttribute:function(A){return this._attrs[A]!=null?this._attrs[A]:null},setAttribute:function(A,B){this._attrs[A]=B},submit:function(){}}}v.lmoForm.elements=[];f("input, button, select",z).each(function(B,A){if(A.form==null&&f(A).closest("[ng-form]").length<=0){v.lmoForm.elements.push(A)}});if(v.lmoForm.elements.length>0){y.push(v.lmoForm)}}if(z==v.lmoForm){f(w,v).each(function(B,A){if(f(A).closest("form").length<=0){y.push(A)}})}return y},findFormElements:function(v){return this.findElements(v,"input[type!=hidden][type!=file][type!=reset][type!=search]:enabled, select:enabled, button:enabled",{split:true})},getContentHash:function(v){var w=logmeonce.findFormElements(v);var x=f.map(w,function(y){if(typeof y.lmoUniqueId==="undefined"){y.lmoUniqueId=a(4)}return y.lmoUniqueId}).join("");return x},dispatchUiListeners:0,dispatchUiEvent:function(A,x,z,y){var v=A instanceof HTMLDocument?A:A.ownerDocument;var w=typeof y=="object"?y:f.extend({ui:"listener",type:x,url:v.location.href,target:{name:A.name,type:A.type,value:A.value}},typeof z=="object"?z:{});if(A.type=="password"&&A.lmoMasterPassword!=null){w.equalsMasterPassword=A.lmoMasterPassword}if(typeof y=="string"&&y=="detail"){return w}if(w.ui==="listener"){f("iframe[ui-listener='all'], iframe[ui-listener='"+x+"']",v).each(function(B,C){C.contentWindow.postMessage({type:"uiEvent",detail:w},"*")})}else{if(w.ui==="target"&&w.target.ui!=null){f("iframe[ui-target='"+w.target.ui+"']",v).each(function(B,C){C.contentWindow.postMessage({type:"uiEvent",detail:w},"*")})}}},dispatchEvent:function(A,x,w){var v=A.ownerDocument!=null?A.ownerDocument:A;var y=logmeonce.window(v);if(v.createEvent){if(w!=null&&w.type=="mouse"){var z=v.createEvent("MouseEvents");z.initMouseEvent(x,true,true,y,1,0,0,0,0,false,false,false,false,0,null)}else{if(w!=null&&w.type=="keyboard"){var z=v.createEvent("KeyboardEvent");if(typeof(z.initKeyboardEvent)!="undefined"){z.initKeyboardEvent(x,true,true,null,0,0,0,0,0,w.code,w.code);try{z.keyCodeVal=w.code;Object.defineProperty(z,"charCode",{get:function(){return this.keyCodeVal}});Object.defineProperty(z,"keyCode",{get:function(){return this.keyCodeVal}});Object.defineProperty(z,"which",{get:function(){return this.keyCodeVal}})}catch(z){}}else{z.initKeyEvent(x,true,true,null,0,0,0,0,w.code,0)}}else{if(w!=null&&w.type=="custom"){var z=v.createEvent("CustomEvent");if(logmeonce.browser.type=="mozilla"){z.initCustomEvent(x,false,false,JSON.stringify(w.detail))}else{z.initCustomEvent(x,false,false,w.detail)}}else{var z=v.createEvent("Events");z.initEvent(x,true,true)}}}return A.dispatchEvent(z)}else{if(v.createEventObject){var z=v.createEventObject();if(w!=null&&w.type=="custom"){z.propertyName=x;A.lmoDetail=w.detail;return A.fireEvent("onpropertychange",z)}else{try{return A.fireEvent("on"+x,z)}catch(z){return null}}}}},autofillSave:function(v,w){return f.ajax({url:this.server+"rest/autofill",data:w,type:"POST",dataType:"logmeonce-binary"}).then(function(x){return logmeonce.autofillLoad(v,x)})},autofillDelete:function(v,w){return f.ajax({url:this.server+"rest/autofill/"+w,type:"DELETE",dataType:"logmeonce-binary"}).then(function(){return logmeonce.autofillLoad(v,{remove:w})})},autofillLoad:function(v,y){if(this.config.user!=null){var x=this.config.user.autofill;var w=f.grep(x.mapping,function(A,z){if(A.id==y.remove){x.mapping.splice(z,1);return true}if(A.id==y.id){f.extend(true,x.mapping[z],y);return true}});w.length<=0&&y.id!=null&&x.mapping.push(y);return f.Deferred().resolve(y)}return f.Deferred().reject()},autofill:{mapping:{login:["username","password"],profile:["firstname","lastname","fullname","email","birthdate","age"],address:["city","country","state","address","zip","location"],phone:["phone"],company:["company","jobtitle","website"],cards:["card-name","card-number","card-month","card-year","card-code","card-issuer","card-type"]}},mappingSelector:function(v){if(v.id!=null&&v.id.length>0){return"#"+v.id}if(v.name!=null&&v.name.length>0){return v.tagName+"[name="+v.name+"]"}return null},attachAutofillMappingEvent:function(w,v){this.attachEvent(w,"lmoEvent",function(D){if(D.name=="mapping"&&D.remove!=null){var E=w.ownerDocument;var z=f.grep(logmeonce.config.user.autofill.mapping,function(H){return logmeonce.regex.test(E.location.href,H.url,"i")&&f.grep(logmeonce.findElements(E,H.element),function(I){return I==w}).length>0}).shift();z!=null&&logmeonce.autofillDelete(E,z.id).then(function(H){logmeonce.detachFocusEvent(w);logmeonce.detachIconEvent(w);logmeonce.inputUnmark(w);logmeonce.injectFormTools(E)})}if(D.name=="mapping"&&D.mapping!=null){var E=w.ownerDocument;var B=logmeonce.mappingSelector(w);if(B==null){return}var F=D.mapping;var A=f.grep(Object.keys(logmeonce.autofill.mapping),function(H){return f.inArray(F,logmeonce.autofill.mapping[H])>=0}).shift();if(f.inArray(A,["profile","address","phone","company","cards"])>=0&&logmeonce.config.user[A].length>0){if(F==="company"){F="name"}if(F==="phone"){F="number"}if(F.indexOf("card-")===0){F=F.substring(5)}var C=0;var G=logmeonce.config.user[A][C][F];if(typeof G==="string"&&A=="cards"){try{G=logmeonce.decrypt(E,G)}catch(D){G=null}}if(typeof G==="string"||typeof G==="number"){logmeonce.inputFill(w,G,{events:false,filled:true})}if(G!=null&&typeof G==="object"&&typeof G.name==="string"){logmeonce.inputFill(w,G.name,{events:false,filled:true})}if(G!=null&&typeof G==="object"&&typeof G.number==="string"){logmeonce.inputFill(w,G.cc!=null?"+"+G.cc+G.number:G.number,{events:false,filled:true})}}if(F.indexOf("note-")==0){var y=F.substring(5);if(y==="site"){var x=f.grep(logmeonce.config.user.sites,function(H){return(H.login.regex!=null&&logmeonce.regex.test(E.location.href,H.login.regex,"i"))||(H.login.url!=null&&H.login.url.indexOf("http")===0&&logmeonce.regex.test(E.location.href,logmeonce.regex.url(H.login.url),"i"))}).shift();x!=null&&x.note!=null&&logmeonce.notes(E,{id:x.note,decrypt:true}).then(function(H){H!=null&&H.body!=null&&logmeonce.inputFill(w,H.body,{events:false,filled:true})})}else{logmeonce.notes(E,{limit:1,category:y,decrypt:true}).then(function(H){H.length>0&&H[0].body!=null&&logmeonce.inputFill(w,H[0].body,{events:false,filled:true})})}}var z=f.grep(logmeonce.config.user.autofill.mapping,function(H){return logmeonce.regex.test(E.location.href,H.url,"i")&&f.grep(logmeonce.findElements(E,H.element),function(I){return I==w}).length>0}).shift();logmeonce.autofillSave(E,{id:z!=null?z.id:undefined,name:D.mapping,url:E.location.href,element:B}).then(function(H){logmeonce.injectFormTools(E);if(A==="login"){logmeonce.pageLoaded(E)}})}})},attachPasswordGenerateEvent:function(B,z,y){var A=f.extend({injectEvent:"lmoFocus",passwordViewed:null},y||{});var v=B.ownerDocument;var x=this.config.user==null||this.config.user.settings.flags&2;var w=null;var C=false;if(typeof A.injectEvent==="string"&&x){this.attachEvent(B,A.injectEvent,function(E){if(v.lmoPasswordChanging!=null&&new Date().getTime()-v.lmoPasswordChanging<=200){return}var D=g(B);w={x:D.left+D.width/2,y:D.top+D.height/2};C=B==v.elementFromPoint(w.x,w.y);logmeonce.injectPasswordGenerateUi(v,this)})}this.attachEvent(B,"lmoEvent",function(D){if(D.name=="pwdgen"&&D.args.password!=null){setTimeout(function(){if(B.style.display=="none"&&C){var E=v.elementFromPoint(w.x,w.y);if(B!=E){logmeonce.dispatchEvent(E,"click",{type:"mouse"})}}B.lmoFocusLast=new Date().getTime();B.focus();setTimeout(function(){if(typeof z=="function"){z.call(B,{password:D.args.password})}else{if(z===true){logmeonce.inputFill(B,D.args.password,{filled:false})}}if(D.args.pwdgen==true){logmeonce.passwordGenerated(B.ownerDocument,D.args.password)}},10)},0)}else{logmeonce.handleDefaultEvent(D)}})},detachFocusEvent:function(w,v){if(w.lmoFocusEvent==null){return}this.detachEvent(w,"focus",w.lmoFocusEvent,v);this.detachEvent(w,"mousedown",w.lmoFocusEvent,v);w.lmoFocusEvent=null},attachFocusEvent:function(x,w,v){this.detachFocusEvent(x,v);this.detachIconEvent(x,v);x.lmoFocusLast=0;x.lmoFocusEvent=function(z){if(z.type=="focus"&&z.relatedTarget==null){return}var y=new Date().getTime();var A=y-z.target.lmoFocusLast;z.target.lmoFocusLast=y;if(((z.type=="mousedown"&&z.button==0)||z.type=="focus")&&A>1000){w.call(z.target,z)}};x.setAttribute("autocomplete","off");this.attachEvent(x,"focus",x.lmoFocusEvent,v);this.attachEvent(x,"mousedown",x.lmoFocusEvent,v);if(this.config.user!=null&&this.config.user.settings.flags&2048){this.attachIconEvent(x,null,v)}},detachIconEvent:function(w,v){if(w.lmoIconEvents==null){return}f.each(w.lmoIconEvents,function(x,y){logmeonce.detachEvent(w,x,y,v)});f(w).css({"background-image":"","background-position":"","background-repeat":"","background-size":""});w.lmoIconEvents=null},attachIconEvent:function(A,y,v){if(this.attachIconEvent.defaults==null){this.attachIconEvent.defaults={init:null,iconOn:null,iconOff:null};this.attachIconEvent.defaults.init=f.when.apply(f,[this.include("/skin/icon_on.png",true,true).then(function(C){logmeonce.attachIconEvent.defaults.iconOn=logmeonce.tools.base64.encode(C)}),this.include("/skin/icon_off.png",true,true).then(function(C){logmeonce.attachIconEvent.defaults.iconOff=logmeonce.tools.base64.encode(C)})])}if(this.attachIconEvent.defaults[y!==false?"iconOn":"iconOff"]==null){this.attachIconEvent.defaults.init.then(function(){logmeonce.attachIconEvent(A,y,v)});return}if(typeof y==="function"){this.detachFocusEvent(A,v);this.detachIconEvent(A,v)}var z={"background-image":'url("data:image/png;base64,'+this.attachIconEvent.defaults[y!==false?"iconOn":"iconOff"]+'")',"background-position":"97% 49%","background-repeat":"no-repeat","background-size":"16px 16px"};var B=false;var x=f(A).css(z);var w=A.lmoIconEvents={};if(typeof y==="function"){this.attachEvent(A,"mousemove",w.mousemove=function(D){var C=D.offsetX>this.clientWidth*0.97-16;if(B!=C){z.cursor=B=C?"pointer":"";x.css(z)}},v);this.attachEvent(A,"click",w.click=function(D){var C=D.offsetX>this.clientWidth*0.97-16;C&&y.call(A,D)},v)}},detachEvent:function(y,w,x,v){if(y.removeEventListener){y.removeEventListener(w,x,v!=null&&v.useCapture==true)}else{y.detachEvent("on"+w,x)}},attachEvent:function(A,x,z,w){if(A.ownerDocument!=null&&A==A.ownerDocument.lmoForm){return}if(x=="lmoFocus"){return this.config.user!=null&&this.config.user.settings.flags&4096?this.attachIconEvent(A,z,w):this.attachFocusEvent(A,z,w)}var v=A.ownerDocument!=null?A.ownerDocument:A;if(v.all&&v.documentMode<=8){z=function(B){return function(C){C.target=C.srcElement;return B.apply(this,arguments)}}(z)}if(f.inArray(x,["lmoEvent","lmoUIEvent"])>=0){z=function(B){return function(D){var C=typeof D.detail=="string"?JSON.parse(D.detail):D.detail;return B.call(this,x=="lmoEvent"?f.extend(C,{target:A}):C)}}(z)}var y=A.lmoEvents||{};f.each(x.split(" "),function(C,B){var D=y[B]||[];for(var C=D.length-1;C>=0;C--){if(D[C].toString()==z.toString()||(w!=null&&w.detaching===true&&w.force===true)){if(w==null||w.detaching==null||w.detaching==true){logmeonce.detachEvent(A,B,D[C],w)}D.splice(C,1)}}if(A.addEventListener){A.addEventListener(B,z,w!=null&&w.useCapture==true)}else{if(f.inArray(B,["lmoEvent","lmoUIEvent"])>=0){A.attachEvent("onpropertychange",function(E){if(E.propertyName!=null&&E.propertyName==B){z.call(A,{detail:E.srcElement.lmoDetail})}})}else{A.attachEvent("on"+B,z)}}y[B]=D.concat([z])});A.lmoEvents=y},handleDefaultEvent:function(B){if(B.name=="pwdgen"){var x=B.target.form||B.target.lmoForm||document.lmoForm;var y=0,C=[],E=[];f.each(x.elements,function(G,F){if(F==B.target){y=G}});for(var z=0;z<x.elements.length;z++){if(y+z<x.elements.length){var A=x.elements[y+z];if(A.tagName=="INPUT"&&A.type=="password"&&l(A)){C.push(A)}else{if(C.length>0){break}}}if(y-z>=0){var A=x.elements[y-z];if(A.tagName=="INPUT"&&A.type=="password"&&l(A)){E.push(A)}else{if(E.length>0){break}}}}f.each(C.concat(E),function(F,G){logmeonce.inputFill(G,B.args.password,{filled:false})});return}if(B.name=="fill"&&f.inArray(B.args.fill,["profile","address","phone","company","card"])>=0){var x=B.target.form||B.target.lmoForm||document.lmoForm;var D=B.args.fill==="card"?"autofill-cards":"autofill-profile";var A=f.grep(x.elements,function(F){return F.lmoType===D}).shift();if(A!=null){logmeonce.dispatchEvent(A,"lmoEvent",{type:"custom",detail:B})}else{var v=logmeonce.findElements(B.target.ownerDocument,"form");f.each(v,function(G,H){var F=f.grep(H.elements,function(I){return I.lmoType===D}).shift();if(F!=null){logmeonce.dispatchEvent(F,"lmoEvent",{type:"custom",detail:B});return false}})}}if(B.name=="login"&&B.target.tagName=="INPUT"){var x=B.target.form||B.target.lmoForm||document.lmoForm;var w=f.grep(logmeonce.config.user!=null?logmeonce.config.user.sites:[],function(F){return F.id==B.site}).shift();if(w!=null&&B.action=="totp"){if(logmeonce.fillTOTP(B.target,w)){x.lmoAction={name:"skip"}}}else{if(w!=null&&(B.action=="username"||(B.action==null&&f.inArray(B.target.type,["text","email"])>=0))){if(logmeonce.fillUsername(B.target,w)){x.lmoAction={name:"skip"}}}else{if(w!=null&&(B.action=="password"||(B.action==null&&B.target.type=="password"))){if(logmeonce.fillPassword(B.target,w)){x.lmoAction={name:"skip"}}}}}}},enable:function(v,x){var w=this;var z=this.config.user==null;for(var y=this.config.loginList.length-1;y>=0;y--){if(f.grep(x.sites,function(C,B){return C.id==w.config.loginList[y].id}).length<=0){this.loginList("remove",this.config.loginList[y])}}this.config.user=x;this.browser.setIcon(true,false);if(z){this.log("Enabled");this.reloadWindows(logmeonce.tools.parseUri(logmeonce.server).host,{skip:v});this.reloadWindows("about:newtab",{skip:v})}if(x.session!=null&&(this.session==null||this.config.session.id!=x.session)){var A=this.translate;this.config.session.id=x.session;this.config.session.idle=new Date().getTime();this.config.session.handled=new Date().getTime();this.config.session.refresh=new Date().getTime()+(20*60*1000),this.config.session.autologout=x.autologout*1000;if(this.session!=null){this.session.stop()}this.session={lastInvoked:new Date().getTime(),start:function(){this.stop();this.interval=setInterval(function(){logmeonce.session.invoke.call(logmeonce)},1000);logmeonce.log("Session - Start - Next refresh in "+logmeonce.translate.duration((logmeonce.config.session.refresh-new Date().getTime())/1000));if(logmeonce.config.session.autologout>0){logmeonce.log("Autologout - Start - Next refresh in "+logmeonce.translate.duration((logmeonce.config.session.handled+logmeonce.config.session.autologout-new Date().getTime())/1000))}},stop:function(){if(this.interval!=null){clearInterval(this.interval)}this.interval=null},invoke:function(){if(this.config.session.autologout>0){if(this.config.session.idle+logmeonce.config.session.autologout<new Date().getTime()){this.log("Autologout - Session Expired - Idle for: "+this.translate.duration((new Date().getTime()-this.config.session.idle)/1000)+"  (Autologout: "+this.translate.duration(logmeonce.config.session.autologout/1000)+")");this.logout(A._("Session Expired")+". "+A._("Please login again")+".");return}if(this.config.session.handled+this.config.session.autologout<new Date().getTime()||this.session.lastInvoked+(120*1000)<new Date().getTime()){this.config.session.handled=new Date().getTime();if(this.session.lastInvoked+(120*1000)<new Date().getTime()){this.log("Autologout - Hibernation detected - last invoked: "+((new Date().getTime()-this.session.lastInvoked)/1000)+" secs ago")}f.ajax({url:this.server+"rest/authenticate/session/",data:{handle:"true"},dataType:"logmeonce-binary"}).then(function(E){if(E.session!=null&&E.session===false){logmeonce.log("Autologout - Logging out - Session Expired");logmeonce.disable(null,A._("Session Expired")+". "+A._("Please login again")+".")}else{logmeonce.log("Autologout - Refreshing")}},function(G,F,E){if(E.exception!=null){logmeonce.log("Autologout - Logging out - "+E.exception.message);logmeonce.disable(null,E.exception.message)}else{logmeonce.log("Autologout - Refreshing failed: "+F)}})}}if(this.config.session.refresh<new Date().getTime()){this.config.session.refresh=new Date().getTime()+(20*60*1000);f.ajax({url:this.server+"rest/authenticate/session/",dataType:"logmeonce-binary"}).then(function(){logmeonce.log("Session - Refreshing")},function(G,E,F){logmeonce.log("Session - Refreshing failed - Status: "+E+" "+(F!=null?"("+F+")":""))})}var C="";if(this.config.session.autologout>0){var B=((this.config.session.idle+this.config.session.autologout)-new Date().getTime())/1000;var D=((this.config.session.handled+this.config.session.autologout)-new Date().getTime())/1000;C+="Autologout in "+B+" sec - Autorefresh in "+D+" sec"}else{C+="Autologout disabled "}this.session.lastInvoked=new Date().getTime()}};this.session.start()}},disable:function(w,y){var v=this.config.loginList;if(this.session!=null){this.session.stop()}this.session=null;this.passwordEvent=null;if(this.config.user!=null){this.config.user=null;this.config.set("sek",null);this.config.password=null;this.config.pcr=null;this.config.loginList=[];this.config.logoutList=[];this.config.cookieList={};this.reloadWindows(this.tools.parseUri(this.server).host,{skip:w});this.reloadWindows("about:newtab",{skip:w});if(v.length>0){var z=function(B,A){f.each(A,function(C,D){if(f.grep(B,function(F,E){return F.host==D.host&&F.path==D.path}).length<=0){B.push(D)}});return B};var x=[];f.each(v,function(B,A){if((A.flags&r)==r){x=z(x,logmeonce.siteLogout(A,{reload:false,cookies:false}))}});f.each(x,function(A,B){logmeonce.removeCookies(B)});setTimeout(function(){f.each(x,function(A,B){logmeonce.reloadWindows(B.host)})},500)}this.log("Disabled");this.browser.setIcon(false,false)}if(y!=null){setTimeout(function(){logmeonce.injectUi(w,{name:"message",args:[y]})},500)}},copyToClipboard:function(x){var y=f.extend({text:null,passwordViewed:null},typeof x=="string"?{text:x}:x);var v=f.Deferred();if(y.text!=null){var w=document.createElement("textarea");w.value=y.text;document.body.appendChild(w);w.select();try{var A=document.execCommand("copy");A&&v.resolve()}catch(z){}document.body.removeChild(w);if(v.state()!=="resolved"&&this.plugin!=null){try{this.plugin.copyToClipboard(y.text);v.resolve()}catch(z){}}v.state()!=="resolved"&&v.reject()}else{v.resolve()}return v.then(function(){typeof y.passwordViewed==="number"&&f.ajax({url:logmeonce.server+"rest/events/password-viewed",data:{site:y.passwordViewed,action:"clipboard"},dataType:"logmeonce-binary",type:"POST"})})},removeCookies:function(v){try{if(this.plugin!=null){var x=this.plugin;var w=v.host.toLowerCase();w=w.length>1&&w.indexOf(".")<=0?w.substring(w.indexOf(".")+1,w.length):w;while(w.split(".").length>1){x.GetValueForURL("https://"+w+"/").then(function(z){return function(A){f.each(A.length>0?A.split(";"):[],function(E,D){var C=D.split("=");var B=C[0].replace(/^\s+|\s+$/g,"");x.SetValueForURL("https://"+z+"/",B+"=;Expires=Thu, 01-Jan-1970 00:00:01 GMT");x.SetValueForURL("https://"+z+"/",B+"=;Expires=Thu, 01-Jan-1970 00:00:01 GMT;Domain=."+z)})}}(w));w=w.substring(w.indexOf(".")+1,w.length)}}}catch(y){this.log("Remove Cookies error: "+y)}},reloadWindows:function(v){},urlGoto:function(w,v){if(w=="about:newtab"){w=this.includeUrl("about:newtab")}else{if(w.indexOf("/")===0){w=this.config.user!=null&&this.config.user.console===true?logmeonce.server+"console"+w:logmeonce.server+w.substr(1)}}return w},siteLogout:function(y,x){var w=this;if(typeof y=="number"||typeof y=="string"){f.each(this.config.loginList,function(A,z){if(z.id==y){w.siteLogout(z,x);return false}})}else{if(typeof y=="object"){var v=[];f.each(y.hosts,function(z,D){var E=[];var G=D.split(".");var C=2;for(var B=G.length-1;B>=0&&C>0;B--,C--){if(G[B]=="com"||G[B]=="net"||G[B]=="org"||(G[B]=="co"&&G[G.length-1]=="uk")){C=2}E.push(G[B])}E="."+E.reverse().join(".");if(f.grep(v,function(I,H){return I.host.indexOf(E)>=0}).length<=0){v.push({host:E,path:"/"})}if(D.length>E.length){var F="";var A=D.replace(E,"").split(".");for(var B=A.length-1;B>=0;B--){F="."+A[B]+F;if(f.grep(v,function(I,H){return I.host.indexOf(F+E)>=0}).length<=0){v.push({host:F+E,path:"/"})}}}});f.each(y.cookies,function(z,A){if(f.grep(v,function(C,B){return(C.host.indexOf(A.host)>=0||C.host.indexOf("."+A.host)>=0)&&C.path.indexOf(A.path)>=0}).length<=0){v.push({host:A.host,path:A.path})}});f.each(v,function(A,B){var C=logmeonce.tools.ltrim(B.host,".");var z=f.grep(logmeonce.config.logoutList,function(D){return D.host==C}).shift();if(z!=null){z.time=new Date().getTime();logmeonce.logoutList("update",z)}else{logmeonce.logoutList("add",{host:C,time:new Date().getTime()})}});if(x==null||x.cookies==null||x.cookies==true){f.each(v,function(z,A){w.removeCookies(A)})}if(x==null||x.reload==null||x.reload==true){setTimeout(function(){f.each(v,function(z,A){w.reloadWindows(A.host)})},500)}if(y.id!=null&&y.id>=0){f.ajax({url:logmeonce.server+"rest/events/logout/",data:{site_id:y.id},dataType:"logmeonce-binary",type:"POST"})}return v}}},includeUrl:function(v){throw new j("Not Implemented")},include:function(A,y,w){var v=f.Deferred();var C=typeof y=="boolean"?y:false;var z=typeof w=="boolean"?w:false;if(this.includeCache==null){this.includeCache={}}if(this.includeCache!=null&&this.includeCache[A]!=null){return z?v.resolve(this.includeCache[A]).promise():this.includeCache[A]}var B=new XMLHttpRequest();B.open("GET",this.includeUrl(A),z);B.onload=z?function(D){if(B.readyState===4){if(B.status==0||B.status==200){v.resolve(C?B.response:B.responseText)}else{v.reject(B.statusText)}}}:null;if(C){if(z&&typeof ArrayBuffer==="function"&&logmeonce.browser.type!=="edge"){B.responseType="arraybuffer"}else{B.overrideMimeType("text/plain; charset=x-user-defined")}}B.send(null);if(z){return v.promise()}var x=B.status==0||B.status==200?B.responseText:null;return C?x:this.includeCache[A]=x},includeCss:function(w,B){if(this.includeCache!=null&&this.includeCache[w]!=null){return this.includeCache[w]}var z=this.include(w,true);var v=new RegExp("url\\(images/[^)]+\\)","g");var y=null;while((y=v.exec(z))!=null){var D=y[0].substring(y[0].indexOf("images")).replace("(","").replace(")","");var C=D.substring(D.lastIndexOf(".")+1);if(B!=null&&B.absoluteImagePath!=null){z=z.replace(new RegExp(D,"g"),B.absoluteImagePath+D)}else{var x=null;try{x=this.include("/skin/"+D,true)}catch(A){}if(x!=null){z=z.replace(new RegExp(D,"g"),"data:image/"+C+";base64,"+logmeonce.tools.base64.encode(x).replace(new RegExp("\n","g"),""))}else{z=z.replace(new RegExp(D,"g"),"''")}}}return this.includeCache[w]=z},injectUiReady:function(x){var w=f.Deferred();var v=x.getElementsByTagName("frameset");if(v.length>0&&v[0].getElementsByTagName("frame").length>0){var z=[],A=v[0].getElementsByTagName("frame");for(var y=0;y<A.length;y++){if(A[y].contentWindow.document.readyState!="complete"&&A[y].contentWindow.document.readyState!="interactive"){A[y].contentWindow.document.addEventListener("DOMContentLoaded",function(){w.resolve(x)},false);return w.then(function(B){return logmeonce.injectUiReady(B)}).promise()}z.push(logmeonce.injectUiReady(A[y].contentWindow.document))}return f.when.apply(f,z).then(function(){return Array.prototype.slice.call(arguments).sort(function(C,B){return f(B).width()*f(B).height()-f(C).width()*f(C).height()}).shift()})}else{w.resolve(x)}return w.promise()},injectPasswordManagerUi:function(v){return this.injectUi(v,{name:"password-manager",args:[{id:this.config.passwordManager.form.id,never:this.config.user!=null,groups:this.config.user!=null&&this.config.passwordManager.form.id==null?this.groups():null,url:this.tools.parseHost(this.config.passwordManager.form.url),username:this.config.passwordManager.form.username}]})},injectSiteSelectUi:function(v,y,x,w){var x=x!=null?logmeonce.injectUiTarget(x):null;return this.injectUi(v,{name:"site-select",target:x!=null?x.ui:null,top:x==null,args:[f.extend({target:x,sites:f.map(y,function(z){var B=f.grep(z.login.inputs,function(C){return C.flags!=null&&C.flags&e}).shift();if(B!=null&&B.value!=null){try{B=logmeonce.tools.decrypt(B.value,logmeonce.aesKey(v,false,z))}catch(A){B=null}}return{id:z.id,name:z.name,username:typeof B==="string"?B:"",icon:z.icon,note:z.note,flags:z.flags,allowed:{"delete":logmeonce.allowed(z,"delete")},inputs:f.grep(z.login.inputs,function(C){return f.inArray(C.type,["radio","checkbox"])<0&&(z.privileges==null||z.privileges&2||C.mapping===3)})}}),user:{desktopmode:this.config.user.flags&4096,license:this.config.user.license,owner:this.config.user.owner}},typeof w==="object"?w:{})]})},injectPasswordFillUi:function(v,x,w){var w=logmeonce.injectUiTarget(w);return this.injectUi(v,{name:"password-fill",target:w.ui,top:false,args:[{target:w,sites:f.map(x,function(y){return{id:y.id,name:y.name,icon:y.icon,note:y.note,allowed:{"delete":logmeonce.allowed(y,"delete")},inputs:f.grep(y.login.inputs,function(z){return f.inArray(z.type,["radio","checkbox"])<0&&(y.privileges==null||y.privileges&2||z.mapping===3)})}}),user:{desktopmode:this.config.user.flags&4096,license:this.config.user.license,owner:this.config.user.owner}}]})},injectAutofillMappingUi:function(v,x){var w=f.grep(logmeonce.config.user.autofill.mapping,function(y){return logmeonce.regex.test(v.location.href,y.url,"i")&&f.grep(logmeonce.findElements(v,y.element),function(z){return z==x}).length>0}).shift();var x=logmeonce.injectUiTarget(x);return this.injectUi(v,{name:"autofill-mapping",target:x.ui,top:false,args:[{target:x,mapped:w!=null?w.name:null}]})},injectPasswordGenerateUi:function(v,w){var w=logmeonce.injectUiTarget(w);return this.injectUi(v,{name:"password-generate",target:w.ui,top:false,args:[{target:w}]})},injectAutofillCardsUi:function(v,x,w){var w=logmeonce.injectUiTarget(w);return this.injectUi(v,{name:"autofill-cards",target:w.ui,top:false,args:[{target:w,cards:f.map(x,function(y){var z=f.extend({},y);return f.each(z,function(A,B){try{z[A]=f.inArray(A,["id","color"])<0?logmeonce.decrypt(v,B):B}catch(C){delete z[A]}})})}]})},injectAutofillProfileUi:function(v,w,x){var x=logmeonce.injectUiTarget(x);return this.injectUi(v,{name:"autofill-profile",target:x.ui,top:false,args:[f.extend({target:x},w)]})},injectVerificationUi:function(v,x){var w=x!=null&&x.user!=null?x.user:this.config.user;var y=f.extend({password:w!=null&&w.keys.password!=null,"security-question":w!=null&&w.keys.question!=null?w.recovery.question:false,mobileconnect:w!=null&&w.keys.mobileconnect!=null,},x||{});this.config.get("user").then(function(A){var z=A!=null&&A.length>0?A.split(","):[];y.authentication=z.length>1&&y[z[1]]!==false?z[1]:"password";if(y.mobileconnect&&y.authentication=="mobileconnect"){y.mobileconnect=z[0]}logmeonce.injectUi(v,{name:"verification",args:[y]})},function(){logmeonce.injectUi(v,{name:"verification",args:[y]})})},injectUiTarget:function(z){if(f.isPlainObject(z)){return z}if(z instanceof HTMLElement&&z.getAttribute("lmoName")==null){z.setAttribute("lmoName",a(10))}var v=z.ownerDocument;var y=logmeonce.window(v);var x=g(z);var w=z.getAttribute("lmoName");this.attachEvent(z,"blur",function(A){logmeonce.dispatchUiEvent(A.target,"lmoBlur",{ui:"target",target:{ui:w}})});this.attachEvent(z,"keydown",function(A){logmeonce.dispatchUiEvent(A.target,"lmoKeydown",{ui:"target",target:{ui:w}})});z.lmoInterval!=null&&clearInterval(z.lmoInterval);z.lmoLeft=x.x;z.lmoTop=x.y;z.lmoInterval=setInterval(function(){if(z.style.display=="none"||!v.body.contains(z)){clearInterval(z.lmoInterval);logmeonce.dispatchUiEvent(z,"lmoClose",{ui:"target",target:{ui:w}})}var A=g(z);var C=y==y.top?A.x:Math.max(0,A.x);var B=y==y.top?A.y:Math.max(-A.height,A.y);if(C!=z.lmoLeft||B!=z.lmoTop){z.lmoLeft=C;z.lmoTop=B;logmeonce.dispatchUiEvent(z,"lmoPosition",{ui:"target",target:{ui:w,scroll:0,left:C,top:B,width:A.width,height:A.height}})}},250);return{ui:w,scroll:0,left:x.x,top:x.y,width:x.width,height:x.height,type:z.type}},injectUiEvents:{target:function(v,x){var w=v.querySelector("input[lmoName='"+x.target+"']");if(v.createEvent){var y=v.createEvent("CustomEvent");y.initCustomEvent("lmoEvent",false,false,x);w.dispatchEvent(y)}else{var y=v.createEventObject();y.propertyName="lmoEvent";w.lmoDetail=x;w.fireEvent("onpropertychange",y)}},translate:function(v,w){return logmeonce.translate._.apply(logmeonce.translate,w.args)},open:function(A,z){if(z.dialog.modal!==false){var x=z.dialog.modal;var D=Math.max(A.body.scrollHeight,A.documentElement.scrollHeight);if(x>f(window).height()+1){this.style.top="0px";this.style.height=Math.max(D,x)+"px";this.style.position="absolute"}else{this.style.top="0px";this.style.height="100%";this.style.position="fixed"}if(A.hasFocus()&&A.activeElement!=A.body){A.body.focus()}}else{var C=logmeonce.window(A,"scrollOffset");var B=C.scrollTop+z.dialog.top;var v=C.scrollLeft+z.dialog.left;this.style.top=B+"px";this.style.left=v+"px";this.style.width=(z.dialog.width+1)+"px";this.style.height=(z.dialog.height+1)+"px";this.style.position="absolute";var w=f(this).offset();if(w.top!=B){this.style.top=(B-(w.top-B))+"px"}if(w.left!=v){this.style.left=(v-(w.left-v))+"px"}if(window!=window.top&&w.top+z.dialog.height>f(window).height()){A.body.style.overflow="auto"}}var y;if(this.getAttribute("ui-target")!=null&&(y=A.querySelector("input[lmoName='"+this.getAttribute("ui-target")+"']"))!=null&&y.style.display=="none"){A.body.removeChild(this)}else{this.style.visibility="visible"}},resize:function(v,w){this.style.width=(w.dialog.width+1)+"px";this.style.height=(w.dialog.height+1)+"px"},drag:function(w,z){if(z.drag=="start"){this.style.top=0;this.style.left=0;this.style.width="100%";this.style.height="100%";this.style.position="fixed"}else{if(z.drag=="stop"){var v=logmeonce.window(w,"scrollOffset");var y=v.scrollTop+z.dialog.top;var x=v.scrollLeft+z.dialog.left;this.style.top=y+"px";this.style.left=x+"px";this.style.width=(z.dialog.width+1)+"px";this.style.height=(z.dialog.height+1)+"px";this.style.position="absolute";var A=f(this).offset();if(A.top!=y){this.style.top=(y-(A.top-y))+"px"}if(A.left!=x){this.style.left=(x-(A.left-x))+"px"}}}return true},move:function(w,z){var v=logmeonce.window(w,"scrollOffset");var y=v.scrollTop+z.dialog.top;var x=v.scrollLeft+z.dialog.left;this.style.top=y+"px";this.style.left=x+"px"},close:function(v,w){v.body.removeChild(this)},change:function(v,A){var y=logmeonce.window(v,"tab");var w=logmeonce.browser.type=="mozilla"||logmeonce.browser.type=="safari";var x=this;var z={config:logmeonce.config,injectUi:function(B,E,C){var D={args:E.args,changing:E.name};if(w){logmeonce.injectScript(x.contentWindow.document,{src:"/ui/"+E.name+".js"}).then(function(){x.contentWindow.postMessage({init:D},"*")})}else{x.contentWindow.postMessage({init:D},"*")}}};if(A.change==="password-generate"){logmeonce.injectPasswordGenerateUi.call(z,v,A.target)}else{if(A.change==="site-select"){logmeonce.injectSiteSelectUi.call(z,v,f.grep(logmeonce.config.user.sites,function(B){return(B.login.regex!=null&&logmeonce.regex.test(v.location.href,B.login.regex,"i"))&&f.grep(B.login.inputs,function(C){return C.type=="password"}).length>0}),A.target)}else{if(A.change==="autofill-profile"){logmeonce.injectAutofillProfileUi.call(z,v,{profiles:logmeonce.config.user.profile,addresses:logmeonce.config.user.address,phones:logmeonce.config.user.phone,companies:logmeonce.config.user.company},A.target)}else{if(A.change==="autofill-cards"){logmeonce.injectAutofillCardsUi.call(z,v,logmeonce.config.user.cards,A.target)}}}}}},injectUi:function(w,A){var y=logmeonce.window(w,"tab");var A=f.extend({id:Math.round(Math.random()*1000000),listener:null,target:null,top:true,tab:y.id,frame:0},A||{});var x=logmeonce.browser.type=="mozilla"||logmeonce.browser.type=="safari";var z=f.grep(["/skin/jquery-ui-1.9.2.css","/skin/jquery-ui-logmeonce.css","/skin/fontawesome-all.min.css","/skin/ui.css"],function(B){return B!=null});var v=f.grep(["/components/jquery-1.8.3.min.js","/components/jquery-ui-1.9.2.min.js","/components/sjcl.js","/components/creditcards.js","/components/ui.js","/content/translate.js","/content/tools.js","/ui/"+A.name+".js"],function(B){return B!=null});return this.injectUiReady(w).then(function(D){var H=logmeonce.window(D);var C=logmeonce.window(D,"scrollOffset");var E="ui-logmeonce-"+A.name;var F=f("iframe[name="+E+"]",D.body).get(0);function G(K){if(K.name!=null&&K.name==A.id){var J=K.args;if(typeof logmeonce.injectUiEvents[J.ui]==="function"){var I=logmeonce.injectUiEvents[J.ui].call(F,D,J,A);typeof I!=="undefined"&&logmeonce.fireEventResponse(D,K,I)}}}if(F!=null){logmeonce.attachEvent(F,"lmoUIEvent",G,{detaching:false});if(A.target!=null){f(F).attr("ui-target",A.target)}if(A.id!=null){f(F).attr("ui-id",A.id)}return f.Deferred().resolve(F.contentWindow)}else{var B=f.Deferred();var F=f("<iframe class='ui-logmeonce' scrolling='no' allowTransparency='true' frameBorder='0' type='chrome'></iframe>",D).attr("name",E).attr("srcdoc",logmeonce.browser.type==="mozilla"?"<!DOCTYPE html><html><head></head></html>":null).attr("src",!x?logmeonce.includeUrl("ui.html"):null).css({display:"block",visibility:"hidden",position:"fixed",top:C.scrollTop+"px",left:"0",width:"100%",height:"100%",zIndex:"2147483647",border:"0"}).get(0);logmeonce.attachEvent(F,"lmoUIEvent",G,{detaching:false});if(A.listener!=null){f(F).attr("ui-listener",A.listener)}if(A.target!=null){f(F).attr("ui-target",A.target)}if(A.id!=null){f(F).attr("ui-id",A.id)}f(F).one("load",function(I){if(x&&F.contentWindow.document.doctype==null){try{F.contentWindow.document.open("text/html","replace");F.contentWindow.document.write("<!DOCTYPE html><html><head></head></html>");F.contentWindow.document.close();B.resolve(F.contentWindow)}catch(I){B.resolve(F.contentWindow)}}else{B.resolve(F.contentWindow)}}).appendTo(D.body);return B.promise()}}).then(function(C){var D={id:A.id,tab:A.tab,frame:A.frame,key:logmeonce.config.ui,args:A.args,logmeonce:{server:logmeonce.server,config:{user:logmeonce.config.user!=null?{license:logmeonce.config.user.license}:null},browser:{type:logmeonce.browser.type}}};if(x&&C.lmoUiLoaded!==true){var B=C.document.getElementsByTagName("head")[0];var E=[];f.each(z,function(F,G){E.push(logmeonce.injectStyle(C.document,{href:G,head:B}))});f.each(v,function(G,F){E.push(logmeonce.injectScript(C.document,{src:F,head:B}))});f.when.apply(f,E).then(function(){C.lmoUiLoaded=true;C.postMessage({init:D},"*")})}else{C.postMessage({init:D},"*")}})},injectStyle:function(w,x){var v=f.Deferred();var z=f.extend({inline:false,head:null,href:null,text:""},typeof x=="string"?{href:x}:x);if(z.head==null){z.head=w.getElementsByTagName("head")[0]}if(z.inline||z.text.length>0){var y=w.createElement("style");y.setAttribute("type","text/css");if(w.all&&w.documentMode<=8){y.styleSheet.cssText=z.text.length>0?z.text:this.includeCss(z.href)}else{y.appendChild(w.createTextNode(z.text.length>0?z.text:this.includeCss(z.href)))}z.head.appendChild(y);return v.resolve().promise()}else{var y=w.createElement("link");y.setAttribute("rel","stylesheet");y.setAttribute("type","text/css");y.setAttribute("href",this.includeUrl(z.href));y.onload=function(){v.resolve()};z.head.appendChild(y);return v.promise()}},injectScript:function(w,x){var v=f.Deferred();var A=f.extend({inline:false,head:null,src:"",text:""},typeof x=="string"?{src:x}:x);if(A.head==null){A.head=w.getElementsByTagName("head")[0]}var z=w.createElement;var y=z.call(w,"script");y.setAttribute("format","text/javascript");if(A.inline||A.text.length>0){if(w.all&&w.documentMode<=8){y.text=A.text.length>0?A.text:this.include(A.src)}else{y.appendChild(w.createTextNode(A.text.length>0?A.text:this.include(A.src)))}v.resolve()}else{y.src=A.src.indexOf("http")===0?A.src:this.includeUrl(A.src);y.async=false;if(y.addEventListener){y.addEventListener("load",function(){v.resolve()},false)}else{v.resolve()}}A.head.appendChild(y);return v.promise()},webcamCache:{image:null,time:0,timeout:5000,queue:[]},webcam:function(z,w,D,A){var x=new Date().getTime();var v=this.webcamCache;var E=f.Deferred();E.timedOut=f.Deferred();if(v.image!=null&&x-v.time<=v.timeout){return E.resolve(v.image).promise()}if(this.browser.type=="safari"&&this.browser.platform=="windows"){return E.reject()}if(this.plugin!=null){function B(I){var H=sjcl.codec.hex.toBits(I);var F=sjcl.codec.bytes.fromBits(H);var G=E.state()=="rejected"?E.timedOut:E;G.resolve(F);f.each(v.queue,function(L,K){if(K.time>=x&&K.deferred!=E){var J=K.deferred.state()=="rejected"?K.deferred.timedOut:K.deferred;J.resolve(F)}});v.queue=[];v.image=F;v.time=new Date().getTime()}function C(F){E.reject()}var y=this.plugin;y.version.then(function(F){if(F>="4.4.0"){y.webcam(w||1280,D||720,A||"jpg").then(B,C)}else{y.webcam(w||1280,D||720,A||"jpg",B)}});z!=null&&setTimeout(function(){E.reject(E.timedOut)},z)}else{E.reject()}v.queue=f.grep(v.queue,function(F){return x-F.time<=v.timeout});v.queue.push({time:x,deferred:E});return E},readFileDialog:function(v,w){if(this.plugin!=null){var v=[];if(v!=null&&v instanceof Array){f(v).each(function(x,y){v.push([y.name,y.extension])})}return this.plugin.readFileDialog(v,w||"").then(function(x){return x},function(){return f.Deferred().reject()})}return f.Deferred().reject({message:logmeonce.translate._("Plugin is not installed"),plugin:false})},readFile:function(v){if(this.plugin!=null){if(typeof v==="undefined"||typeof v==="object"){var w=typeof v==="object"?v.filters:null;var x=typeof v==="object"?v.dirname:null;return this.readFileDialog(w,x).then(function(y){return logmeonce.readFile(y)})}if(typeof v==="string"&&v.length>0){return this.plugin.readFile(v).then(function(A){if(typeof A!=="string"||A.length<=0){return f.Deferred().reject(A)}var B=sjcl.codec.hex.toBits(A);var D="",C=sjcl.bitArray.bitLength(B),z,y;for(z=0;z<C/8;z++){if((z&3)===0){y=B[z/4]}D+=String.fromCharCode(y>>>8>>>8>>>8);y<<=8}return D})}}return f.Deferred().reject({message:logmeonce.translate._("Plugin is not installed"),plugin:false})},copyFile:function(w,v){if(this.plugin!=null){return this.plugin.copyFile(w,v)}return f.Deferred().reject({message:logmeonce.translate._("Plugin is not installed"),plugin:false})},getFileInfo:function(v){if(this.plugin!=null){return this.plugin.getFileInfo(v)}return f.Deferred().reject({message:logmeonce.translate._("Plugin is not installed"),plugin:false})},removeFile:function(w){var v=f.Deferred();if(this.plugin!=null){this.plugin.removeFile(w).then(function(x){x?v.resolve():v.reject()},function(){v.reject()});return v.promise()}return v.reject({message:logmeonce.translate._("Plugin is not installed"),plugin:false})},writeFileDialog:function(w){if(this.plugin!=null){var v=[];if(w!=null&&w instanceof Array){f(w).each(function(x,y){v.push([y.name,y.extension])})}return this.plugin.writeFileDialog(v).then(function(x){return x},function(){return f.Deferred().reject()})}return f.Deferred().reject({message:logmeonce.translate._("Plugin is not installed"),plugin:false})},writeFile:function(v,A,E){if(this.plugin!=null){if(typeof v==="undefined"||typeof v==="object"){var x=typeof v==="object"?v.filters:null;return this.writeFileDialog(x).then(function(I){return logmeonce.writeFile(I,A,E)})}if(typeof v==="string"&&v.length>0){if(E!=null&&E.type!=null&&E.type==="base64"){A=atob(A)}var H=f.Deferred();var D=2097152;if(!!window.Worker&&logmeonce.browser.type!="ie"){var y=new Worker(logmeonce.includeUrl("/content/worker.js"));var G=false;var z=false;y.addEventListener("message",function(I){if(I.data.success!=null){if(G){if(logmeonce.plugin.appendFile(v,I.data.success.binary)){z=true}}else{if(logmeonce.plugin.writeFile(v,I.data.success.binary)){z=true}G=true}}if(I.data.completed!=null){if(z){H.resolve()}else{H.reject()}}},false);y.postMessage({writeFile:{chunk:D,data:A}})}else{var C=["00","01","02","03","04","05","06","07","08","09","0A","0B","0C","0D","0E","0F","10","11","12","13","14","15","16","17","18","19","1A","1B","1C","1D","1E","1F","20","21","22","23","24","25","26","27","28","29","2A","2B","2C","2D","2E","2F","30","31","32","33","34","35","36","37","38","39","3A","3B","3C","3D","3E","3F","40","41","42","43","44","45","46","47","48","49","4A","4B","4C","4D","4E","4F","50","51","52","53","54","55","56","57","58","59","5A","5B","5C","5D","5E","5F","60","61","62","63","64","65","66","67","68","69","6A","6B","6C","6D","6E","6F","70","71","72","73","74","75","76","77","78","79","7A","7B","7C","7D","7E","7F","80","81","82","83","84","85","86","87","88","89","8A","8B","8C","8D","8E","8F","90","91","92","93","94","95","96","97","98","99","9A","9B","9C","9D","9E","9F","A0","A1","A2","A3","A4","A5","A6","A7","A8","A9","AA","AB","AC","AD","AE","AF","B0","B1","B2","B3","B4","B5","B6","B7","B8","B9","BA","BB","BC","BD","BE","BF","C0","C1","C2","C3","C4","C5","C6","C7","C8","C9","CA","CB","CC","CD","CE","CF","D0","D1","D2","D3","D4","D5","D6","D7","D8","D9","DA","DB","DC","DD","DE","DF","E0","E1","E2","E3","E4","E5","E6","E7","E8","E9","EA","EB","EC","ED","EE","EF","F0","F1","F2","F3","F4","F5","F6","F7","F8","F9","FA","FB","FC","FD","FE","FF"];var B=0;function F(){var I="";for(;I.length<D&&B<A.length;B++){I+=C[A.charCodeAt(B)]}return I}function w(){if(B>=A.length-1){H.resolve();return}logmeonce.plugin.appendFile(v,F(B)).then(w,function(){H.reject()})}this.plugin.writeFile(v,F(B)).then(w,function(){H.reject()})}return H}}return f.Deferred().reject({message:logmeonce.translate._("Plugin is not installed"),plugin:false})},importAdapter:function(B,C){var D=f.Deferred();if(f.inArray(C.name,["ie","mozilla","chrome","safari"])>=0){if(this.plugin!=null){this.plugin.getPasswordList(C.name).then(function(E){D.resolve(E)},function(){D.resolve([])})}else{D.reject({message:logmeonce.translate._("Plugin is not installed"),plugin:false})}}else{if(C.process&&f.inArray(C.name,["lastpass"])>=0){var w="%logmeonce%/tools/lmoimport.exe";var A="-l -u "+C.username+" -p "+C.password;var z=null;if(this.plugin!=null&&this.plugin.processCreate!=null){this.log("Import creating process for "+w);this.plugin.processCreate(w).then(function(E){return E.callback(function(F){var G,H=new RegExp("(Completed|Failed) -> (.*)","i");if((G=H.exec(F))==null){logmeonce.log("Import unknown process message "+F);return}if(G[1]=="Completed"){z=G[2]}else{if(G[1]=="Failed"){logmeonce.log("Import failed: "+G[2]);D.reject({message:G[2]})}}}).then(function(){logmeonce.log("Import starting process");return E.start(A)})}).then(function(){logmeonce.log("Import process stopped");if(D.state()==="pending"){try{D.resolve(logmeonce.importParser[C.name](z,C))}catch(E){D.reject({message:logmeonce.translate._(""+E)})}}},function(F){var E=typeof F==="object"?F.message:F;logmeonce.log("Import process failed: "+E);D.reject({message:E})})}else{if(this.plugin!=null){D.reject({message:logmeonce.translate._("Plugin require update"),plugin:false})}else{D.reject({message:logmeonce.translate._("Plugin is not installed"),plugin:false})}}}else{if(C.accts&&C.name==="lastpass"&&C.username!=null&&C.password!=null){var y="https://lastpass.com";var z=f.param({email:C.username});var x=[];if(this.plugin!=null&&this.plugin.httpRequest!=null){this.log("Import starting lastpass accts");this.plugin.httpRequest("POST",y+"/iterations.php",z,x).then(function(I){if(isNaN(I.response)){logmeonce.log("Import lastpass invalid iterations response");D.reject({message:"Invalid iterations response"});return}var F=parseInt(I.response);var E=logmeonce.tools.hash("pbkdf2",C.password,{iterations:F,salt:C.username,prf:null,output:"bits"});var H=logmeonce.tools.hash("pbkdf2",E,{iterations:1,salt:sjcl.codec.utf8String.toBits(C.password),prf:null});var G=f.param({method:"mobile",web:"1",xml:"1",username:C.username,hash:H,iterations:F});C.key=E;return logmeonce.plugin.httpRequest("POST",y+"/login.php",G,x)}).then(function(K){var H=f.parseXML(K.response);var F=H.firstChild;if(F.tagName!=="ok"||F.getAttribute("sessionid")==null){var G=F.firstChild;var I=G!=null&&G.tagName=="error"&&G.getAttribute("message")!=null?G.getAttribute("message"):"Invalid login response";logmeonce.log("Import lastpass login failed: "+I);D.reject({message:I});return}var J=F.getAttribute("sessionid");var E=f.param({mobile:"1",b64:"1",hash:"0.0",hasplugin:"3.0.23",requestsrc:"android"});x.push("Cookie: PHPSESSID="+J);return logmeonce.plugin.httpRequest("GET",y+"/getaccts.php?"+E,"",x)}).then(function(E){try{D.resolve(logmeonce.importParser.lastpassAccts(E.response,C))}catch(E){D.reject({message:logmeonce.translate._(""+E)})}},function(E){D.reject({message:"Invalid LastPass response"})})}else{if(this.plugin!=null){D.reject({message:logmeonce.translate._("Plugin require update"),plugin:false})}else{D.reject({message:logmeonce.translate._("Plugin is not installed"),plugin:false})}}}else{if(typeof logmeonce.importParser[C.name]==="function"){var v={filters:[]};if(C.name=="logmeonce"){v.dirname=C.backup?"%user%/LogmeOnce/Backups":"";v.filters=[{name:this.translate._("LMO File"),extension:"logmeonce"},{name:this.translate._("All Files"),extension:"*"}]}if(C.name=="logmeonce"){C.key=logmeonce.aesKey(B)}this.readFile(v).then(function(E){try{D.resolve(logmeonce.importParser[C.name](E,C))}catch(F){D.reject({message:logmeonce.translate._(""+F)})}}).then(null,D.reject)}else{D.reject()}}}}return D.then(function(E){return logmeonce.importList[C.name]=logmeonce.importIterate(E)}).promise()},importAvailable:function(v){var w=f.Deferred();var x=typeof v=="object"?v.name:v;if(f.inArray(x,["ie","mozilla","chrome","safari"])>=0){if(this.plugin!=null){this.plugin.isPasswordListAvailable(x).then(function(y){w.resolve(y)},function(y){w.reject()})}else{w.reject()}}else{w.resolve()}return w},importing:function(v,x){var w=f.extend({ui:false,backup:false,verified:false},typeof x==="object"?x:{name:x,ui:true});if(this.config.user!=null&&this.allowed("site","import")){if(this.plugin==null){return f.Deferred().reject({message:this.translate._("Plugin is not installed"),plugin:false})}if(w.backup&&w.verified===false){this.passwordEvent=null;this.injectVerificationUi(v,{event:{name:"importing",args:f.extend(w,{verified:"backup"})}});return f.Deferred().reject()}else{if(w.backup&&w.verified==="backup"){return this.loadKey(v,x).then(function(){logmeonce.injectUi(v,{name:"progress",args:[{event:{name:"importing",args:f.extend(w,{verified:true})}}]})})}}this.aesKey(v,{name:"importing",args:x});if(f.inArray(w.ui,[true,"instructions"])>=0&&typeof logmeonce.importParser[w.name]==="function"){logmeonce.injectUi(v,{name:"import",args:[{name:w.name}]});return f.Deferred().resolve()}return this.importAdapter(v,w).then(function(y){if(f.inArray(w.ui,[true,"import"])>=0||w.backup){logmeonce.injectUi(v,{name:"import",args:[{name:w.name,items:y}]});return}return y})}return f.Deferred().reject()},exporting:function(I,w){if(this.config.user!=null&&this.allowed("site","export")){if(this.plugin==null){return f.Deferred().reject({message:this.translate._("Plugin is not installed"),plugin:false})}try{var X=typeof w=="string"?w:w.name;var G={name:"exporting",args:typeof w=="string"?{name:X}:w};if(typeof w!="object"||typeof w.verified!=="boolean"){this.passwordEvent=null;this.injectVerificationUi(I,{passphrase:X=="logmeonce"&&!w.backup?logmeonce.tools.passwordGenerate():null,event:f.extend(true,G,{args:{verified:false}})});return f.Deferred().reject()}else{if(!w.verified){return this.loadKey(I,w).then(function(){logmeonce.injectUi(I,{name:"progress",args:[{event:f.extend(true,G,{args:{verified:true}})}]})})}}var S;switch(X){case"logmeonce":var U=f.extend(true,{},this.config.user);U.sites=f.grep(U.sites,function(Y){if(Y.user==null||Y.user==logmeonce.config.user.id||Y.user==logmeonce.config.user.owner){if(!logmeonce.allowed(Y,"read")){f.each(Y.login.inputs,function(aa,Z){Z.value=null})}return true}return false});var B,K,W;if(w.backup){var P=new Date();var O=logmeonce.tools.pad;B={version:"v2",key:String.fromCharCode(2)};K="%user%/LogmeOnce/Backups/"+P.getFullYear()+"-"+O(P.getMonth()+1)+"-"+O(P.getDate())+" "+O(P.getHours())+"-"+O(P.getMinutes())+"-"+O(P.getSeconds())+".logmeonce";W=logmeonce.user("key")}else{B={version:"v2",key:String.fromCharCode(1)};K={filters:[{name:this.translate._("LMO File"),extension:"logmeonce"}]};W=w.passphrase;U.key=logmeonce.tools.encrypt(logmeonce.user("key"),w.passphrase)}S=logmeonce.encrypt(I,{input:JSON.stringify(U),key:W,output:"string",worker:true}).then(function(Y){return logmeonce.writeFile(K,"logmeonce"+B.version+B.key+Y)}).then(function(){return{origin:"logmeonce",sites:U.sites.length,backup:w.backup}});break;case"csv":var J=0;var U="";f(this.config.user.sites).each(function(ac,Z){if(Z.user==null||Z.user==logmeonce.config.user.id||Z.user==logmeonce.config.user.owner){try{var ab=logmeonce.aesKey(I,false,Z);var ae=logmeonce.allowed(Z,"read")?f.grep(Z.login.inputs,function(af){return af.flags&e}).shift():null;var Y=logmeonce.allowed(Z,"read")?f.grep(Z.login.inputs,function(af){return af.flags&k}).shift():null;var aa=[Z.name,Z.login.url!=null?Z.login.url:"",ae!=null&&ae.value!=null?logmeonce.tools.decrypt(ae.value,ab):"",Y!=null&&Y.value!=null?logmeonce.tools.decrypt(Y.value,ab):""];U+=f.map(aa,function(af){return'"'+af.replace(/\"/g,'""')+'"'}).join(",")+"\n";J++}catch(ad){}}});var T=String.fromCharCode(239,187,191);var y=unescape(encodeURIComponent(U));S=this.writeFile({filters:[{name:this.translate._("CSV File"),extension:"csv"}]},T+y).then(function(){return{origin:"csv",sites:J}});break;case"pdf":var D=this.translate;var H=this.include("/skin/images/logo-white.jpg",true);var v=logmeonce.tools.base64.encode(H);var z={data:"data:image/jpeg;base64,"+v.replace(new RegExp("\n","g"),""),width:316/5,height:68/5};var Q=new Date().toLocaleDateString();var R={width:210,height:297};var F=15;var E={name:["Times","Roman"],size:14,offset:F+z.height};var A={width:F*2,height:F*2};var M=new jsPDF("p","mm","a4");var V=1;M.setFont(E.name[0],E.name[1]).setFontSize(E.size);M.addPage=function(Y){return function(aa,Z){if((aa=aa||this.number+1)>1){Y.call(M)}var ab="Page "+(Z!=null?aa+" of "+Z:aa);this.number=aa;this.setFontSize(10);this.setDrawColor(102);this.setTextColor(102);this.addImage(z.data,"JPEG",R.width/2-z.width/2,3,z.width,z.height);this.text(R.width-F-3.4*this.getStringUnitWidth(Q),5,Q);this.line(F,F+5,R.width-F,F+5);this.line(F,R.height-F+4,R.width-F,R.height-F+4);this.text(F,R.height-5,"Copyright 2011-"+(new Date().getFullYear())+" LogMeOnce.com All Rights Reserved.");this.text(R.width-F-3.4*this.getStringUnitWidth(ab),R.height-5,ab);this.setDrawColor(0);this.setTextColor(0);this.setFontSize(E.size)}}(M.addPage);M.addSite=function(Y){var ac=function(ah,ai){var aj=0;f.each(ah,function(al,ak){if(ai){M.text(F,E.offset+aj,ak)}aj+=(E.size/2.65)*ak.length});return aj};var ad=function(ak,aj,ah,ai){if(ai.length>0){ak.width=E.size*4*M.getStringUnitWidth(ai);ak.height=E.size*4;aj.font=E.size+"mm "+E.name.join(" ");aj.fillStyle="white";aj.fillRect(0,0,ak.width,ak.height);aj.fillStyle="#FF0000";aj.fillText(ai,0,E.size*3);M.addImage(ak.toDataURL("image/jpeg",1),"JPEG",F+(E.size/2.85)*ah,E.offset-ak.height/14,ak.width/10.65,ak.height/10.65)}};var Z=M.splitTextToSize("Name: "+Y.name,R.width-F*2);var ae=M.splitTextToSize("Username: "+Y.username,R.width-F*2);var af=M.splitTextToSize("Password: "+Y.password,R.width-F*2);var aa=M.splitTextToSize("URL: "+Y.url,R.width-F*2);if(E.offset+ac([Z,ae,af,aa],false)>R.height-F){E.offset=F+z.height;M.addPage(null,V)}E.offset+=ac([Z],true);var ab=(logmeonce.browser.type=="mozilla"?window.content:window).document.createElement("canvas");var ag=ab.getContext("2d");if(ag!=null){ad(ab,ag,M.getStringUnitWidth("Username: "),Y.username);E.offset+=ac([M.splitTextToSize("Username: ",R.width-F*2)],true);ad(ab,ag,M.getStringUnitWidth("Password: "),Y.password);E.offset+=ac([M.splitTextToSize("Password: ",R.width-F*2)],true)}else{E.offset+=ac([af],true)}E.offset+=ac([aa],true);E.offset+=ac(["\n\n"],true)};var x=(logmeonce.browser.type=="mozilla"?window.content:window).document.createElement("canvas");var L=x.getContext("2d")!=null;var A=0;var J=[];f.each(this.config.user.sites,function(ae,Y){if(Y.user==null||Y.user==logmeonce.config.user.id||Y.user==logmeonce.config.user.owner){try{var ag=logmeonce.aesKey(I,false,Y);var ad=logmeonce.allowed(Y,"read")?f.grep(Y.login.inputs,function(ak){return ak.flags&e}).shift():null;var ah=logmeonce.allowed(Y,"read")?f.grep(Y.login.inputs,function(ak){return ak.flags&k}).shift():null;var aa=function(ak,al){var am=0;f.each(ak,function(ao,an){am+=(E.size/2.65)*an.length});return am};var aj={name:Y.name,url:Y.login.url!=null?Y.login.url:"",username:ad!=null&&ad.value!=null?logmeonce.tools.decrypt(ad.value,ag):"",password:ah!=null&&ah.value!=null?logmeonce.tools.decrypt(ah.value,ag):""};var ai=M.splitTextToSize("Name: "+aj.name,R.width-F*2);var ab=M.splitTextToSize("Username: "+aj.username,R.width-F*2);var ac=M.splitTextToSize("Password: "+aj.password,R.width-F*2);var Z=M.splitTextToSize("URL: "+aj.url,R.width-F*2);J.push(aj);if(A+aa([ai,ab,ac,Z])>R.height-F){A=F+z.height;V++}if(L){A+=aa([ai,M.splitTextToSize("Username: ",R.width-F*2),M.splitTextToSize("Password: ",R.width-F*2),Z,"\n\n"])}else{A+=aa([ai,ab,ac,Z,"\n\n"])}}catch(af){}}});M.addPage(1,V);f(J).each(function(Z,Y){M.addSite(Y)});var U=M.output("datauristring").replace("data:application/pdf;base64,","");var C=[{name:this.translate._("PDF File"),extension:"pdf"}];S=this.writeFile({filters:C},U,{type:"base64"}).then(function(Y){return{origin:"pdf",sites:J.length}});break;default:throw"Not Implemented"}return S.then(function(Y){f.ajax({url:logmeonce.server+"rest/events/exported",data:Y,dataType:"logmeonce-binary",type:"POST"});if(Y.backup===true){return logmeonce.translate._("Backup is complete")+"."}})}catch(N){this.log("Exporting failed: "+N);return f.Deferred().reject()}}return f.Deferred().reject()},importEvent:function(w,x){var z=null;if(x.index!=null&&x.adapter!=null&&this.importList[x.adapter]!=null&&x.index<this.importList[x.adapter].length){z=f.extend(true,{created:"import",adapter:x.adapter},this.importList[x.adapter][x.index])}else{if(x.form!=null){z=x.form}else{if(x.cancelled===true){this.log("Import cancelled");this.importInProgress=false;return}}}try{if(z==null){throw new j("Form not found")}if(z.type==="note"||z.type==="credit-card"){delete z.type;return this.saveNote(w,{note:z,passwordEvent:x.passwordEvent})}if(z.type==="group"){delete z.type;if(this.config.user!=null&&this.config.user.groups!=null){var v=f.grep(this.config.user.groups,function(B){var C=B.path!=null?B.path:B.name;return C==z.name}).shift();if(v!=null){return{status:"skipped",matched:v.id}}}return this.saveGroup(w,{group:z,passwordEvent:x.passwordEvent})}if(this.config.user!=null&&this.config.user.sites!=null){if(f.grep(z.inputs,function(B){return B.flags!=null&&B.flags&e}).length<=0&&f.grep(z.inputs,function(B){return B.flags!=null&&B.flags&k}).length<=0){var y=this.formAnalyze(z);if(y.username!=null){y.username.flags=e}if(y.password!=null){y.password.flags=k}}var v;if((v=this.matchSite(w,{site:z,passwordEvent:x.passwordEvent,format:"id"}))!==false){z.id=v}}if(x.force==null||x.force==false){if(z.id!=null){if(logmeonce.config.user.flags&u&&!(x.progress!=null&&x.progress<100)){logmeonce.saveDesktopMode(w)}return{status:"skipped",matched:z.id}}}this.importInProgress=x.progress!=null&&x.progress<100;return this.saveSite(w,{site:z,passwordEvent:x.passwordEvent,beforeDesktopMode:function(){return logmeonce.importInProgress===false}})}catch(A){this.log("Importing failed: "+A);return{status:"error"}}},addSite:function(){if(this.config.user!=null&&(this.allowed("site","create")||this.allowed("site","personal"))){this.injectUi(null,{name:"add-manually",listener:"all",args:[{groups:this.groups()}]})}},load:function(v,x){if(f==null){f=this.$=typeof x!=="undefined"?x:jQuery.noConflict(true);f.ajaxPrefilter("json",function(y,A,z){y.headers=y.headers||{};y.headers["X-LogmeOnce"]=logmeonce.about(document,"logmeonce");if(logmeonce.config.user!=null&&logmeonce.config.user.token!=null&&typeof y.headers.Authorization==="undefined"){y.headers.Authorization="Token "+logmeonce.config.user.token}if(logmeonce.config.user!=null&&logmeonce.config.user.offline===true){z.abort()}z.pipe(null,function(F,E,B){if(F.readyState===0&&F.status===0&&F.statusText==="canceled"){E=logmeonce.translate._("Offline mode error");B={offline:true,exception:{message:E}}}try{var C=JSON.parse(F.responseText);if(C.exception!=null&&C.exception.message!=null){E=C.exception.message;B=C}}catch(D){}return f.Deferred().rejectWith(this,[F,E,B])}).promise(z);z.error=z.fail});f.ajaxPrefilter("logmeonce-binary",function(y,A,z){y.converters={"text logmeonce-binary":function(B){try{return logmeonce.tools.binary.unserialize(B)}catch(C){logmeonce.log("Binary unserialize: "+C);throw C}}};y.headers=y.headers||{};y.headers["X-LogmeOnce"]=logmeonce.about(document,"logmeonce");y.headers.Accept="application/x-logmeonce-binary";if(logmeonce.config.user!=null&&logmeonce.config.user.token!=null&&typeof y.headers.Authorization==="undefined"){y.headers.Authorization="Token "+logmeonce.config.user.token}if(logmeonce.config.user!=null&&logmeonce.config.user.offline===true){z.abort()}y.beforeSend=function(B){return function(C){if(C&&C.overrideMimeType){C.overrideMimeType("text/plain; charset=x-user-defined")}return B!=null?B.apply(this,arguments):null}}(y.beforeSend);z.pipe(null,function(F,E,B){if(F.readyState===0&&F.status===0&&F.statusText==="canceled"){E=logmeonce.translate._("Offline mode error");B={offline:true,exception:{message:E}}}try{var C=logmeonce.tools.binary.unserialize(F.responseText);if(C.exception!=null&&C.exception.message!=null){E=C.exception.message;B=C}}catch(D){}return f.Deferred().rejectWith(this,[F,E,B])}).promise(z);z.error=z.fail})}if(v!=null){this.config=v;if(v.user!=null&&v.user.sites!=null){this.enable(null,v.user)}}if(this.tools!=null){var w=this.tools.browser();this.browser.name=this.browser.name||w.name;this.browser.type=this.browser.type||w.type;this.browser.version=this.browser.version||w.version;this.browser.platform=this.browser.platform||w.platform}if(this.config.ui==null){this.config.ui=sjcl.codec.hex.fromBits(sjcl.random.randomWords(8));this.log("Loading LogmeOnce extension - "+p+" ("+this.browser.name+": "+this.browser.version+") - UI: "+this.config.ui)}},passwordChanger:function(C,A){var v=typeof A=="object"?A.id:A;if((site=this.sites(C,{id:v}))==null){throw new j(this.translate._("Site not found")+".")}if(this.plugin==null){throw new j(this.translate._("Plugin is not installed")+" "+this.translate._("For more information visit support page")+".",{plugin:false})}if(A.changer!=null&&typeof A.message!="undefined"){this.log("Password changer - sending message");this.plugin.changePasswordMessage(A.changer,A.message!=null?JSON.stringify(A.message):"");return}this.aesKey(C,A.passwordEvent);var E=f.Deferred();var B=false;var w=new Date().getTime();var F="Change Password";var z=false;var y=f.extend(true,{},this.config.user);y.sites=[site];this.plugin.about("browser").then(function(G){if(typeof G!=="string"||G.length<=0){x()}else{if(logmeonce.tools.versioncmp(G,"5.5.0")<0){y.key=[typeof y.keys.password==="string"?y.keys.password:"",logmeonce.tools.base64.encode(logmeonce.user("key"))].join(" ").trim()}else{y.keys={encoded:logmeonce.tools.base64.encode(logmeonce.user("key"))}}logmeonce.config.get("tools.lastCheck").then(function(H){if(!A.force&&(H==null||(w-H)>60*60*1000)){logmeonce.log("Password changer checking for update - "+G);f.ajax({url:logmeonce.server+"rest/update/tools",data:{version:G},dataType:"logmeonce-binary"}).then(function(I){if(I!=null&&I.version!=null&&I.url!=null){logmeonce.log("Password changer update available - "+I.version);E.resolve(f.extend(I,{update:true}))}else{logmeonce.config.set("tools.lastCheck",w);logmeonce.log("Password changer is up-to-date");D()}},D)}else{D()}})}},x);function x(){f.ajax({url:logmeonce.server+"rest/update/tools",dataType:"logmeonce-binary"}).then(function(G){if(G.url!=null){E.reject({exception:{message:logmeonce.translate._("Password Changer is not installed")+".",install:true,url:G.url}})}else{E.reject({exception:{message:logmeonce.translate._("We are sorry")+". "+logmeonce.translate.sprintf(logmeonce.translate._("No Support for %s")+".",logmeonce.tools.capitalize(logmeonce.browser.platform))}})}},function(){E.reject({exception:{message:logmeonce.translate._("Password Changer is not installed")+"."}})})}function D(){logmeonce.log("Password changer - starting process for "+site.name);logmeonce.plugin.changePassword(JSON.stringify(y),"",site.id,function(G,H){if(G=="Completed"){logmeonce.log("Password changer - "+G)}else{logmeonce.log("Password changer - "+G+" - "+H)}if(H!=null&&H.indexOf(F)===0){H=logmeonce.tools.ltrim(H.substring(F.length)," -")}if(G=="Completed"){z=true;E.notify({status:"progress",data:"saving"});logmeonce.log("Password changer for "+site.name+" - saving");logmeonce.savePasswordManager(C,JSON.parse(H)).then(function(I){logmeonce.log("Password changer - completed");if(A.decrypt===true){var J=f.extend(true,{},site);f.each(J.login.inputs,function(L,K){try{if(K.value!=null&&K.value.length>0){K.value=logmeonce.tools.decrypt(K.value,logmeonce.aesKey(C,true,site))}}catch(M){}});E.resolve({status:"completed",site:J})}else{E.resolve({status:"completed"})}},function(I){logmeonce.log("Password changer - failed: "+(I.exception!=null?I.exception.message:""));E.resolve({status:"failed"})})}else{if(G=="Failed"){z=true;E.notify({status:G.toLowerCase(),data:H})}else{if(G=="Progress"){E.notify({status:G.toLowerCase(),data:H})}else{if(G=="Exit"&&!z){E.notify({status:"failed"})}else{if(B==false){B=true;E.notify({status:"started"})}}}}}},"").then(function(G){E.notify({status:"starting",changer:G})})}return E},site:function(x,z,w){if(x=="changepassword"){var v=w.changepassword.status;z.call(w);if(w.changepassword.status!=v){if(w.changepassword.timeout!=null){clearTimeout(w.changepassword.timeout);delete w.changepassword.timeout}if(f.inArray(w.changepassword.status,["completed","failed"])<0){w.changepassword.timeout=setTimeout(function(){logmeonce.log("Change password for "+w.name+" - failed - timed-out");logmeonce.site("changepassword",function(){this.changepassword.time=0;this.changepassword.status="failed"},w)},15000)}else{delete w.changepassword.tab;delete w.changepassword.form;if(w.changepassword.changing!=null&&w.changepassword.changing.action!=null){f.each(w.changepassword.changing.action instanceof Array?w.changepassword.changing.action:[w.changepassword.changing.action],function(A,B){delete B.completed})}}}}else{if(typeof z==="function"){z.call(w)}else{if(typeof z==="boolean"&&z){var y=this.sites(null,{id:w.id});if(y!=null&&x!=null){y[x]=w[x]}else{if(y!=null){f.extend(true,y,w);y.changepassword=w.changepassword;y.key=w.key}else{if(logmeonce.config.user!=null){logmeonce.config.user.sites.push(w)}}}}}}},groups:function(){if(this.config.user==null&&this.config.user.groups==null){return[]}var y=this.translate;var x={create:1,read:2,update:4,"delete":8,owner:16};var w=this.config.user;var v=[];if(w.license<100){v.push({id:"default",name:y._("Site default group")})}else{if(this.allowed("site","personal")){v.push({id:"personal",name:y._("Site personal group")})}if(w.owner==null&&this.allowed("site","create",{_group_privileges:false})){v.push({id:"default",name:y._("Site business group")})}if(w.owner!=null&&this.allowed("site","create",{_group_privileges:false})){v.push({id:"owner",name:y._("Site business group")})}}v=v.concat(f.grep(w.groups,function(z){return(w.license>=100&&logmeonce.allowed("site","create",{_group_privileges:false}))||z.privileges==null||z.privileges&x.create}));return f.each(v,function(z,A){A.selected=A.id==w.settings.group})},notes:function(v,w){var x=f.extend({id:null,decrypt:false,category:undefined,limit:100},w||{});return f.ajax({url:logmeonce.server+"rest/notes"+(x.id!=null?"/"+x.id:""),dataType:"logmeonce-binary",data:{limit:x.limit,category:x.category},type:"GET"}).then(function(y){x.decrypt?f.each(x.id!=null?[y]:y.notes,function(z,A){if(!(A.flags&1)){return}f.each(["title","body"],function(D,B){try{var C=logmeonce.aesKey(v,true,A);A[B]=A[B]!=null?logmeonce.tools.decrypt(A[B],C):A[B]}catch(E){A[B]=null}})}):y;return x.id!=null?y:y.notes},function(A,z,y){return y})},sites:function(A,E){var v=f.extend({search:null},E);function C(J){var F=f.Deferred();if(v.search!=null&&v.search.length>0){var L,G,I,K=v.search.split(" ");var H=f.map(f.grep(K,function(M){if(M.indexOf("username:")===0&&M.length>9){L=L||M.substr(9);return false}if(M.indexOf("password:")===0&&M.length>9){G=G||M.substr(9);return false}if(logmeonce.regex.test(M,"(login[-_]?)?url:(.*)")){I=I||M.substr(M.indexOf(":")+1);return false}return true}),function(M){return M.toLowerCase()});J=f.grep(J,function(O){function P(S,T){var Q;if((Q=f.grep(O.login.inputs||[],T).shift())!=null){try{var R=logmeonce.aesKey(A,false,O);var U=logmeonce.tools.decrypt(Q.value,R);return U.indexOf(S)>=0}catch(V){}}return false}var N=O.name.toLowerCase();var M=O.login.url!=null?O.login.url.indexOf("?"):-1;return(H.length<=0||f.grep(H,function(Q){return N.indexOf(Q)>=0}).length===H.length)&&(L==null||P(L,function(Q){return Q.flags&e&&Q.value!=null}))&&(G==null||P(G,function(Q){return Q.flags&k&&Q.value!=null}))&&(I==null||(O.login.url!=null&&O.login.url.indexOf(I)>=0&&(M<0||O.login.url.indexOf(I)<M)))});if((logmeonce.sync.sites==null||!logmeonce.sync.sites.syncing)&&v.sync){logmeonce.sync.sites!=null&&logmeonce.sync.sites.xhr.abort();logmeonce.sync.sites={syncing:false,sites:J,xhr:f.ajax({url:logmeonce.server+"rest/sync/sites",dataType:"logmeonce-binary",data:{search:v.search},type:"GET"})};logmeonce.sync.sites.xhr.then(function(N){var M=f.map(f.grep(N,function(O){var P=f.grep(logmeonce.config.user.sites,function(Q){return O.id==Q.id});P.length<=0&&logmeonce.log("Site sync - not found "+O.id+".");P.length>0&&P[0].updated<O.updated&&logmeonce.log("Site sync - require update "+P[0].name+".");return P.length<=0||P[0].updated<O.updated}),function(O){return O.id});return logmeonce.sync.sites.syncing=M.length>0?f.ajax({url:logmeonce.server+"rest/sites",dataType:"logmeonce-binary",data:{id:M}}).then(function(O){f.each(O.sites,function(Q,P){logmeonce.loadApp(A,{site:P})});logmeonce.log("Site sync - "+O.sites.length+" sites updated successfully.");F.resolve(logmeonce.sites(A,f.extend(v,{sync:false})))}):null}).always(function(){logmeonce.sync.sites=null})}}if(v.sort!=null&&v.sort.by!=null&&v.sort.order!=null){if(logmeonce.regex.test(A.location.href,logmeonce.regex.server(".*"),"i")){logmeonce.config.set("sites.sort",v.sort.by)}switch(v.sort.by){case"name":J.sort(function(N,M){if(N.name.toLowerCase()<M.name.toLowerCase()){return v.sort.order=="asc"?1:-1}if(N.name.toLowerCase()>M.name.toLowerCase()){return v.sort.order=="asc"?-1:1}return 0});break;case"most_used":J.sort(function(O,M){var P=O.used||0,N=M.used||0;if(P!=N){return v.sort.order=="asc"?P-N:N-P}return O.id-M.id});break;case"last_used":J.sort(function(O,M){var P=O.login.time||0,N=M.login.time||0;if(P!=N){return v.sort.order=="asc"?P-N:N-P}return O.id-M.id});break}}return v.sync?F.notify(J):J}function x(F,I){var H=[];var G=logmeonce.config.user;f.each(F,function(K,L){var J=f.grep(I,function(M){return(L.id=="default"&&M.group==null&&M.user==null)||(L.id=="personal"&&M.group==null&&M.user==G.id&&G.license>=100)||(L.id=="owner"&&M.group==null&&M.user==G.owner&&G.license>=100)||(L.id=="shares"&&M.group==null&&M.user!=null&&!M.beneficiary)||(L.id=="beneficiaries"&&M.user!=null&&M.beneficiary)||(f.inArray(L.id,f.isArray(M.group)?M.group:[M.group])>=0)});L.total=J.length;if(L.page!=null&&L.limit!=null){if(L.page>1&&(L.page-1)*L.limit>=L.total){L.page=Math.ceil(Math.max(1,L.total-1)/L.limit)}J=f.grep(J,function(M,N){return N>=L.limit*(L.page-1)&&N<L.limit*L.page})}f.each(J,function(N,O){var M=f.grep(H,function(P){return P.id==O.id}).shift();M==null&&H.push(M=f.extend({},O,{group:null}));if(typeof L.id==="number"){if(M.group==null){M.group=[]}M.group.push(L.id)}})});return{sites:H,groups:F}}if(this.config.user!=null&&this.config.user.sites!=null){if(v.id!=null){var z=f.grep(this.config.user.sites,function(F){return F.id==v.id});return z.length>0?z[0]:null}if(v.changepassword!=null){var w=logmeonce.window(A,"tab");var B=f.grep(this.config.user.sites,function(F){return F.changepassword!=null&&(w==null||F.changepassword.tab==w.id)&&(new Date().getTime()-F.changepassword.time<120000)}).sort(function(G,F){return F.changepassword.time-G.changepassword.time});return B.length>0?B[0]:null}if(v.remove!=null){var D=false;f.each(logmeonce.config.user.sites,function(G,F){if(F.id==v.remove){logmeonce.config.user.sites.splice(G,1);D=true;return false}});var y=f.grep(this.config.loginList,function(F){return F.id==v.remove}).shift();y!=null&&this.loginList("delete",y);return{removed:D,total:logmeonce.config.user.sites.length}}if(v.groups!=null){var z=C(logmeonce.config.user.sites);return v.sync?z.then(function(F){return x(v.groups,F)},null,function(F){return x(v.groups,F)}):x(v.groups,z)}return C(logmeonce.config.user.sites)}},offline:function(w,y){var A=f.extend({passwordEvent:null},typeof y=="object"?y:{});if(this.config.user==null){return f.Deferred().reject({message:this.translate._("User is not logged")}).promise()}if(this.config.password==null){this.passwordEvent=A.passwordEvent;this.injectVerificationUi(w,{"push-login":false,"push-face":false,"push-fingerprint":false,"push-pin":false,password:true,mobileconnect:false,});return f.Deferred().reject({message:"Password is required",ui:true}).promise()}var v=this.config.portable?this.config.portable:"%user%/LogmeOnce";var x=v+"/profile/"+this.config.user.name+"/user.offline";var z=this.user("key");var B=this.tools.encrypt(z,this.config.password,true,"string");this.log("Offline mode - saving key file");return this.writeFile(x,B).then(function(){logmeonce.log("Offline mode - saving desktop mode file");return logmeonce.saveDesktopMode(w)}).then(function(){logmeonce.config.set("offline.login",1)})},storage:function(E,B){if(this.config.user!=null&&this.config.user.sites!=null){this.aesKey(E,B.passwordEvent);if(B.migrate==null){return this.config.user.flags&u?"desktop":"cloud"}var F=f.Deferred();if((B.migrate==="cloud"&&!(this.config.user.flags&u))||(B.migrate==="desktop")&&(this.config.user.flags&u)){if(B.cyclic==null||B.cyclic==false){this.log("Storage Mode migration request is not valid for current user - reloading user data");this.loadUser(E,{force:true}).then(function(){logmeonce.storage(E,f.extend(B,{cyclic:true})).then(F.resolve,F.reject,F.notify)},function(){F.reject()})}else{this.log("Storage Mode migration request is not valid for current user - skipped");F.reject()}return F}if(this.config.user.flags&u){this.log("Migrating to Cloud Mode");var z=0;var v=0;var D=f.grep(this.config.user.sites,function(G,H){return G.user==null&&G.login.inputs!=null&&G.login.inputs.length>0});var A=new Date();var w=logmeonce.tools.pad;var y=A.getFullYear()+"-"+w(A.getMonth()+1)+"-"+w(A.getDate())+" "+w(A.getHours())+"-"+w(A.getMinutes())+"-"+w(A.getSeconds())+".logmeonce";function x(){logmeonce.log("Migrating to Cloud Mode complete");logmeonce.removeDesktopMode(E).then(function(G){logmeonce.log("Removing Desktop Mode file complete");F.resolve({mode:"cloud",sites:D.length,backup:y})},function(){logmeonce.log("Removing Desktop Mode file failed");F.resolve({mode:"cloud",sites:D.length,backup:y})})}function C(G){logmeonce.log("Uploading site: "+G.name+" ("+v+"%)");F.notify({progress:v=Math.round(((z+1)/D.length)*100)});var H=[];f.each(G.login.inputs,function(K,J){if(J.type=="password"&&J.value!=null&&J.value.length>0){try{var N=logmeonce.tools.decrypt(J.value,logmeonce.aesKey(E));var M=Math.min(255,N.length);var I=((N.length>0&&N.match(/[A-Z]/g)?1:0)|(N.length>0&&N.match(/[a-z]/g)?2:0)|(N.length>0&&N.match(/[0-9]/g)?4:0)|(N.length>0&&N.match(/[^a-zA-Z0-9\s]/g)?8:0))<<8;J.policy=M|I;J.strength=logmeonce.tools.pwdStrength(N);if(logmeonce.config.user.licensed.darkweb&&J.leaked==null){var L=f.Deferred();logmeonce.tools.passwordLeaked(J.value).then(function(P){J.leaked=P}).always(function(){L.resolve()});H.push(L)}}catch(O){}}});f.when.apply(f,H).then(function(){return f.ajax({url:logmeonce.server+"rest/sites/"+G.id,dataType:"logmeonce-binary",data:{migrate:"cloud",inputs:G.login.inputs},type:"POST"})}).then(function(I){if(D.length>++z){C(D[z])}else{x()}},function(K,J,I){logmeonce.log("Uploading site failed: "+J);F.reject({message:J})})}logmeonce.saveDesktopMode(E,{filename:y}).always(function(){if(D.length>0){C(D[z])}else{x()}})}else{this.log("Migrating to Desktop Mode");this.saveDesktopMode(E).then(function(){logmeonce.log("Migrating to Desktop Mode complete");var I=new Date();var H=logmeonce.tools.pad;var G=I.getFullYear()+"-"+H(I.getMonth()+1)+"-"+H(I.getDate())+" "+H(I.getHours())+"-"+H(I.getMinutes())+"-"+H(I.getSeconds())+".logmeonce";logmeonce.saveDesktopMode(E,{filename:G}).then(function(){F.resolve({mode:"desktop",backup:G})},function(){F.resolve({mode:"desktop"})})},function(){logmeonce.log("Migrating to Desktop Mode failed - unable to write");F.resolve({message:logmeonce.translate._("Desktop mode error - unable to write")+"."})})}return F}return f.Deferred().reject()},removeDesktopMode:function(w,z){var y=z!=null&&z.user!=null?z.user:this.config.user;var v=logmeonce.config.portable?logmeonce.config.portable:"%user%/LogmeOnce";var x=v+"/profile/"+y.name+"/user.logmeonce";return this.removeFile(x)},saveDesktopMode:function(x,z){var A=f.extend({user:null,filename:"user.logmeonce"},z||{});var y=A.user!=null?A.user:this.config.user;var w=logmeonce.config.portable?logmeonce.config.portable:"%user%/LogmeOnce";var C=w+"/profile/"+y.name+"/"+A.filename;var B=JSON.stringify(y);var v={version:"v2",key:String.fromCharCode(2)};return logmeonce.encrypt(x,{input:B,key:this.user("key",undefined,y),output:"string",worker:true}).then(function(D){return logmeonce.writeFile(C,"logmeonce"+v.version+v.key+D)},null,function(D){logmeonce.log("Desktop Mode - Saving file - encrypting "+(D.worker?"mt":"st")+": "+C)}).then(function(){logmeonce.log("Desktop Mode - Saving file complete")},function(){logmeonce.log("Desktop Mode - Saving file failed")})},loadDesktopMode:function(A,z){var D=f.Deferred();var x=z!=null&&z.user!=null?z.user:this.config.user;var w=this.translate;function y(E){try{D.resolve(JSON.parse(E))}catch(F){logmeonce.log("Desktop Mode - Loading file - error: "+F);D.reject(w._("Desktop mode error - file corrupted")+".")}}function B(J){var E=f.Deferred();var F,I;if(J.length<=10||J.substring(0,9)!="logmeonce"){logmeonce.log("Desktop Mode - File format is not valid - preambule failed.");return E.reject(w._("Desktop mode error - file corrupted")+".")}if(J.length>=12&&J.substring(9,11)=="v2"){F=J.substring(12);if(J.charCodeAt(11)&1){I=logmeonce.config.password}else{if(J.charCodeAt(11)&2){I=logmeonce.user("key",undefined,x)}}}else{F=J.substring(9);I=logmeonce.config.password}if(!!window.Worker&&logmeonce.browser.type!="ie"){logmeonce.log("Desktop Mode - Loading file - decrypting mt");var H=new Worker(logmeonce.includeUrl("/content/worker.js"));H.addEventListener("message",function(K){if(K.data.success!=null){E.resolve(K.data.success)}if(K.data.error!=null){logmeonce.log("Desktop Mode - Loading file - error: "+K.data.error);E.reject(w._("Desktop mode error - file corrupted")+".")}},false);H.postMessage({sjcl:sjcl.worker,importScripts:[logmeonce.includeUrl("/components/sjcl.js"),logmeonce.includeUrl("/content/tools.js")],call:"tools.decrypt",args:[F,I]})}else{logmeonce.log("Desktop Mode - Loading file - decrypting st");try{E.resolve(logmeonce.tools.decrypt(F,I))}catch(G){logmeonce.log("Desktop Mode - Loading file - error: "+G);E.reject(w._("Desktop mode error - file corrupted")+".")}}return E}var C=logmeonce.config.portable?logmeonce.config.portable:"%user%/LogmeOnce";var v=C+"/profile/"+x.name+"/user.logmeonce";this.log("Desktop Mode - Loading file: "+v);this.readFile(v).then(function(J){function F(){B(J).then(y,function(K){D.reject(K)})}if(logmeonce.config.portable){var I,H,E,G;logmeonce.getFileInfo("%user%/LogmeOnce/profile/"+x.name+"/user.logmeonce").then(function(K){I=K;return logmeonce.getFileInfo(v)}).then(function(L){E=L;if(I!==false&&E!==false&&I.lastModifiedDate!=E.lastModifiedDate){var K=f.Deferred();logmeonce.confirm(A,logmeonce.translate._("Portable Sync Confirmation")).always(function(){K.resolve(this.state()==="resolved")});return K.then(function(M){if(M){logmeonce.log("Desktop Mode - Portable syncing");return logmeonce.readFile(I.name)}return false}).promise()}return false}).then(function(K){if(K!==false&&K.length>0){logmeonce.log("Desktop Mode - Portable syncing - decrypting desktop file");return B(K)}return false}).then(function(K){H=K;if(K!==false&&K.length>0){logmeonce.log("Desktop Mode - Portable syncing - decrypting portable file");return B(J)}return false}).then(function(L){G=L;if(H!==false&&G!==false){try{logmeonce.log("Desktop Mode - Portable syncing - analyzing data");var M=JSON.parse(G);var K=JSON.parse(H);f.each(x.sites,function(P,O){var Q=f.grep(M.sites,function(T,S){return O.id==T.id});var R=f.grep(K.sites,function(T,S){return O.id==T.id});if(Q.length>0&&R.length<=0){O.login.inputs=Q[0].login.inputs}else{if(R.length>0&&Q.length<=0){O.login.inputs=R[0].login.inputs}else{if(R.length>0&&Q.length>0){if((R[0].lastModified||0)>(Q[0].lastModified||0)){O.login.inputs=R[0].login.inputs}else{O.login.inputs=Q[0].login.inputs}}}}});logmeonce.log("Desktop Mode - Portable syncing complete");logmeonce.saveDesktopMode(A,{user:x}).then(function(){return logmeonce.copyFile(E.name,I.name)}).then(function(O){if(O){logmeonce.log("Desktop Mode - Portable syncing - overwriting desktop file")}else{logmeonce.log("Desktop Mode - Portable syncing - can't copy to desktop")}});D.resolve(x)}catch(N){logmeonce.log("Desktop Mode - Portable syncing failed: "+N);y(G)}}else{F()}},F)}else{F()}},function(I){if(typeof I!=="undefined"){function F(){logmeonce.log("Desktop Mode - Loading file - error: Profile file not found");D.reject(w._("Desktop mode error - file not found")+".")}if(logmeonce.config.portable){var H="%user%/LogmeOnce/profile/"+x.name+"/user.logmeonce";var E=logmeonce.config.portable+"/profile/"+x.name+"/user.logmeonce";var J;logmeonce.readFile(H).then(function(K){J=K;return J!==false&&J.length>0?logmeonce.copyFile(H,E):false}).then(function(K){return K?B(J):false}).then(function(K){if(K!==false&&K.length>0){logmeonce.log("Desktop Mode - Loading file - portable file is missing - copying from desktop");y(K)}else{F()}},F)}else{var G="%logmeonce%/profile/"+x.name+"/user.logmeonce";logmeonce.readFile(G).then(function(K){logmeonce.log("Found user data in "+G+" - copying to "+v);logmeonce.writeFile(v,K);B(K).then(y,function(L){D.reject(L)})},F)}}else{logmeonce.log("Desktop Mode - Loading file - error: Missing NPAPI");D.reject(w._("Desktop mode error - unable to read")+".")}});return D},logoutList:function(x,w){if(typeof w==="object"&&f.inArray(x,["update"])>=0&&this.config.logoutList.indexOf(w)<0){var v=f.grep(this.config.logoutList,function(y){return y.host==w.host}).shift();w=f.extend(true,v||{},w)}if(x=="add"){this.config.logoutList.push(w)}},loginList:function(x,w){if(typeof w==="object"&&f.inArray(x,["update","delete","splice"])>=0&&this.config.loginList.indexOf(w)<0){var v=f.grep(this.config.loginList,function(y){return y.id==w.id}).shift();w=f.extend(true,v||{},w)}if(x=="add"){this.config.loginList.push(w)}if(x=="delete"){this.config.loginList.splice(this.config.loginList.indexOf(w),1)}if(x=="splice"){this.config.loginList.splice(this.config.loginList.length-1,0,this.config.loginList.splice(this.config.loginList.indexOf(w),1)[0])}},qr:function(v,w){if(typeof w!=="undefined"){this.config.qr[v]=w}if(v==="clear"){this.config.qr={}}return this.config.qr[v]},user:function(x,y,v){var w=v||this.config.user;if(typeof y!=="undefined"){w[x]=y}if(x=="key"){if(typeof w.keys.encoded==="string"){return this.tools.base64.decode(w.keys.encoded)}if(typeof this.config.password==="string"&&typeof w.keys.password==="string"){return this.tools.decrypt(w.keys.password,this.config.password)}if(typeof this.config.pcr==="string"&&typeof w.keys.mobileconnect==="string"){return this.tools.decrypt(w.keys.mobileconnect,this.config.pcr)}if(typeof this.config.securitykey==="object"&&typeof w.keys.securitykey==="object"&&this.config.securitykey!=null&&typeof w.keys.securitykey[this.config.securitykey.id]==="string"){return this.tools.decrypt(w.keys.securitykey[this.config.securitykey.id],this.tools.base64.decode(this.config.securitykey.key))}if(typeof this.config.push==="string"&&typeof w.session==="string"){return this.tools.decrypt(uthis.config.push,w.session)}throw new j("AES key is not available")}return w[x]},loadUser:function(F,I){var v=f.extend({force:false},typeof I=="object"?I:{});if(v.force==false&&this.config.user!=null){return C()}this.log("Loading user data");this.browser.setIcon(this.config.user!=null,true);var x=this.translate;function C(){var K=f.Deferred();var J={user:logmeonce.config.user.id,version:p,plugin:logmeonce.pluginLoader.version!=null?logmeonce.pluginLoader.version:false};if(!J.plugin&&logmeonce.plugin!=null){logmeonce.plugin.version.then(function(L){K.resolve(f.extend(J,{plugin:L}))},function(){K.resolve(J)});return K.promise()}return K.resolve(J).promise()}function B(J){logmeonce.log("Loading user data succesfull: "+J.id+": "+J.name);logmeonce.config.get("user").then(function(L){var M=typeof L==="string"&&L.length>0?L.split(","):[];if(J.name!=M[0]){M[0]=J.name;M[1]="password"}if(J.pictureUrl!=null){M[2]=J.pictureUrl}logmeonce.config.set("user",M.join(","))});logmeonce.config.set("offline.password-manager",!J.owner&&(J.settings.flags&4)==4?1:0);logmeonce.config.set("offline.ads",J.license<=1||J.license==100?1:0);logmeonce.config.set(logmeonce.tools.hash("sha1","privacy."+J.name),logmeonce.tools.encrypt(JSON.stringify({camera:typeof J.settings.camera==="number",location:(J.settings.flags&1024)!=1024}),"privacy."+J.name));f.each(J.profile instanceof Array?J.profile:[J.profile],function(N,O){var L=[];if(O.firstname!=null){L.push(O.firstname)}if(O.lastname!=null){L.push(O.lastname)}if(L.length>0){O.fullname=L.join(" ")}if(O.birthdate!=null){var M=(function(R,S,Q){return new Date(parseInt(R),parseInt(S)-1,parseInt(Q))}).apply(this,O.birthdate.split("-"));var P=new Date().getTime()-M.getTime();O.age=Math.abs(new Date(P).getUTCFullYear()-1970)}});f.each(J.address instanceof Array?J.address:[J.address],function(M,L){if(L.city!=null){L.location=L.city;if(L.state!=null){L.location+=", "+L.state.code}else{if(L.country!=null&&L.country.code!="US"){L.location+=", "+L.country.name}}}});f.each(J.groups,function(M,N){N.path=N.parent!=null?L({parent:N.parent,path:[N.name]}).reverse().join("\\"):null;function L(O){f.each(J.groups,function(P,Q){if(O.parent==Q.id){O.path=L({parent:Q.parent,path:O.path.concat([Q.name])})}});return O.path}});logmeonce.config.brand=J.brand!=null?J.brand:{};delete J.brand;logmeonce.enable(F,J);var K=logmeonce.config.passwordManager;if(K.form!=null&&f.grep(K.form.inputs,function(L){return L.type=="password"}).length>0&&K.time!=null&&new Date().getTime()-K.time<300000){logmeonce.savePasswordManager(F,f.extend(logmeonce.config.passwordManager.form,{id:true}))}return C()}function A(K){var J=f.Deferred();var L=null;if(F==null||logmeonce.regex.test(F.location.href,logmeonce.regex.server("(dashboard)?$"),"i")==false){if(K.update!=null){L=x.sprintf(x._("%s extension require update to %s from %s"),logmeonce.browser.name,K.update.version,p)+".\n"+x._("Would you like to update?");delete K.update}else{if(K.plugin!=null&&K.plugin.version<=p){if(logmeonce.pluginLoader.version!=null){L=x.sprintf(x._("%s plugin require update to %s from %s"),x.company,K.plugin.version,logmeonce.pluginLoader.version)+".\n"+x._("Would you like to update?")}delete K.plugin}}}if(L!=null){logmeonce.confirm(F,L).then(function(){logmeonce.urlGoto("/download",{newtab:true})}).always(function(){J.resolve(K)});return J.promise()}else{return J.resolve(K).promise()}}function w(K){var J=f.Deferred();if(v.password!=null){logmeonce.config.password=v.password}try{logmeonce.config.set("sek",logmeonce.tools.encrypt(logmeonce.user("key",undefined,K),K.session));if(K.keys.mobileconnect==null&&logmeonce.config.pcr!=null){var L=logmeonce.tools.encrypt(logmeonce.user("key",undefined,K),logmeonce.config.pcr);f.ajax({url:logmeonce.server+"rest/user/"+K.id,type:"POST",data:{key:{mobileconnect:L}},dataType:"logmeonce-binary",headers:{Authorization:"Token "+K.token}}).then(function(){logmeonce.log("Saving user mobileconnect key succesfully");K.keys.mobileconnect=L;J.resolve(K)},function(P,O,N){logmeonce.log("Saving user mobileconnect key failed: "+O);J.resolve(K)})}else{J.resolve(K)}}catch(M){logmeonce.config.get("sek").then(function(N){try{K.keys.encoded=logmeonce.tools.base64.encode(logmeonce.tools.decrypt(N,K.session))}catch(O){}J.resolve(K)});J.resolve(K)}return J.promise()}function z(N){var K=f.Deferred();var J=logmeonce.config.portable?logmeonce.config.portable:"%user%/LogmeOnce";var M=J+"/profile/"+N.name+"/user.offline";var L=N.offline!==true&&N.settings.flags&512;if(L&&typeof logmeonce.config.password==="string"){var O=logmeonce.user("key",undefined,N);var P=logmeonce.tools.encrypt(O,logmeonce.config.password,true,"string");logmeonce.log("Offline mode - saving key file");logmeonce.writeFile(M,P).then(function(){if(!(N.flags&u)){logmeonce.log("Offline mode - saving desktop mode file");return logmeonce.saveDesktopMode(F,{user:N})}}).then(function(){logmeonce.config.set("offline.login",1)},function(){logmeonce.log("Offline mode - saving key failed")}).always(function(){K.resolve(N)})}else{if(!L&&N.offline!==true){logmeonce.log("Offline mode - removing key");logmeonce.removeFile(M).then(function(){logmeonce.config.set("offline.login",null);if(!(N.flags&u)){logmeonce.log("Offline mode - removing desktop mode file");return logmeonce.removeDesktopMode(F,{user:N})}}).always(function(){K.resolve(N)})}else{K.resolve(N)}}return K.promise()}function H(J){if(J.offline!==true&&J.flags&u&&J.sites.length>0){try{logmeonce.user("key",undefined,J)}catch(K){logmeonce.log("Desktop Mode - Loading file - error: Password not available");logmeonce.desktopModeUser=J;logmeonce.passwordEvent={name:"loadUser",args:f.extend(v,{dmid:J.id})};logmeonce.injectVerificationUi(F,{user:J,event:{name:"loadKey",args:{dmid:J.id}}});return f.Deferred().reject({exception:{message:x.sprintf(x._("%s extension require verification"),COMPANY_NAME)+"."},alert:false})}return logmeonce.loadDesktopMode(F,{user:J}).then(function(L){f.each(J.sites,function(N,M){f.each(L.sites,function(O,P){if(M.user==null&&M.id==P.id){M.login.inputs=P.login.inputs;return false}})});logmeonce.log("Desktop Mode - Loading file complete");return J},function(L){return{exception:{message:L}}})}return f.Deferred().resolve(J)}function y(J){return A(J).then(w).then(z).then(H).then(B).always(function(){logmeonce.browser.setIcon(logmeonce.config.user!=null,false)})}function E(K,L,J){logmeonce.log("Loading user data failed: "+L);logmeonce.browser.setIcon(logmeonce.config.user!=null,false);return L!=null&&L.length>0&&!(L=="error"||L=="parsererror")?{exception:{message:L}}:{exception:{message:x._("Login Error")+". "+x._("Try Again")+"."}}}function G(J){return f.ajax({url:logmeonce.server+"rest/extension",dataType:"logmeonce-binary",headers:{Authorization:"Token "+J}}).then(function(K){if(logmeonce.config.user!=null&&logmeonce.config.user.id==K.id&&logmeonce.config.user.name!=K.name&&logmeonce.config.user.flags&u){return logmeonce.saveDesktopMode(F,{user:logmeonce.config.user,username:K.name}).then(function(){return y(f.extend(K,{token:J}))},function(){return{exception:{message:logmeonce.translate._("Desktop mode error - unable to write")+"."}}})}return y(f.extend(K,{token:J}))},E)}function D(J){try{logmeonce.log("Offline Mode - loading desktop mode file");logmeonce.config.password=v.password;logmeonce.user("key",undefined,J);return logmeonce.loadDesktopMode(F,{user:J}).then(function(L){delete L.session;delete L.token;delete L.update;var M={create:1,update:4,"delete":8,personal:32};f.each(M,function(N,O){L.allowed=L.allowed&~O});return y(f.extend(L,{offline:true}))})}catch(K){logmeonce.log("Offline Mode - unable to read key: "+K);return f.Deferred().reject({exception:{message:x._("User login failed")}})}}if(v.dmid!=null&&this.desktopModeUser!=null&&this.desktopModeUser.id==v.dmid){return y(logmeonce.desktopModeUser)}else{if(v.offline!=null){return D(v.offline)}else{if(v.token!=null){return G(v.token)}else{return f.ajax({url:logmeonce.server+"rest/authenticate/token",dataType:"logmeonce-binary"}).then(G,E)}}}},matchSite:function(E,D){var x=D.site.url;var C=D.site.inputs;var y=f.grep(C,function(G){return G.flags!=null&&(G.flags&e||G.flags&k)}).length>0;var z=[];var A=this.config.user!=null?f.grep(this.config.user.sites,function(H,G){return x!=null&&(H.login.regex!=null&&new RegExp(H.login.regex,"i").test(x)||H.login.url==x)}):[];var B=function(G,J){var H=[];try{H=JSON.parse(G.name)}catch(I){}return G.name==J.name||f.inArray(J.name,H)>=0};var w=function(G,H){return G.type==H.type};var F=function(G,I){var H=0;f.each(I,function(K,J){f.each(C,function(M,P){if(((J.name!=null&&B(J,P))||(J.name==null&&w(J,P)&&!y))||(J.flags!=null&&P.flags!=null&&J.flags&e&&P.flags&e)||(J.flags!=null&&P.flags!=null&&J.flags&k&&P.flags&k)){try{var L=logmeonce.aesKey(E,D.passwordEvent||false,G);var N=J.value!=null&&J.value.length>0?logmeonce.tools.decrypt(J.value,L):"";if(logmeonce.equals(P.value,N,J.flags!=null&&J.flags&e?"username":null)){H++}}catch(O){}}})});return I.length>0&&H>=I.length};f.each(A,function(K,J){var H=f.grep(J.login.inputs,function(M,N){return((M.flags==null||M.flags&t)&&(M.type=="text"||M.type=="email"||M.type=="select"))});var L=f.grep(J.login.inputs,function(M,N){return((M.flags==null||M.flags&t)&&M.type=="password")});if(H.length>0){var G=F(J,H);var I=F(J,L);if(G){logmeonce.log("Matching site ["+J.id+"] "+J.name+" - text: "+G+" password: "+I);z.push({site:J,text:G,password:I})}}else{if(L.length>0&&f.grep(C,function(M,N){return M.value!=null&&M.value.length>0&&(M.type=="text"||M.type=="email"||M.type=="select")}).length<=0){var I=F(J,L);logmeonce.log("Matching site ["+J.id+"] "+J.name+" - password: "+I);z.push({site:J,text:false,password:I})}}});if(D.format!=null&&D.format=="id"){var v=[];f.each(z,function(H,G){v.push(G.site.id)});return v.length>0?(v.length<=1?v[0]:v):false}return z.length>0?z:false},deleteSite:function(w,y){var v=f.Deferred();if(this.config.user!=null&&this.config.user.sites!=null&&y.site!=null){var z;if((z=f.grep(this.config.user.sites,function(A){return A.id==y.site})).length<=0){return v.reject({exception:{message:this.translate._("Site not found")}})}var x=z[0];this.log("Deleting site: "+(x.name!=null?x.name:x.id));f.ajax({url:this.server+"rest/sites/"+x.id,dataType:"logmeonce-binary",type:"DELETE"}).then(function(A){logmeonce.sites(w,{remove:x.id});v.resolve({success:true,total:logmeonce.config.user.sites.length})},function(C,B,A){if(C.status==404){logmeonce.sites(w,{remove:x.id});v.resolve({success:true,total:logmeonce.config.user.sites.length});return}logmeonce.log("Deleting site failed ("+C.status+"): "+B);v.reject({exception:{message:B}})})}return v.promise()},loadGroup:function(v,x){if(this.config.user!=null&&this.config.user.sites!=null){var w=this.config.user;var z=x.group;var y=f.grep(w.groups,function(A){return A.id==z.id});if(y.length<=0){logmeonce.log("Adding new group: "+z.name);logmeonce.config.user.groups.push(z)}return f.Deferred().resolve(z)}return f.Deferred().reject()},saveGroup:function(v,w){var A=f.extend(true,{},w.group);if(A.created==="import"&&A.adapter==="lastpass"&&A.name.indexOf("\\")>0){var y=f.Deferred().resolve();var z=A.name.split(/\\/);var B=Math.min(3,z.length);for(var x=0;x<B;x++){y=y.then(function(C,D){return function(F){var E=f.grep(logmeonce.config.user.groups,function(G){var H=G.path!=null?G.path:G.name;return H==D}).shift();return E!=null?E:logmeonce.saveGroup(v,f.extend(true,{},w,{group:{name:C,parent:F!=null?F.id:undefined}}))}}(z.slice(x,x<B-1?x+1:z.length).join("\\"),z.slice(0,x<B-1?x+1:z.length).join("\\")))}return y}this.log("Saving group: "+A.name);return f.ajax({url:this.server+"rest/groups",dataType:"logmeonce-binary",data:A,type:"POST"}).then(function(C){logmeonce.loadGroup(v,{group:C});return C},function(E,D,C){return C})},saveNote:function(v,w){var y=f.extend(true,{},w.note);var z=y.title;var x=logmeonce.aesKey(v,w.passwordEvent);f.each(["title","body"],function(A,C){var B=y[C];y[C]=B!=null&&String(B).length>0?logmeonce.tools.encrypt(String(B),x):null});f.each(y.attributes!=null?y.attributes:{},function(A,B){y.attributes[A]=B!=null&&String(B).length>0?logmeonce.tools.encrypt(String(B),x):null});this.log("Saving note: "+z);return f.ajax({url:this.server+"rest/notes",dataType:"logmeonce-binary",data:y,type:"POST"}).then(function(A){return A},function(C,B,A){return A})},saveSiteTotp:function(v,w){return this.saveSite(v,{site:{id:w.site.id,key:w.site.key,inputs:[{flags:32,value:w.code}]}})},saveSite:function(F,E){var G=f.Deferred();var z=[];var v=E.method!=null?E.method:"POST";var w=f.extend(true,{},E.site);var B=w.id!=null?this.sites(F,{id:w.id}):null;var A=null;if(typeof w.group!=="undefined"&&f.inArray(w.group,["default","personal","owner"])<0){var D=typeof w.group==="string"&&isNaN(parseInt(w.group))?"name":"id";A=f.grep(this.config.user.groups,function(H){if(D=="name"){return H.path==w.group||H.name==w.group}return H.id==w.group}).shift();w.group=A!=null?A.id:null;if(A!=null&&typeof A.user==="number"){w.user=A.user}}else{if(w.group==="owner"&&this.config.user.owner!=null){w.user=this.config.user.owner}}if(typeof w.key=="undefined"&&A!=null&&A.key!=null&&(B==null||B.key==null)){w.key={encrypt:sjcl.random.randomWords(8)}}if(typeof w.key=="object"&&w.key.encrypt!=null){if(w.key.format!=null&&w.key.format=="base64"){w.key.encrypt=logmeonce.tools.base64.decode(w.key.encrypt)}w.key=logmeonce.tools.encrypt(w.key.encrypt,logmeonce.aesKey(F,E.passwordEvent));if(w.inputs==null&&B!=null){w.inputs=[];f.each(B.login.inputs,function(I,H){w.inputs.push(f.extend(true,{},H,{value:H.value!=null&&H.value.length>0&&H.type!="radio"?logmeonce.tools.decrypt(H.value,logmeonce.aesKey(F,E.passwordEvent,B)):H.value}))})}}else{if(w.key!==false&&B!=null&&B.key!=null){w.key=B.key}}if(typeof w.key=="string"&&A!=null&&A.key!=null){w.group={id:w.group,key:logmeonce.tools.encrypt(logmeonce.tools.decrypt(w.key,logmeonce.aesKey(F,E.passwordEvent)),logmeonce.tools.decrypt(A.key,logmeonce.aesKey(F,E.passwordEvent)))}}if(w.inputs!=null&&f.grep(w.inputs,function(H,I){return H.flags!=null&&!isNaN(H.flags)}).length<=0){var y=this.formAnalyze(w);if(y.username!=null){y.username.flags=e;w.username=y.username.value}if(y.password!=null){y.password.flags=k}}if(w.username==null&&w.inputs!=null){f.each(w.inputs,function(I,H){if(H.flags!=null&&H.flags&e){w.username=H.value;return false}})}var x;if(E.match!=null&&E.match===true&&(x=this.matchSite(F,{site:w,format:"id",passwordEvent:E.passwordEvent}))!==false){throw new j(this.translate._("This site already exists")+".",{matched:x})}w.inputs!=null&&f.each(w.inputs,function(K,I){var N=B!=null&&B.login!=null&&B.login.inputs!=null&&B.login.inputs.length>K?B.login.inputs[K]:null;if(N!=null&&N.type==I.type&&f.inArray(I.type,["radio","checkbox"])<0){var J=logmeonce.aesKey(F,E.passwordEvent,B);var O=N.value!=null&&N.value.length>0?logmeonce.tools.decrypt(N.value,J):"";I.changed=O!=I.value}if(I.type=="password"&&I.value!=null){var M=Math.min(255,I.value.length);var H=((I.value.length>0&&I.value.match(/[A-Z]/g)?1:0)|(I.value.length>0&&I.value.match(/[a-z]/g)?2:0)|(I.value.length>0&&I.value.match(/[0-9]/g)?4:0)|(I.value.length>0&&I.value.match(/[^a-zA-Z0-9\s]/g)?8:0))<<8;I.policy=M|H;I.strength=logmeonce.tools.pwdStrength(I.value);if(logmeonce.config.user.licensed.darkweb&&I.leaked==null){var L=f.Deferred();logmeonce.tools.passwordLeaked(I.value).then(function(P){I.leaked=P}).always(function(){L.resolve()});z.push(L)}}if(I.value!=null&&I.value.length>0&&I.type!="radio"){I.value=logmeonce.tools.encrypt(I.value,logmeonce.aesKey(F,E.passwordEvent,w))}});if(w.note!=null&&w.note.length>0){w.note=logmeonce.tools.encrypt(w.note,logmeonce.aesKey(F,E.passwordEvent,w))}var C=null;if(logmeonce.config.user.flags&u){C=[];w.inputs!=null&&f.each(w.inputs,function(I,H){C.push(f.extend({},H));delete H.value})}this.log(w.id!=null?"Saving site: "+w.name:"Saving new site");f.when.apply(f,z).then(function(){return f.ajax({url:logmeonce.server+"rest/sites/",dataType:"logmeonce-binary",data:f.extend(w,{desktopMode:logmeonce.config.user.flags&u?"true":"false"}),type:v})}).then(function(H){if(H instanceof Array){f.each(H,function(J,I){logmeonce.loadApp(F,{site:I,saving:true,mapped:C})})}else{logmeonce.loadApp(F,{site:H,saving:true,mapped:C})}if(logmeonce.config.user.flags&u){if(E.beforeDesktopMode==null||E.beforeDesktopMode.call(this)!==false){logmeonce.saveDesktopMode(F)}}G.resolve({status:"success",site:H})},function(I,J,H){logmeonce.log("Saving site failed: "+J);if(H!=null&&H.exception!=null&&H.exception.code===100){if(E.cyclic==null||E.cyclic==false){logmeonce.loadUser(F,{force:true}).then(function(){logmeonce.saveSite(F,f.extend(E,{cyclic:true})).then(function(){G.resolve.apply(this,arguments)},function(){G.reject.apply(this,arguments)})});return}else{logmeonce.log("Saving site - not allowing more retries")}}G.reject({status:"error",exception:{message:J}})});return G.promise()},loadApp:function(w,z){if(this.config.user!=null&&this.config.user.sites!=null){var x=this.config.user;if(z.site!=null){if(x.flags&u){if(z.saving===true){z.site.lastModified=new Date().getTime()}if(z.mapped!=null){f.each(z.site.login.inputs,function(D,C){if(C.index!=null&&z.mapped[C.index]!=null){C.value=z.mapped[C.index].value}})}}var y=z.site;if(y.login.inputs instanceof Array){f.each(y.login.inputs,function(D,C){delete C.index})}var B=f.grep(x.sites,function(D,C){if(D.id==y.id){if(D.changepassword!=null&&D.changepassword.status=="saving"&&y.changepassword.status==null){logmeonce.log("Change password for "+y.name+" - completed");logmeonce.site("changepassword",function(){this.changepassword.time=0;this.changepassword.status=y.changepassword.status="completed"},D)}logmeonce.config.user.sites[C]=y;return true}});if(B.length<=0){var v=f.Deferred();if(x.flags&u&&y.login.inputs.length<=0){logmeonce.log("Loading new site "+y.name+" - no inputs - checking Destkop Mode data");logmeonce.loadDesktopMode(w).then(function(C){f.each(C.sites,function(D,E){if(y.id==E.id){y.login.inputs=E.login.inputs;return false}});v.resolve()})}else{v.resolve()}return v.then(function(){if(x.license==10&&y.key==null&&y.user!=null&&x.share[y.user]==null){return f.ajax({url:logmeonce.server+"rest/extension/share",dataType:"json",}).then(function(C){logmeonce.user("share",C)})}}).then(function(){logmeonce.log("Adding new site: "+y.name);logmeonce.config.user.sites.push(y);return y})}if(z.refresh===true){w.lmoContentLoaded=null}return f.Deferred().resolve(y)}else{if(z.id!=null){var y=f.grep(x.sites,function(C){return C.id==z.id}).shift();var A={};if(x.flags&u&&y!=null){A.inputs=[];f.each(y.login.inputs,function(D,C){var E=f.extend({},C);delete E.value;A.inputs.push(E)})}return f.ajax({url:this.server+"rest/sites/"+z.id,dataType:"logmeonce-binary",data:A}).then(function(C){if(typeof C.group==="undefined"){C.group=null}return logmeonce.loadApp(w,f.extend(z,{site:C,mapped:y!=null?y.login.inputs:null}))},function(E,D,C){logmeonce.log("Load App: "+D);return C})}}}return f.Deferred().reject()},fireEvent:function(v,w){if(v.createEvent){if(typeof w=="object"&&w.ui!=null){w={ui:w.ui,message:logmeonce.tools.encrypt(JSON.stringify(w),this.config.ui)}}else{if(typeof w=="object"&&f.inArray(this.browser.type,["ie","safari","chrome"])>=0){w=JSON.stringify(w)}}if(typeof w=="object"&&typeof cloneInto!=="undefined"){try{w=cloneInto(w,v.defaultView)}catch(x){w=JSON.stringify(w)}}if(typeof CustomEvent=="function"){var x=new CustomEvent("LMOResponseEvent",{detail:w})}else{var x=v.createEvent("CustomEvent");x.initCustomEvent("LMOResponseEvent",false,false,w)}v.dispatchEvent(x)}else{var x=v.createEventObject();x.propertyName="LMOResponseEvent";v.lmoResponseDetail=w;v.documentElement.fireEvent("onpropertychange",x)}},fireEventResponse:function(v,x,w){if(f.inArray(typeof w,["object","function"])>=0&&typeof w.then=="function"){this.fireEvent(v,{name:"completed",event:x.id,ui:x.ui});w.then(function(){logmeonce.fireEvent(v,{name:"deferred",event:x.id,ui:x.ui,deferred:"resolve",arguments:Array.prototype.slice.call(arguments)})},function(){logmeonce.fireEvent(v,{name:"deferred",event:x.id,ui:x.ui,deferred:"reject",arguments:Array.prototype.slice.call(arguments)})},function(){logmeonce.fireEvent(v,{name:"deferred",event:x.id,ui:x.ui,deferred:"notify",arguments:Array.prototype.slice.call(arguments)})})}else{if(typeof w=="function"){w(function(y){logmeonce.fireEventResponse(v,x,y)});this.fireEvent(v,{name:"completed",event:x.id,ui:x.ui})}else{if(typeof w=="undefined"||w!=null){this.fireEvent(v,{name:"response",event:x.id,ui:x.ui,response:w})}}}},apply:function(w,v){try{return this[w].apply(this,v)}catch(x){return{exception:x instanceof j?x.toObject():{message:""+x}}}},onEvent:function(v,x){if(typeof XPCNativeWrapper!=="undefined"){x=XPCNativeWrapper.unwrap(x)}if(x.ui!=null&&x.message!=null){x=f.extend(JSON.parse(this.tools.decrypt(x.message,this.config.ui)),{ui:x.ui})}else{if(v!=null){if(!this.regex.test(v.location.href,this.regex.server(".*"),"i")){throw"Event: "+v.location+" - Server should be: "+logmeonce.server}if(v.location.href.indexOf(this.server)!==0){this.domain(v)}}}if(f.isArray(x.args)===false){x.args=[x.args]}if(typeof x.args[0]==="object"&&x.args[0]!=null&&x.args[0].passwordRequired===true){x.args[0].passwordRequired=new Date().getTime()}if(typeof x.args[0]==="object"&&x.args[0]!=null&&x.args[0].passwordEvent===true){x.args[0].passwordEvent={name:"onEvent",args:f.extend(true,{},x)}}try{var w=this.handleEvent(v,x);if(typeof w!=="undefined"){this.fireEventResponse(v,x,w)}}catch(y){this.fireEventResponse(v,x,{exception:y instanceof j?y.toObject():{message:""+y}})}},handleEvent:function(v,w){switch(w.name){case"version":return{version:p};case"sso":case"about":case"decrypt":case"encrypt":case"loadKey":case"loadPasswordManager":case"savePasswordManager":case"loadApp":case"deleteSite":case"saveSite":case"login":case"loginSite":case"loginTesting":case"loginActions":case"loadUser":case"exporting":case"importing":case"importAdapter":case"importEvent":case"usb":case"storage":case"sites":case"passwordChanger":case"push":case"notes":case"offline":w.args.unshift(v);return this[w.name].apply(this,w.args);case"log":w.args.unshift(null);return this[w.name].apply(this,w.args);case"copyToClipboard":case"readFileDialog":return this[w.name].apply(this,w.args);case"urlGoto":this.urlGoto(w.args[0].url,w.args[0]);break;case"newtab":this.injectUi(v,{name:"newtab",args:["about:blank"]});break;case"closetab":this.window(v,"close");break;default:throw"Not supported"}},aesKey:function(v,z,x){if(this.config.user==null){throw"User is not logged"}try{var w=this.config.user;var y=w.share[w.id]!=null?this.tools.decrypt(w.share[w.id],this.user("key")):this.user("key");if(x!=null&&x.key!=null&&x.key!=false){return this.tools.decrypt(x.key,x.user!=null&&x.group!=null&&f.grep(w.groups,function(B){return B.id==x.group[0]&&B.key!=null}).length>0?this.tools.decrypt(f.grep(w.groups,function(B){return B.id==x.group[0]}).shift().key,y):(x.user!=null&&w.share[x.user]!=null?this.tools.decrypt(w.share[x.user],w.owner!=null&&w.owner!=x.user?this.tools.decrypt(w.share[w.owner],y):y):y))}else{if(x!=null&&x.user!=null&&w.share[x.user]!=null){return this.tools.decrypt(w.share[x.user],w.owner!=null&&w.owner!=x.user?this.tools.decrypt(w.share[w.owner],y):y)}else{return y}}}catch(A){this.log("AES Key failed: "+A);if(typeof z=="object"||typeof z=="undefined"||z==true){this.passwordEvent=z!=null?f.extend(this.passwordEvent||{},z):null;this.injectVerificationUi(v);throw new j(this.translate.sprintf(this.translate._("%s extension require verification"),this.translate.company),{ui:true})}else{throw new j(this.translate.sprintf(this.translate._("%s extension require verification"),this.translate.company),{ui:false})}}},loadKey:function(v,B){var z=f.Deferred();var y=this.config.user!=null?this.config.user:(B.dmid!=null&&this.desktopModeUser!=null&&this.desktopModeUser.id==B.dmid?this.desktopModeUser:null);if(B.verification!=null&&B.verification=="password"){try{this.log("Loading password");this.tools.decrypt(y.keys.password,B.password);z.resolve({password:B.password,verified:true})}catch(B){this.log("Loading password key failed: "+B);z.reject({exception:{message:logmeonce.translate.sprintf(logmeonce.translate._("%s is not valid"),logmeonce.translate._("Password"))+"."}})}}else{if(B.verification!=null&&B.verification.indexOf("push")===0){f.ajax({url:logmeonce.server+"rest/push/verification",data:{verification:B.verification},dataType:"logmeonce-binary",headers:{Authorization:"Token "+y.token}}).then(function(D){var C=sjcl.random.randomWords(8);return logmeonce.push(v,{device:D,secret:sjcl.codec.base64.fromBits(C)}).then(function(E){try{return{key:logmeonce.tools.base64.encode(logmeonce.tools.decrypt(E.secret,logmeonce.tools.binary.fromBits(C)))}}catch(E){return f.Deferred().reject({exception:{message:"Invalid data"}})}})},function(E,D,C){return{text:D,exception:C.exception}}).then(function(C){z.resolve(f.extend(C,{verified:true}))},function(){z.reject.apply(this,arguments)},function(C){if(B.verification=="push-login"&&C!=null&&C.challenge!=null){f.extend(C,{otp:logmeonce.tools.hotp({codec:"utf8String",key:C.challenge},1)})}z.notify.apply(this,arguments)})}else{if(B.verification!=null&&B.verification=="mobileconnect"){var x=sjcl.random.randomWords(8);var w=B.phone;f.ajax({url:logmeonce.server+"rest/verification/"+B.verification,type:"POST",data:B.code!=null&&B.state!=null>0?{code:B.code,state:B.state,secret:sjcl.codec.base64.fromBits(x)}:{phone:w},dataType:"logmeonce-binary"}).then(function(C){if(C!=null&&C.redirectUrl!=null){return z.notify.apply(this,arguments)}if(C!=null&&C.link!=null){return z.reject({exception:{message:logmeonce.translate.sprintf(logmeonce.translate._("Mobile connect %s is not linked"),w)}})}try{var D=logmeonce.tools.decrypt(C.secret,logmeonce.tools.binary.fromBits(x));logmeonce.log("Loading mobileconnect key");logmeonce.tools.decrypt(y.keys.mobileconnect,D);z.resolve({pcr:D,verified:true})}catch(C){logmeonce.log("Loading mobileconnect key failed: "+C);z.reject({exception:{message:""+C}})}},function(E,D,C){z.reject({exception:C.exception})})}else{if(B.verification!=null&&B.verification=="security-question"){try{this.log("Loading security question");var A;try{A=this.tools.decrypt(y.keys.question,B.answer.toLowerCase().trim())}catch(B){A=this.tools.decrypt(y.keys.question,B.answer.trim())}z.resolve({key:this.tools.base64.encode(A),verified:true})}catch(B){this.log("Loading security question key failed: "+B);z.reject({exception:{message:logmeonce.translate.sprintf(logmeonce.translate._("%s is not valid"),logmeonce.translate._("Answer"))+"."}})}}else{if(B.password!=null||B.pcr!=null||B.key!=null){z.resolve(f.extend(B,{verified:typeof B.verified=="undefined"&&this.regex.test(v.location.href,this.regex.server("getting(.)?started*"),"i")}))}else{z.reject()}}}}}return z.then(function(E){if(E.password!=null){logmeonce.config.password=E.password;if(y!=null){y.keys.encoded=null;logmeonce.config.set("sek",logmeonce.tools.encrypt(logmeonce.tools.decrypt(y.keys.password,E.password),y.session))}}else{if(E.pcr!=null){logmeonce.config.pcr=E.pcr;logmeonce.config.password=null;if(y!=null){y.keys.encoded=null;logmeonce.config.set("sek",logmeonce.tools.encrypt(logmeonce.tools.decrypt(y.keys.mobileconnect,E.pcr),y.session))}}else{if(y!=null&&E.key!=null){y.keys.encoded=E.key;logmeonce.config.set("sek",logmeonce.tools.encrypt(logmeonce.tools.base64.decode(E.key),y.session))}}}if(y!=null&&y.keys.mobileconnect==null&&logmeonce.config.pcr!=null&&E.verified){try{var C=f.Deferred();var D=logmeonce.tools.encrypt(logmeonce.user("key",undefined,y),logmeonce.config.pcr);f.ajax({url:logmeonce.server+"rest/user/"+y.id,type:"POST",data:{key:{mobileconnect:D}},dataType:"logmeonce-binary",headers:{Authorization:"Token "+y.token}}).then(function(){logmeonce.log("Saving user mobileconnect key succesfully");y.keys.mobileconnect=D;C.resolve(E)},function(H,G,F){logmeonce.log("Saving user mobileconnect key failed: "+G);C.resolve(F)});return C}catch(E){}}return E}).then(function(E){if(logmeonce.passwordEvent!=null&&logmeonce.passwordEvent.name!=null&&logmeonce.passwordEvent.args!=null){var D=logmeonce.passwordEvent.name;var C=logmeonce.passwordEvent.args;logmeonce.passwordEvent.name=null;logmeonce.passwordEvent.args=null;logmeonce.passwordEvent.last=D;if(typeof logmeonce[D]=="function"){logmeonce.log("Running saved event: "+D);if(C instanceof Array){logmeonce[D].apply(logmeonce,C)}else{logmeonce[D].call(logmeonce,v,C)}}}return E}).promise()},decrypt:function(v,y){var A=f.extend({text:typeof y==="string"?y:"",passwordEvent:false,site:null,user:null},typeof y=="object"?y:{});var w=A.input||A.text;var x=A.site!=null&&this.config.user!=null?this.sites(v,{id:A.site}):(A.user!=null?{user:A.user}:null);var z=A.key!=null?A.key:this.aesKey(v,A.passwordEvent,x);if(typeof z==="object"&&z.decrypt!=null){z=this.tools.decrypt(z.decrypt,z.key||this.aesKey(v,A.passwordEvent))}if(typeof w==="object"&&f.isArray(w)&&typeof cloneInto!=="undefined"){w=cloneInto(w,window)}return logmeonce.tools.decrypt(w,z,A.output)},encrypt:function(A,E){var v=f.extend({text:typeof E==="string"?E:"",passwordEvent:false,user:null,crc:true,output:"base64"},typeof E=="object"?E:{});var B=v.input||v.text;var w=v.user!=null?{user:v.user}:(v.site!=null&&this.config.user!=null?this.sites(A,{id:v.site}):null);var C=v.key!=null?v.key:this.aesKey(A,v.passwordEvent,w);if(typeof C==="object"&&C.decrypt!=null){C=this.tools.decrypt(C.decrypt,C.key||this.aesKey(A,v.passwordEvent))}if(typeof B==="object"&&B.decrypt!=null){B=this.tools.decrypt(B.decrypt,B.key||this.aesKey(A,v.passwordEvent))}if(typeof B==="object"&&f.isArray(B)&&typeof cloneInto!=="undefined"){B=cloneInto(B,window)}if(typeof v.aes!=="undefined"){if(this.config.user==null&&typeof v["2fa"]==="object"){var y=v["2fa"];try{B=this.user("key",undefined,{session:y.session,keys:{password:y.key}})}catch(z){throw"User is not logged"}}else{if(v.aes==="owner"&&this.config.user.owner!=null){B=this.aesKey(A,v.passwordEvent,{user:this.config.user.owner})}else{B=this.aesKey(A,v.passwordEvent)}}}if(v.worker===true){var D=f.Deferred();if(!!window.Worker&&this.browser.type!="ie"){D.notify({progress:"encrypt",worker:true});var x=new Worker(this.includeUrl("/content/worker.js"));x.addEventListener("message",function(F){F.data.success!=null&&D.resolve(F.data.success);F.data.error!=null&&D.reject(F.data.error)},false);x.postMessage({sjcl:sjcl.worker,importScripts:[this.includeUrl("/components/sjcl.js"),this.includeUrl("/content/tools.js")],call:"tools.encrypt",args:[B,C,v.crc,v.output]})}else{D.notify({progress:"encrypt",worker:false});D.resolve(this.tools.encrypt(B,C,v.crc,v.output))}return D.promise()}return this.tools.encrypt(B,C,v.crc,v.output)},matchForm:function(w,y){if(f.isArray(y.login.match)){return f.grep(y.login.match,function(D){return logmeonce.matchForm(w,f.extend({},y,{login:{match:D}}))}).length===login.match.length}var x=f.extend({exists:false,match:true,empty:true},y.login.match);var v=true;if(x.username!=null){var C,z;if((z=f(x.username,w)).length<=0||(C=f.grep(y.login.inputs,function(D){return D.flags!=null&&D.flags&e}).shift())==null){return !x.exists}try{var A=[C=C.value!=null?logmeonce.tools.decrypt(C.value,logmeonce.aesKey(w,false,y)):"",z=z.prop("tagName")=="INPUT"?z.val():z.text()];if(typeof x.trim==="string"){f.each(A,function(D,E){A[D]=logmeonce.tools.trim(E,x.trim)})}v=logmeonce.equals(A[0],A[1],"username")===x.match}catch(B){}if(!v&&z.length<=0){return x.empty}}return v},findForm:function(I,y,G){var H=G!=null&&G.type!=null?G.type:null;var E=G!=null&&G.listAll!=null?G.listAll:false;var x=G!=null&&G.cache!=null?G.cache:null;if(y.login.match!=null&&!this.matchForm(I,y)){return null}if(y.login.inputs!=null&&y.login.inputs.length>0){var K=y.login;var w=f.grep(logmeonce.config.user.autofill.mapping,function(M){return logmeonce.regex.test(I.location.href,M.url,"i")});var C=f.grep(w,function(M){return M.name=="username"}).shift();var L=f.grep(w,function(M){return M.name=="password"}).shift();var B=null;var J=null;if(K.inputs.length==2&&f.grep(K.inputs,function(N,M){return N.name==null}).length==2){f.each(K.inputs,function(N,M){switch(M.type){case"email":case"text":B={user:M,target:null,visible:false};break;case"password":J={user:M,target:null,visible:false};break}})}if(G!=null&&G.anonymous==true&&f.grep(K.inputs,function(N,M){return N.flags!=null&&N.flags&e}).length==1&&f.grep(K.inputs,function(N,M){return N.flags!=null&&N.flags&k}).length==1){f.each(K.inputs,function(N,M){if(M.flags&e){B={user:M,target:null,visible:false}}if(M.flags&k){J={user:M,target:null,visible:false}}})}var A=B!=null&&J!=null;var F=[];var v=x!=null&&x.forms!=null?x.forms:this.findElements(I,"form");f.each(v,function(Q,M){if(y.flags!=null&&y.flags&32&&logmeonce.formIsRegistration(M,{cache:x})){return}var V={lmoId:M.getAttribute("lmoId"),action:M.lmoAction,score:0,anonymous:A,form:M,inputs:[]};var N=f.grep(K.inputs,function(Y,X){return(Y.flags==null||Y.flags&t)&&(H==null||H==Y.type)}).length;if(N>=2&&y.flags!=null&&y.flags&256){N--}var R=0;var W=0;var S=function(X){return X=="action"?(M[X].length>0?M[X]:M.ownerDocument.location.href):M.getAttribute(X)};if(f.grep(["id","name","class","action"],function(X){return logmeonce.regex.is(S(X),"sign-up")}).length>0){V.score--}if(f.grep(["id","name","class","action"],function(X){return logmeonce.regex.is(S(X),"sign-in")}).length>0){V.score++}if(y.flags!=null&&y.flags&64){V.score=0}if(A){var O=logmeonce.formIsLogin(M)?logmeonce.formAnalyze(M,{login:true,anonymous:true,mapping:true,cache:x}):{};B.target=O.username;B.visible=O.username!=null&&l(O.username,{cache:x});J.target=O.password;J.visible=O.password!=null&&l(O.password,{cache:x});var P=f.grep(M.elements,function(X){return X.tagName=="INPUT"&&X.type=="password"});var T=f.grep(P,function(X){return l(X,{cache:x})});if(J.target!=null&&P.length>=3&&T.length<=0&&f.inArray(J.lmoType,["password-generate","password-current"])>=0){B.target=null;J.target=null}if(B.target!=null&&J.target!=null){R=2;W=(B.visible?1:0)+(J.visible?1:0);V.multiPurpose=O.multiPurpose!=null&&O.multiPurpose;V.inputs=[{user:B.user,target:B.target,visible:B.visible},{user:J.user,target:J.target,visible:J.visible}]}}else{f.each(K.inputs,function(Y,X){var aa=[];try{aa=JSON.parse(X.name)}catch(Z){}f.each(M.elements,function(af,aj){var ae=f(aj).is(":disabled");var al=X.name!=null&&X.name.indexOf("#")===0&&X.name.substr(1)==aj.getAttribute("id");var ah=X.name==aj.getAttribute("name")||f.inArray(aj.getAttribute("name"),aa)>=0||al;var ai=X.type==aj.type;var ab=X.name!=null&&X.type!=null&&ah&&ai;var ak=(X.flags!=null&&X.flags&e&&C!=null&&f(aj).is(C.element))||(X.flags!=null&&X.flags&k&&L!=null&&f(aj).is(L.element));if((aj.tagName=="INPUT")&&(H==null||H==X.type)&&(aj.type!="button"&&aj.type!="submit"&&aj.type!="image")&&(X.type!="radio"||(aj.value==X.value&&X.value!="on"))&&(ak||(X.name!=null&&ah&&(f.grep(V.inputs,function(ao,an){return ao.target==aj}).length<=0||X.flags==null||X.flags&t)&&(X.type!="password"||X.type==aj.type))||(X.name==null&&ai&&(f.grep(V.inputs,function(ao,an){return ao.target==aj}).length<=0)&&l(aj,{cache:x})))&&(!ae||ab)){var ac=l(aj,{cache:x});if(X.flags==null||X.flags&t){var ag=f.grep(V.inputs,function(an){return an.user==X});var am=f.grep(V.inputs,function(an){return an.target==aj&&(an.user.flags==null||an.user.flags&t)});var ad=f.grep(am,function(an){if(X.name!=null&&X.name.length>0&&X.name==an.user.name&&X.type!=an.user.type){if(X.type==aj.type){an.user=X}return true}});if(ad.length>0){return}if(am.length<=0&&ag.length<=0){R++;W+=ac?1:0}}V.inputs.push({user:X,target:aj,visible:ac,mapped:ak})}if((aj.tagName=="SELECT")&&(H==null||H==X.type)&&(X.type=="select"&&X.name!=null&&ah)&&(!ae||ab)){V.inputs.push({user:X,target:aj,visible:l(aj,{cache:x})})}})});var U=f.grep(V.inputs,function(X){return X.mapped}).length;if(U>0){N=U}}if(V.inputs.length>0&&R>=N){V.requiredVisible=W;V.visible=W>=N;V.score+=V.requiredVisible>0?1:0;V.score+=f.grep(V.inputs,function(X){return X.mapped}).length;F.push(V)}});if(F.length>0){F.sort(function(N,M){return M.score-N.score});var z=F[0];if(F.length>1){for(var D=1;D<F.length;D++){if(E||(z.score==F[D].score&&z.requiredVisible<=F[D].requiredVisible)){if(z.list==null){z.list=[]}z.list.push(F[D])}}}return z}else{if(!A&&(y.flags==null||!(y.flags&128))&&f.grep(K.inputs,function(N,M){return N.flags!=null&&N.flags&e}).length==1&&f.grep(K.inputs,function(N,M){return N.flags!=null&&N.flags&k}).length==1){return this.findForm(I,y,f.extend(G||{},{anonymous:true}))}}}return null},formPasswordsContiguous:function(x){var v=x.ownerDocument;var w=logmeonce.window(v);var z=false;var y=f.grep(x.elements,function(B,A){return B.tagName=="INPUT"&&f.inArray(B.type,["button","submit","hidden"])<0&&!(logmeonce.regex.is(B.className,"placeholder")&&!!w.getComputedStyle&&w.getComputedStyle(B).position=="absolute")&&!(B.type=="checkbox"&&f.grep(["id","name"],function(C){return/show(.)?pass/i.test(B[C])}).length>0)});f.each(y,function(B,A){if(A.tagName=="INPUT"&&A.type=="password"){if(B>0&&y[B-1].tagName=="INPUT"&&y[B-1].type=="password"){z=true}if(B>1&&A.style.display!="none"&&y[B-1].tagName=="INPUT"&&y[B-1].type=="text"&&y[B-1].style.display=="none"&&y[B-2].tagName=="INPUT"&&y[B-2].type=="password"&&y[B-2].style.display!="none"){z=true}if(B<y.length-2&&logmeonce.regex.is(A.name,"password-current")&&y[B+1].tagName=="INPUT"&&y[B+1].type=="checkbox"&&logmeonce.regex.is(y[B+1].name,"password-current")&&y[B+2].tagName=="INPUT"&&y[B+2].type=="password"){z=true}return !z}});return z},formIsTotp:function(x){var w=x.ownerDocument;var z=logmeonce.regex.is(w.location.href,"2fa")||logmeonce.regex.is(w.location.href,"sign-in")?1:0;function v(A){if(A=="action"){return x.action.length>0?x.action:x.ownerDocument.location.href}return x.getAttribute(A)}if(f.grep(["id","name","class","action"],function(A){return logmeonce.regex.is(v(A),"totp")}).length>0){z++}var y=f.grep(x.elements,function(A){return A.tagName=="INPUT"&&f.inArray(A.type,["text","number","tel"])>=0});f.each(y,function(B,A){if(f.grep(["id","name","class"],function(C){return logmeonce.regex.is(A.getAttribute(C),"totp")}).length>0){z++;return false}});return z>0},formIsLogin:function(z){var w=z.ownerDocument;var B=logmeonce.regex.is(w.location.href,"sign-in")?1:0;function v(C){if(C=="action"){return z.action.length>0?z.action:z.ownerDocument.location.href}return z.getAttribute(C)}if(f.grep(["id","name","class","action"],function(C){return logmeonce.regex.is(v(C),"sign-in")}).length>0){B++}var A=f.grep(z.elements,function(C){return(C.tagName=="SELECT")||(C.tagName=="BUTTON"&&C.type=="submit")||(C.tagName=="INPUT"&&f.inArray(C.type,["password","text","email","submit","image"])>=0)});f.each(A,function(D,C){if(f.grep(["id","name","class"],function(E){return logmeonce.regex.is(C.getAttribute(E),"sign-in")}).length>0){B++;return false}});var y;if((y=f("input[type=submit], input[type=image], button[type=submit], button:not([type])",z).filter(":not(:disabled):not(.cancel):not([name='cancel'])")).length==1){var x=y.get(0);if(logmeonce.regex.is(x.tagName=="INPUT"?x.value:x.textContent,"sign-in")){B++}}if(f.grep(A,function(C){return C.tagName=="INPUT"&&C.type=="password"}).length==1&&f.grep(A,function(C){return C.tagName=="INPUT"&&f.inArray(C.type,["text","email"])>=0}).length==1){B++}return B>0},formIsRegistration:function(x,G){var I=x.ownerDocument;var F=function(M,L){if(L=="action"){return M[L].length>0?M[L]:M.ownerDocument.location.href}return M.getAttribute(L)};var y=logmeonce.regex.is(I.location.href,"sign-up")?1:0;var w=G!=null&&G.cache!=null?G.cache:false;if(I.location.host=="vimeo.com"&&x.id=="join_form"){y++}var K=0,J=0;f.each(["id","name","class","action"],function(M,L){if(logmeonce.regex.is(F(x,L),"sign-up")){J++}else{if(logmeonce.regex.is(F(x,L),"sign-in")){K++}}});if(J>0){y++}if(K>0){y--}if(x.lmoAction!=null&&x.lmoAction.name=="changePassword"){y--}var D=false;var v=f.grep(x.elements,function(L){if(L.tagName=="SELECT"||(L.tagName=="BUTTON"&&L.type=="submit")||(L.tagName=="INPUT"&&f.inArray(L.type,["password","text","email","submit","image"])>=0)){if(!D&&f.grep(["id","name","class","value"],function(M){return logmeonce.regex.is(L.getAttribute(M),"sign-up")}).length>0){D=true;y++}return true}if(L.tagName=="INPUT"&&L.type=="hidden"){if(!D&&logmeonce.regex.is(L.name,"sign-up")){D=true;y++}}});var B=f.grep(v,function(L){return l(L,{cache:w})});var H;if((H=f("input[type=submit], input[type=image], button[type=submit], button:not([type])",x).filter(":not(:disabled):not(.cancel):not([name='cancel'])")).length==1){var E=H.get(0);if(logmeonce.regex.is(E.tagName=="INPUT"?E.value:E.textContent,"sign-up")){y++}}if(y>0){var A=this.formAnalyze(x,{cache:w});if((A.firstname!=null&&A.lastname!=null)||A.fullname!=null){y++}f("form",I).each(function(M,L){if(L!=x&&f.grep(["id","name","class","action"],function(O,N){return logmeonce.regex.is(F(L,O),"sign-in")}).length>0){y++;return false}})}var z=this.formPasswordsContiguous(x);var C=f.grep(v,function(L){return L.tagName=="INPUT"&&L.type=="password"});return(C.length>=2&&z&&y>=0)||(C.length>=1&&B.length>=5&&y>=1)||(C.length>=1&&B.length>=4&&y>=2)||(C.length>=1&&B.length>=3&&y>=3)||(C.length>=1&&y>=4)},inputMark:function(v){if(this.config.user!=null&&!(this.config.user.settings.flags&64)){return}var y=this.window(v.ownerDocument);var w=!!y.getComputedStyle&&y.getComputedStyle(v).borderWidth==="0px";var x={border:"2px solid #FE6D0F"};f.each(x,function(A,z){if(A=="border"&&w){return}v.style[A]=z})},inputUnmark:function(v){if(this.config.user!=null&&!(this.config.user.settings.flags&64)){return}var x=["border-top-color","border-top-style","border-top-width","border-right-color","border-right-style","border-right-width","border-bottom-color","border-bottom-style","border-bottom-width","border-left-color","border-left-style","border-left-width",];for(var w=0;w<x.length;w++){v.style[x[w]]=""}},inputFill:function(B,C,y){var A={};f.each(["lmoFocused","lmoClicked","lmoKeydown"],function(G,F){A[F]=B[F]});var z=B.ownerDocument;var E=B.lmoFocused;var x=B.form||B.lmoForm||z.lmoForm;var D=y==null||y.events==null||y.events==true;var w=[];f.each(x.elements,function(F,G){if(G.tagName=="INPUT"&&G.name==B.name){w.push(G)}});var v={};if(z.all){f.each(["onfocus","onblur"],function(G,F){v[F]=B[F];B[F]=function(){}})}if(y!=null&&y.filled!=null){B.lmoFilled=y.filled}if(B.tagName=="SELECT"){if(B.selectedIndex!=C){B.selectedIndex=C;D=true}}else{if(B.value!=C){B.value=C;D=true}}if(D){this.dispatchEvent(B,"input");this.dispatchEvent(B,"keydown",{type:"keyboard",code:0});this.dispatchEvent(B,"keypress",{type:"keyboard",code:0});this.dispatchEvent(B,"keyup",{type:"keyboard",code:0});this.dispatchEvent(B,"change");this.dispatchEvent(B,"blur")}this.inputMark(B);f.each(["lmoFocused","lmoClicked","lmoKeydown"],function(G,F){B[F]=A[F]});if(z.all){f.each(["onfocus","onblur"],function(G,F){B[F]=function(I,H){return function(){if(++H>1&&b(I)){return I.apply(this,arguments)}}}(v[F],0)})}f.each(x.elements,function(F,G){if(G.tagName=="INPUT"&&G.name==B.name&&f.inArray(G,w)<0){logmeonce.inputFill(G,B.value)}})},fillUsername:function(A,w){var v=A.ownerDocument;var B=f.grep(w.login.inputs||[],function(C){return C.flags!=null&&C.flags&e}).shift();if(B!=null){try{var x=logmeonce.aesKey(v,{name:"fillUsername",args:[A,w]},w);var y=logmeonce.tools.decrypt(B.value,x);logmeonce.inputFill(A,y,{filled:false});return true}catch(z){}}return false},fillPassword:function(B,x){var v=B.ownerDocument;var w=f.grep(x.login.inputs||[],function(C){return C.flags!=null&&C.flags&k}).shift();if(w!=null){try{var y=logmeonce.aesKey(v,{name:"fillPassword",args:[B,x]},x);var z=logmeonce.tools.decrypt(w.value,y);logmeonce.inputFill(B,z,{filled:false});return true}catch(A){}}return false},fillTOTP:function(B,x){var v=B.ownerDocument;var w=f.grep(x.login.inputs||[],function(D){return D.flags!=null&&D.flags&32}).shift();if(w!=null){try{var y=logmeonce.aesKey(v,{name:"fillTOTP",args:[B,x]},x);var z=logmeonce.tools.decrypt(w.value,y);var C=logmeonce.tools.totp(z);logmeonce.inputFill(B,C,{filled:false});return true}catch(A){}}return false},loginFill:function(v,x,A){var w=this;var y=this.findForm(v,x);try{if(y==null){throw"Not found"}var z=y.list!=null?f.merge([y],y.list):[y];f.each(z,function(B,C){w.log("Filling Form - "+C.inputs.length+" inputs - Anonymous: "+C.anonymous+" - Visible: "+C.visible);f.each(C.inputs,function(G,E){if(E.target.type=="hidden"&&v.location.host.indexOf("signin.ebay.com")===0){return true}w.log("Filling Input - Name: "+(E.target.name.length>0?E.target.name:"NULL")+" - Type: "+E.target.type+" - Visible: "+E.visible);if(E.user.type=="radio"){if(E.target.checked==false){E.target.checked=true;logmeonce.dispatchEvent(E.target,"click",{type:"mouse"})}}else{if(E.user.type=="checkbox"){if(E.target.checked==false&&(E.user.flags&16)){E.target.checked=true}else{if(E.target.checked==true&&!(E.user.flags&16)){E.target.checked=false}}}else{if(E.user.value!=null&&E.user.value.length>0){var F=w.aesKey(v,A!=null?A:{name:"loginFill",args:x},x);var H=logmeonce.tools.decrypt(E.user.value,F);if(E.user.type=="select"&&E.target.options!=null&&f.grep(E.target.options,function(J,I){return J.value==H}).length<=0){E.target.options.add(new Option(H,H))}if(E.target.value!=H){w.inputFill(E.target,H,{filled:true})}else{if(E.target.tagName=="INPUT"){w.inputMark(E.target)}}E.filled=true}else{if(E.target.value!=null&&E.target.value.length>0&&typeof E.target.lmoFilled=="undefined"){w.inputFill(E.target,"",{filled:true})}else{if(E.target.tagName=="INPUT"){w.inputMark(E.target)}}}}}});var D=f.grep(C.inputs,function(E,F){return !E.visible&&E.target.value.length>0&&(E.user.type=="text"||E.user.type=="email")});if(C.inputs.length==2&&D.length>0){f("select",C.form).each(function(F,E){f("option",E).each(function(G,H){if(H.value==D[0].target.value){w.inputFill(E,H.index);return false}})})}});if(y.action!=null&&y.action.name=="changePassword"){y.action.id=x.id}return y}catch(A){this.log("Filling Form - failed: "+A);return null}},loginSubmit:function(E,x){if(x.login.form!=null&&x.login.retry!=null){var y=x.login.form}else{this.log("Submitting Form");var y=this.loginFill(E,x,{name:"loginSubmit",args:x})}try{if(y==null){throw"Not found"}if(y.action!=null&&y.action.name=="changePassword"){throw"Form action is changePassword"}var F=x.flags&256;var w={isVisible:[]};var A=y.list!=null?f.merge([y],y.list):[y];var B=f.grep(A,function(J,I){if(J.visible==false){var K=f.grep(J.inputs,function(L){return L.user.flags==null||L.user.flags&t});var H=f.grep(K,function(L){return L.visible=l(L.target,{cache:w})});J.visible=H.length>=K.length}return J.visible});if(B.length>0){y=B[0]}if(f.grep(y.inputs,function(H){return H.target.type=="password"}).length<=0&&!(F||f.grep(y.inputs,function(H){return H.mapped}).length>0)){throw"No password inputs"}var D=f.grep(y.inputs,function(H){return H.user.flags&t});var G=f.grep(D,function(H){return H.target.disabled});var z=Math.max(D.length-(F?1:0),1);if(D.length-G.length<z){throw"Required inputs are disabled"}if(f.grep(y.inputs,function(H){return H.filled===true}).length<=0){throw"No fields were filled"}if(!x.login.force&&!y.visible){if(x.login.retry==null||x.login.retry<3){setTimeout(function(){logmeonce.loginSubmit(E,f.extend(x,{login:{form:y,retry:++x.login.retry||0}}))},500)}throw"Fields are not visible"}if(!x.login.force&&this.loginIsContinuous(E,x)){throw"Continuous Login detected"}var v=this.findElements(y.form,"input, button, a, div, span");if(v.length<=0&&y.form.elements!=null&&y.form.elements.length>0){v=y.form.elements}this.formSubmit(y.form,function(){var I=null;if(x.login.action!=null&&x.login.action.submit!=null&&f(x.login.action.submit,E).length>0){I=f(x.login.action.submit,E).get(0)}if(I==null){for(var L=0;L<3;L++){var H=0;var K=[];var M=[];function J(O){if(logmeonce.regex.is(O,"sign-in")||logmeonce.regex.test(O,logmeonce.regex.group("log(.in|in)?","(btn|button)"))){return 1}if(logmeonce.regex.is(O,"sign-up")){return -1}var N=f.grep(["next","continue"],function(P){return logmeonce.regex.test(O,P,"i")}).length-f.grep(["forgot","search","find","more(.)?opt","cancel"],function(P){return logmeonce.regex.test(O,P,"i")}).length;return Math.min(Math.max(N,-1),1)}f.each(v,function(O,N){f.each(y.inputs,function(S,R){if(R.user.flags!=null&&R.user.flags&t&&R.target==N){H++}});if(H>0||L>1){var Q=l(N,{cache:w});var P={button:N,score:Q?1:0,login:0};if(N.id=="submit"||N.name=="submit"){P.score++}switch(N.tagName){case"INPUT":if(N.type=="submit"||N.type=="image"){P.score++}f([N.value,N.id,N.name,N.className]).each(function(R,S){P.score+=J(S);P.login+=logmeonce.regex.is(S,"sign-in")?1:0});if((L>0||Q)&&P.score>=0&&(N.type=="submit"||N.type=="image"||(N.type=="button"&&(!y.visible||Q)))){M.push(P)}if((L>0||Q)&&P.score>=0&&(N.type=="submit"||N.type=="image"||(N.type=="button"&&(!y.visible||Q)&&J(N.value)>0))){K.push(P)}break;case"BUTTON":if(N.type=="submit"){P.score++}f([N.textContent,N.id,N.name,N.className]).each(function(R,S){P.score+=J(S);P.login+=logmeonce.regex.is(S,"sign-in")?1:0});if(P.score>=0&&((!y.visible||Q)||(L>0&&N.type=="submit"))){M.push(P)}if(P.score>=0&&((!y.visible||Q)&&(J(N.textContent)>0||J(N.value)>0))){K.push(P)}break;case"A":if(L>0&&(J(N.id)>0||/submit/i.test(N.id)||/submit/i.test(N.getAttribute("onclick"))||J(N.innerHTML)>0)&&(N.href.length<=0||N.href.indexOf("javascript")==0||N.getAttribute("href")=="#")){if(N.childNodes.length>0&&(N.textContent==null||N.textContent.length<=0)){N.style.display="inline-block"}if(Q){K.push(P)}}break;default:if(L>0&&f(N).attr("role")=="button"){f([N.textContent,N.id,N.name,N.className]).each(function(R,S){P.score+=J(S)});if(P.score>=2&&Q){K.push(P)}}break}}});if(L==0&&f.grep(K,function(N){return N.login>0}).length>1&&l(K[0].button,{cache:w})){K[0].score++}K.sort(function(O,N){return N.score-O.score});M.sort(function(O,N){return N.score-O.score});if(K.length>0){I=K[0].button}if(K.length<=0&&L>0&&M.length==1){I=M[0].button}if(I!=null){break}}}return I});return y}catch(C){this.log("Submit Form - failed: "+C);return null}},testing:function(v,x,w){if(w=="start"){this.log("Testing start - [ID: "+x.id+"] "+x.name);if(x.testing==null){x.testing={event:{type:"test",flags:0,user_site_id:x.id}}}if(x.testing.timeout==null){x.testing.timeout=setTimeout(function(){logmeonce.testing(v,x,"stop")},x.testing.delay!=null?x.testing.delay:10000)}}else{if(w=="stop"){if(x.testing!=null&&x.testing.event!=null&&x.testing.event.flags!=null){this.log("Testing stop - [ID: "+x.id+"] "+x.name+" -> Flags: "+x.testing.event.flags)}if(x.testing!=null&&x.testing.timeout!=null){clearTimeout(x.testing.timeout)}f.ajax({url:logmeonce.server+"rest/events/test/",data:x.testing.event,dataType:"logmeonce-binary",type:"POST"}).then(function(){logmeonce.log("Testing results - saved")},function(A,y,z){logmeonce.log("Testing results - failed - Status: "+y+" "+(z!=null?"("+z+")":""))});if(x.testing.silent==null||x.testing.silent==false){logmeonce.siteLogout(x.id,{reload:false});logmeonce.window(v,"close")}x.testing=null}else{if(typeof w=="object"&&w.set!=null){x.testing.event.flags|=w.set;this.log("Testing setting flags ("+w.set+"): "+x.testing.event.flags)}else{if(typeof w=="object"&&w.remove!=null){x.testing.event.flags&=~w.remove;this.log("Testing removing flags ("+w.remove+"): "+x.testing.event.flags)}}}}},loginTesting:function(v,y){if(this.config.user!=null&&this.config.user.sites!=null){var x,w=this;f.each(y.login.inputs,function(B,A){if(A.value!=null&&A.value.length>0){A.value=w.tools.encrypt(A.value,w.aesKey(v))}});for(var z=this.config.user.sites.length-1;z>=0;z--){if(this.config.user.sites[z].id<0){this.config.user.sites.splice(z,1)}}for(var z=this.config.loginList.length-1;z>=0;z--){if(this.config.loginList[z].id<0){this.loginList("delete",this.config.loginList[z])}}this.log("Login Testing "+JSON.stringify(y.testing.event));this.config.user.sites.push(x=f.extend(true,{id:-1,name:"TESTING",enabled:true,flags:i,testing:{event:{type:"test",flags:0}},used:0},y));if(y.closeAllTabsBesideDocument!=null&&this.closeAllTabsBesideDocument!=null){setTimeout(function(){w.closeAllTabsBesideDocument(v)},y.closeAllTabsBesideDocument)}this.sso(v,x.testing!=null&&x.testing.sso!=null?f.extend(x.testing.sso,{id:x.id}):x.id)}},loginGetContinuous:function(v,x,y){y=typeof y!="undefined"?y:10000;var w=new Date().getTime();return f.grep(this.config.loginList,function(z){return z.id==x.id&&w-z.time<y&&f.grep(z.url instanceof Array?z.url:[z.url],function(A){return logmeonce.equals(v.location.href,A,"url")||v.location.href.indexOf(A)===0}).length>0})},loginIsContinuous:function(v,w,x){return this.loginGetContinuous(v,w,x).length>0},loginSite:function(v,y){var A=f.extend({sso:"auto",force:true,id:null},typeof y=="object"?y:{});var x;if((x=this.sites(v,{id:A.id}))!=null&&x.referred!=null){logmeonce.site("referred",function(){this.referred.login=true},x)}var z=x.flags!=null&&x.flags&256&&f.grep(this.config.loginList,function(B){return B.id==x.id&&new Date().getTime()-B.time<10000}).length>0;var w=f.Deferred();if(x.id<0||z||this.browser.type=="logmeonce"){w.resolveWith(this)}else{f.ajax({url:logmeonce.server+"rest/events/login/",data:{site_id:x.id},dataType:"logmeonce-binary",type:"POST"}).then(function(B){x.login.time=new Date().getTime();x.used++;if(!(logmeonce.config.user.flags&u)){x.login.inputs=B}w.resolveWith(logmeonce)},function(C,D,B){if(B.exception!=null&&B.offline===true){return w.resolveWith(logmeonce)}logmeonce.log("Failed to login: "+D);w.reject(D);if(B.exception!=null){logmeonce.injectUi(v,{name:"message",args:[B.exception.message]});logmeonce.loadUser(v,{force:true}).fail(function(){logmeonce.disable(v)})}})}return w.then(function(){var D;if(A.sso=="auto"?x.flags&i:A.sso){if(x.testing==null&&this.config.user!=null&&this.config.user.flags&h){x.testing={event:{type:"test",flags:0,user_site_id:x.id},silent:true};this.testing(v,x,"start")}if(x.testing!=null&&x.testing.event!=null){this.log("SETTING FLAG -> DETECTED + LOGGED");this.testing(v,x,{set:s|c})}D=this.loginSubmit(v,f.extend(true,{},x,{login:{force:A.force}}))}else{D=this.loginFill(v,f.extend(true,{},x))}var B=D!=null&&f.grep(D.inputs,function(F){return F.filled===true&&F.user.flags&e}).length>0?e:0;var C=D!=null&&f.grep(D.inputs,function(F){return F.filled===true&&F.user.flags&k}).length>0?k:0;var E=f.grep(this.config.loginList,function(F){return F.id==x.id}).shift();if(E!=null){E.name=x.name;E.flags=x.flags;E.tab=logmeonce.window(v,"tab");if(x.flags&256&&!(E.filled&k)&&C){E.filled|=C;E.url=E.url instanceof Array?E.url:[E.url];if(E.url.indexOf(v.location.href)<0){E.url.push(v.location.href)}}else{E.time=new Date().getTime();E.filled=B|C;E.url=v.location.href}this.loginList("splice",E);this.log("Updating Login List - Last login: "+x.name+" -> "+v.location.href)}else{this.loginList("add",{id:x.id,name:x.name,url:v.location.href,flags:x.flags,tab:logmeonce.window(v,"tab"),time:new Date().getTime(),filled:B|C,hosts:[v.location.hostname],cookies:[]});this.log("Pushing into Login List - Last login: "+x.name+" -> "+v.location.href)}})},formSubmited:function(x){if(x.lmoFormSubmitted!=null&&new Date().getTime()-x.lmoFormSubmitted<1000){return}x.lmoFormSubmitted=new Date().getTime();var I=x.ownerDocument;var y=logmeonce.window(I,"tab");var C=I.location.href;var Q=function(R){var S=R.value!=null&&R.value.length>0?R.value:null;if(S!=null&&S.indexOf("*")>=0&&logmeonce.equals(R.lmoKeyupValue,S,"*")){return R.lmoKeyupValue}return S};if(f.grep(x.elements,function(S,R){return S.tagName=="INPUT"&&S.type=="password"&&S.value.length>0}).length>0){if(logmeonce.regex.test(C,logmeonce.regex.server(".*"),"i")||!/^(http|https):\/\/*/.test(C)){return}if(x.lmoAction!=null){this.log("Form Submited - Action: "+x.lmoAction.name+" - "+C);if(x.lmoAction.name=="skip"){return}if(x.lmoAction.name=="changePassword"&&x.lmoAction.id!=null){var J=f.grep(this.config.user.sites,function(S,R){return x.lmoAction.id instanceof Array?f.inArray(S.id,x.lmoAction.id)>=0:S.id==x.lmoAction.id});var v=typeof x.lmoAction.password=="object"?x.lmoAction.password.value:x.lmoAction.password;if(J.length>0&&v!=null&&v.length>0){var P=f.grep(J,function(R,S){return f.grep(R.login.inputs,function(T,U){return T.flags!=null&&T.flags&e}).length<=0});var B=[];f.each(J,function(S,R){if(J.length>1&&P.length>0){B.push({id:R.id,username:R.name})}else{var T=f.grep(R.login.inputs,function(U,V){return U.flags!=null&&U.flags&e});if(T.length>0&&T[0].value!=null&&T[0].value.length>0){B.push({id:R.id,username:logmeonce.tools.decrypt(T[0].value,logmeonce.aesKey(I,false,R))})}}});if(B.length===1){B=B[0].username}else{if(B.length<=0){B=null}}return this.loadPasswordManager(I,{id:x.lmoAction.id,url:I.location.href,username:B,inputs:[{flags:k,type:"password",value:v}]})}if(x.lmoAction.id instanceof Array&&x.lmoAction.id.length<=0&&v!=null&&v.length>0){return this.loadPasswordManager(I,{url:I.location.href,inputs:[{flags:k,type:"password",value:v}]})}}}if(this.config.passwordManager.manual){var E=this.config.passwordManager;var w=this.passwordManagerWindow(I,E);if(w&&E.form!=null&&E.form.inputs.length>=2){this.log("Form Submitted - Skipping - Manual add app in progress");if(E.form.manual=="password"){this.passwordManager(function(){this.form.manual="remember"})}return}}if(this.config.passwordManager.skip!=null){var D=this.tools.parseUri(this.config.passwordManager.skip);if(new RegExp("^(http|https)://"+D.host+".*","i").test(C)&&(this.config.passwordManager.time==null||new Date().getTime()-this.config.passwordManager.time<30000)){this.log("Form Submitted - Skipping - Not Now for "+this.config.passwordManager.skip+" - Elapsed: "+(new Date().getTime()-this.config.passwordManager.time));return}}var F=this.formAnalyze(x,{submit:true,allowMultiple:true});var G={url:I.location.href,username:null,inputs:[]};if(F.username instanceof Array){G.username=f.map(F.username,Q)}else{if(F.username!=null){G.username=Q(F.username)}}f.each(x.elements,function(U,T){var W=function(Z){if(Z instanceof Array){return f.grep(Z,function(aa){return aa==Z}).length>0}return T==Z};var Y=T.id!=null&&T.id.length>0?"#"+T.id:null;var S=T.name!=null&&T.name.length>0?T.name:Y;var V=T.type!=null&&T.type.length>0?T.type:"text";var X=Q(T);var R=0;if(T.tagName=="INPUT"&&T.type=="text"&&!W(F.username)&&f(T).parent().find("[id*=captcha],[src*=captcha],[name*=captcha]").length>0){return true}if(T.tagName=="INPUT"&&f.inArray(T.type,["text","email","password","number"])>=0){if(W(F.username)){R=e}if(W(F.password)){R=k}G.inputs.push({flags:R,name:S,type:V,value:X,visible:l(T),target:T})}if(T.tagName=="INPUT"&&T.type=="checkbox"&&T.name!=null&&T.name.length>0){G.inputs.push({flags:R,name:S,type:"checkbox",value:null,checked:T.checked,visible:l(T),target:T})}if(T.tagName=="INPUT"&&T.type=="radio"&&T.value!="on"&&T.checked){G.inputs.push({flags:R,name:S,type:"radio",value:X,checked:T.checked,visible:l(T),target:T})}if(T.tagName=="SELECT"){G.inputs.push({flags:R,name:S,type:"select",value:X,visible:l(T),target:T})}});if(f.grep(G.inputs,function(R){return R.flags&e}).length>0&&f.grep(G.inputs,function(R){return R.flags&k}).length>0){for(var M=G.inputs.length-1;M>=0;M--){if(G.inputs[M].flags==0&&G.inputs[M].name==null&&G.inputs[M].value==null&&!G.inputs[M].visible){G.inputs.splice(M,1)}}}if(f.grep(G.inputs,function(R){return R.flags&e&&R.target.disabled!=true}).length<=0){var E=logmeonce.config.passwordManager;var w=logmeonce.passwordManagerWindow(I,E);if(w&&E.form!=null&&E.time!=null&&new Date().getTime()-E.time<30000&&E.form.url!=null&&this.regex.test(I.location.href,this.regex.url(E.form.url),"i")&&f.grep(E.form.inputs,function(R){return R.flags&e}).length>0&&f.grep(E.form.inputs,function(R){return R.flags&k}).length<=0){this.log("Form Submitted - Detected 2 step login page - username form submitted "+((new Date().getTime()-E.time)/1000)+" seconds ago.");G.url=E.form.url;G.flags=256;if(f.grep(G.inputs,function(R){return R.flags&e}).length<=0){G.username=E.form.username;G.inputs=f.grep(E.form.inputs,function(R){return R.flags&e}).concat(G.inputs)}}}var L=true;var K=[];var N=this.matchSite(I,{site:G});if(N!==false){L=false;f.each(N,function(T,S){var R=S.site;var U=f.grep(R.login.inputs,function(V){return V.type=="password"&&V.flags&t});if(S.password==false&&logmeonce.allowed(R,"update")){K.push(S.site)}else{if(S.password==false&&f.grep(U,function(V){return V.mapping==3}).length==U.length){G.inputs=f.grep(G.inputs,function(V){return f.grep(U,function(W){return W.target==V.target}).length>0});G.inputs.length>0&&K.push(R)}}})}else{var A=I.lmoReferrer;var H=f.grep(this.config.user.sites,function(R){return((R.login.regex!=null&&logmeonce.regex.test(I.location.href,R.login.regex,"i"))||(A!=null&&R.id==A.id&&A.parent==null))});f.each(H,function(S,R){var T=logmeonce.findForm(I,R,{listAll:true});T!=null&&f.each(T.list!=null?f.merge([T],T.list):[T],function(U,V){if(V.form==x&&f.grep(V.inputs,function(W){try{return logmeonce.equals(Q(W.target),W.user.value!=null&&W.user.value.length>0?logmeonce.tools.decrypt(W.user.value,logmeonce.aesKey(I,false,R)):"",W.user.flags!=null&&W.user.flags&e?"username":null)}catch(X){return false}}).length===V.inputs.length){logmeonce.log("Form Submitted - extension form fill detected - skipping remember password");L=false;return false}})})}f.each(G.inputs,function(S,R){delete R.target});if(L){if(this.formIsRegistration(x)&&F.username!=null&&F.password!=null){G.registration={url:G.url};f("a",I).each(function(S,R){if(R.href.indexOf("javascript")<0&&(/log(.)?in/i.test(R.href)||/sign(.)?on/i.test(R.href)||/sign(.)?in/i.test(R.href))&&l(R)){G.url=R.href;logmeonce.log("Form Submited - Found href Login URL - "+G.url);return false}});f("form[action]",I).each(function(R,S){if((/log(.)?in/i.test(S.action)||/sign(.)?on/i.test(S.action)||/sign(.)?in/i.test(S.action))&&l(S)){G.url=S.action;logmeonce.log("Form Submited - Found action Login URL - "+G.url);return false}})}else{if(this.config.user!=null){logmeonce.ajax({url:this.server+"rest/events/login",type:"POST",dataType:"logmeonce-binary"})}else{logmeonce.config.get("logins").then(function(U){var T=new Date();var R=typeof U==="string"&&U.length>0?f.map(U.split(","),function(V){return parseInt(V)||0}):[0,0];var S=new Date(R.length>1?R[1]:0);logmeonce.config.set("logins",T.toLocaleDateString()===S.toLocaleDateString()?[R[0]+1,R[1]].join(","):[1,T.getTime()].join(","))})}}if(this.config.user!=null&&this.config.user.never!=null&&this.config.user.never.remember!=null&&f.grep(this.config.user.never.remember,function(R){return logmeonce.regex.test(C,R,"i")}).length>0){this.log("Form Submited - Never remember matched - skipping");return}logmeonce.loadPasswordManager(I,G)}else{if(K.length>0){var z=null;if(K.length>1){G.id=[];f.each(K,function(S,R){G.id.push(R.id);if(z==null&&f.grep(R.login.inputs,function(T,U){return T.value!=null&&T.flags!=null&&T.flags&e}).length>0){z={site:R,inputs:f.grep(R.login.inputs,function(T,U){return T.value!=null&&T.flags!=null&&T.flags&e})}}})}else{G.id=K[0].id;z={site:K[0],inputs:f.grep(K[0].login.inputs,function(R,S){return R.value!=null&&R.flags!=null&&R.flags&e})}}try{G.username=logmeonce.tools.decrypt(z.inputs[0].value,logmeonce.aesKey(I,false,z.site))}catch(O){G.username=null}logmeonce.loadPasswordManager(I,G)}}}else{var F=this.formAnalyze(x,{submit:true,allowMultiple:true});if(F.username!=null){if(this.config.passwordManager.manual){var E=this.config.passwordManager;var w=this.passwordManagerWindow(I,E);if(w&&E.form!=null&&E.form.inputs.length>=1){this.log("Form Submitted - Skipping - Manual add app in progress");if(f.grep(E.form.inputs,function(R){return R.flags&k}).length<=0){this.passwordManager(function(){this.form.flags|=256})}return}}var G={url:I.location.href,username:null,inputs:f.map(F.username instanceof Array?F.username:[F.username],function(T){var W=T.id!=null&&T.id.length>0?"#"+T.id:null;var S=T.name!=null&&T.name.length>0?T.name:W;var U=T.type!=null&&T.type.length>0?T.type:"text";var V=Q(T);var R=e;return{flags:R,name:S,type:U,value:V,visible:l(T)}})};if(F.username instanceof Array){G.username=f.map(F.username,Q)}else{G.username=Q(F.username)}logmeonce.log("Form Submitted - saving username for potential 2 step login page");logmeonce.loadPasswordManager(I,G)}}},formSubmit:function(A,y,w){var x=f.Deferred();var v=A.ownerDocument;var C=function(){if(b(A.submit)){A.submit()}else{A.submit.click()}x.resolve(A)};function z(){logmeonce.log("Submit Form - submit event");C(A)}f.each(A.elements,function(E,D){if(D.tagName=="INPUT"&&f.inArray(D.type,["text","email","password"])>=0&&D.lmoFilled==true){z=function(F){return function(){logmeonce.log("Submit Form - triggering keypress on input: "+F.name);logmeonce.dispatchEvent(F,"keydown",{type:"keyboard",code:13});logmeonce.dispatchEvent(F,"keypress",{type:"keyboard",code:13});logmeonce.dispatchEvent(F,"keyup",{type:"keyboard",code:13});setTimeout(function(){logmeonce.log("Submit Form - submit event after keypress");C(A)},500)}}(D);return D.type!="password"}});if(y!=null&&b(y)){y=y.call(this)}var B;if(y==null&&y!==false&&(B=f("input[type=submit], input[type=image], button[type=submit], button:not([type])",A).filter(":not(:disabled):not(.cancel):not([name='cancel'])")).length==1){y=B.get(0)}if(y!=null&&y!==false){if(f(y).is(":disabled")&&(w==null||new Date().getTime()-w<20000)){setTimeout(function(D){logmeonce.formSubmit(A,y,D).then(x.resolve)},250,w||new Date().getTime());return x}setTimeout(function(){logmeonce.log("Submit Form - button click - "+y.tagName+" - Type:"+y.type+" - Name: "+y.name+" - Id: "+y.id+" - Class: "+y.className+" - "+(y.value||y.textContent||"").trim());logmeonce.dispatchEvent(y,"mousedown",{type:"mouse"});logmeonce.dispatchEvent(y,"click",{type:"mouse"});logmeonce.dispatchEvent(y,"mouseup",{type:"mouse"});x.resolve(A)},500)}else{setTimeout(function(){z()},500)}return x.then(function(){A.lmoFormSubmitting=new Date().getTime()})},formAnalyze:function(ae,ak){var aw={};var J=[];var O=[];var ac=[];var ap=[];var ab=[];var al=[];var B=[];var av=[];var ad=[];var ax=[];var ai=null;var au=[];var aj=[];var v=[];var F=[];var Z=[];var U=[];var G=[];var x=[];var A=[];var C=[];var ay=[];var af=[];var ah=[];var Q=[];var L=[];var T=[];var V=[];var N=[];var aa=[];var am=[];var y=ae.ownerDocument!=null?ae.ownerDocument:null;var R=ae.elements!=null?ae.elements:ae.inputs;var X=f.extend({mapping:false,autofill:false,allowMultiple:false},typeof ak==="object"?ak:{});var H=f.extend({isVisible:[],findLabel:[]},ak!=null&&ak.cache!=null?ak.cache:{});function W(aA,az){var aB=0;if(f.isPlainObject(aA)){f.each(aA,function(aD,aC){if(aC==az.input){aB++}})}return aB}function ao(aF,az,aC){var aH;if(aF.length>0){aF=f.grep(aF,function(aI,aJ){for(var aJ in aw){if(aw[aJ]==aI.input||W(aw[aJ],aI)>0){if(X.autofill&&aw.username==aI.input){return true}return false}}return true});if(aF.length>0){aF.sort(function(aJ,aI){if(aJ.score==aI.score){return aJ.index-aI.index}return aI.score-aJ.score});if((X.allowMultiple==true||X.allowMultiple==az)&&(aC==null||aC.allowMultiple==null||aC.allowMultiple==true)){if(aC!=null&&aC.onlyNeighbours==true){var aB=aF.splice(0,1);for(var aE=0;aE<aF.length;aE++){for(var aD=0;aD<aB.length;aD++){if(aB[aD].index==aF[aE].index+1||aB[aD].index==aF[aE].index-1){aB.push(aF[aE])}}}aF=aB}var aA=[aF[0].input];for(var aE=1;aE<aF.length;aE++){if(aF[0].score==aF[aE].score&&(!ak.submit||f.grep(aA,function(aI){return aI.value==aF[aE].input.value}).length<=0)){aA.push(aF[aE].input)}}aH=aA.length>1?aA:aA[0]}else{if(X.autofill&&az=="phone"){var aG=[],aA=[];f.each(aF,function(aJ,aI){var aK=aI.type!=null?aI.type:"";if(f.inArray(aK,aG)<0&&aI.input!=null){aA.push({number:aI.input,type:aK,cc:aI.cc});aG.push(aK)}});aH=aA.length>1?aA:aA[0]}else{aH=aF[0].input}}}}if(aH!=null&&az=="email"){f.each(aF,function(aJ,aI){if(aH==aI.input&&aI.repeat!=null){aH=[aH,aI.repeat]}})}return aH}function z(aA,aE,aF){var aD=f.extend({properties:["id","name","placeholder"],attributes:["class","data","ng-model","autocomplete"]},aF||{});var aC=y!=null&&aA.tagName!=null,aB;var az=f.grep(aD.properties,function(aG){return aA[aG]!=null&&aA[aG].length>0&&aE.test(an(aA[aG],aG))}).length+f.grep(aD.attributes,function(aG){return aC&&aE.test(aA.getAttribute(aG))}).length;if(az<=0&&aC&&(aB=logmeonce.findLabel(aA,{cache:H})).length>0&&aE.test(aB)){az++}return az}function E(aA,aB,aC){var az={input:aA,section:0,dom:false,visible:false,score:aC||0,index:aB};if(aA.ownerDocument!=null&&aA.tagName!=null){az.dom=true;az.visible=l(aA,{cache:H,coverage:false});if(az.visible){az.score++}if(f(aA).is("[readonly]")||f(aA).is(":disabled")){az.score--}if((ak!=null&&ak.submit==true)&&(aA.lmoFocused===true||aA.lmoKeydown===true)){az.score++}}if(w){f.each(R,function(aF,aD){if(f.inArray(aD,K)>=0){az.section++}if(aD==aA){if(ak!=null&&ak.login==true&&aF+1<R.length){for(var aE=aF+1;aE<R.length;aE++){if(f.inArray(R[aE],D)>=0){az.score++}if(f.inArray(R[aE],K)>=0){break}}}return false}})}return az}function an(aB,aA){var az=null;if(aA=="name"){az=Y}else{if(aA=="id"){az=Y!=null?Y.replace(/\$/g,"_"):null}}return aB!=null&&aB.length>0&&az!=null&&az.length>0&&aB.indexOf(az)===0?aB.substring(az.length):aB}var Y=null;var I=f.grep(R,function(az){return az.name!=null&&az.name.length>0&&az.name.indexOf("$")>0});if(I.length>0){var ag,M=999;f.each(I,function(aA,az){M=Math.min(az.name.length,M)});while((ag=I[0].name.substring(0,M)).length>0&&ag.indexOf("$")>0&&--M>0){if(I.length==f.grep(I,function(az){return az.name.indexOf(ag)===0}).length){Y=ag;break}}}var K=f.grep(R,function(az){return az.type=="submit"});var D=f.grep(K,function(az){return f.grep(["id","name"],function(aA){return logmeonce.regex.is(an(az[aA],aA),"sign-in")}).length>0});var P=f.grep(K,function(az){return f.grep(["id","name"],function(aA){return logmeonce.regex.is(an(az[aA],aA),"sign-up")}).length>0});var w=D.length>0&&P.length>0;f.each(R,function(a4,aB){if(aB.ownerDocument!=null&&aB.tagName!=null){if(f(aB).is(":disabled")&&ak!=null&&ak.anonymous){return}if(f(aB).is("[readonly]")&&!(ak!=null&&ak.submit)){return}if(f.inArray(aB.tagName,["INPUT","SELECT","TEXTAREA"])<0){return}if(f.inArray(aB.type,["hidden","button","submit","image"])>=0){return}}if(ak!=null&&ak.submit==true&&(aB.value==null||aB.value.length<=0)){return}var aT=E(aB,a4);var a2=E(aB,a4);if(z(aB,/job(.)?title/i)){A.push(E(aB,a4))}if(z(aB,/web(.)?url|web(.)?site/i)){C.push(E(aB,a4))}if(z(aB,new RegExp("birth|bday|bmonth|byear|"+logmeonce.regex.words("(dob|mob|yob)"),"i"))){var aU=z(aB,new RegExp("day|"+logmeonce.regex.words("(dob)"),"i"))+(f.inArray(aB.name,["dd","dob","day"])>=0?1:0);var aM=z(aB,new RegExp("month|"+logmeonce.regex.words("(mob)"),"i"))+(f.inArray(aB.name,["mm","mob","month"])>=0?1:0);var aW=z(aB,new RegExp("year|"+logmeonce.regex.words("(yob)"),"i"))+(f.inArray(aB.name,["yyyy","yob","year"])>=0?1:0);if(!aU&&!aM&&!aW&&aB.tagName!=null&&aB.tagName=="SELECT"&&aB.options.length>0){aU+=aB.options.length>=28&&aB.options.length<=31&&f.grep(aB.options,function(a9){return !isNaN(a9.value)&&a9.value.length>=1&&a9.value.length<=2}).length==aB.options.length?1:0;aM+=aB.options.length==12&&f.grep(aB.options,function(a9){return !isNaN(a9.value)&&a9.value.length>=1&&a9.value.length<=2}).length==aB.options.length?1:0;aW+=f.grep(aB.options,function(a9){return !isNaN(a9.value)&&a9.value.length==4}).length==aB.options.length?1:0}aU&&F.push(E(aB,a4,aU));aM&&v.push(E(aB,a4,aM));aW&&aj.push(E(aB,a4,aW));if(!aU&&!aM&&!aW&&z(aB,/birth(.)?date/i)){Z.push(E(aB,a4))}}if(z(aB,/cc(.)?type|card(.)?type/i)){var a8=E(aB,a4);af.push(a8);Q.push(a8)}if(z(aB,/cc(.)?num|card(.)?num/i)){var a6=E(aB,a4);af.push(a6);ah.push(a6)}if(z(aB,/cc(.)?(mon|mm)|cc(.)?exp(.|iration|iry)?(mon|mm)|card(.)?(mon|mm)|exp(.|iration|iry)?(mon|mm)/i)){var aA=E(aB,a4);af.push(aA);T.push(aA)}if(z(aB,/cc(.)?(year|yy)|cc(.)?exp(.|iration|iry)?(year|yy)|card(.)?(year|yy)|exp(.|iration|iry)?(year|yy)/i)){var aF=E(aB,a4);af.push(aF);L.push(aF)}if(z(aB,/cc(.|.u)?name|card(.*)?holder(.)?name|name(.)?on(.)?(.?the.?)card/i)){var aK=E(aB,a4);af.push(aK);aa.push(aK)}if(z(aB,/cc(.)?issuer/i)){var aK=E(aB,a4);af.push(aK);am.push(aK)}if(z(aB,/exp(iration|iry)?(.)?(card|date)|card(.)?exp/i)){var a5=E(aB,a4);af.push(a5);V.push(a5)}if(z(aB,new RegExp(logmeonce.regex.words("(cvc|cvc2|csc|cvd|cvv|cvv2|cid|ccv|verification(.)?code)"),"i"))||z(aB,new RegExp("(CVC|CVC2|CSC|CVD|CVV|CVV2|CID|CCV)","i"),{properties:["id","name"],attributes:[]})){var aC=E(aB,a4);af.push(aC);N.push(aC)}if(z(aB,/(?:^|\b|_)age(?=\b|_)/i)){x.push(E(aB,a4))}if(aB.type=="email"||(aB.type=="text"&&z(aB,/e(.)?mail/i))){var aP=E(aB,a4);if(a4>0&&U.length>0){var aY=U[U.length-1];var a1=z(aB,/repeat|retype|verify|confirm|cfm|again/i);var aD=aB.name.indexOf(aY.input.name)>=0||f.inArray(logmeonce.tools.strdiff(aY.input.name,aB.name).toLowerCase(),["re","cfm"])>=0;if(a1&&aD||(aY.input==R[a4-1]&&(a1||aD))){aY.repeat=aB;aY.score++}}if(aB.type=="email"||aB.name=="email"){aP.score++}if(aB.placeholder!=null&&logmeonce.regex.is(aB.placeholder,"email")){aP.score++}aP.score+=z(aB,/e(.)?mail/i);U.push(aP);a2.score--}if(z(aB,/company|business(.)?name|organization/i)){var aJ=E(aB,a4,z(aB,/(company|business)(.)?name/i));G.push(aJ)}if(z(aB,/gender|sex/i)){var a0=function(a9){return a9 instanceof Array?a9[0]:a9};if(aw.gender!=null&&a0(aw.gender).type=="radio"&&a0(aw.gender).name==aB.name){if(aw.gender instanceof Array){aw.gender.push(aB)}else{aw.gender=[aw.gender,aB]}}else{aw.gender=aB}}var aO=false;if(aB.tagName!=null&&aB.tagName=="SELECT"&&aB.options.length>0){var aX=f.grep(aB.options,function(a9){return a9.value.length>0&&isNaN(a9.value)&&a9.value.length==2});var az=f.grep(aB.options,function(a9){return a9.value.toUpperCase()=="US"||f.inArray(a9.text,["United States","United States of America","USA"])>=0});aO=aX.length>=aB.options.length-1&&az.length>0}if(z(aB,/country/i)||aO){var aZ=E(aB,a4);if(aB.name=="country"){aZ.score++}if(aB.tagName!=null&&aB.tagName=="SELECT"){var aX=f.grep(aB.options,function(a9){return a9.value.length>0&&isNaN(a9.value)&&a9.value.length==2});aZ.score++;aZ.score+=aX.length>=aB.options.length-1?1:-1}ac.push(aZ);a2.score--}if(z(aB,/^state|[^e]state|province|county/i,{attributes:["data"]})){var a7=E(aB,a4);al.push(a7);a2.score--}if(z(aB,/city|town/i)){var aL=E(aB,a4);ab.push(aL);a2.score--}if(f.inArray(aB.type,["text","number"])>=0&&z(aB,/post(.)?code|postal(.)?code|zip/i)){var aN=E(aB,a4);B.push(aN);a2.score--}if(z(aB,new RegExp(logmeonce.regex.words(true,"(full|customer|your|display)","name")+"|first(.*)last(.*)name","i"))){ai=aB;aT.score--;a2.score--}if(z(aB,new RegExp(logmeonce.regex.words(true,"(first|frst|fst|given)","name")+"|fname","i"))){var a3=E(aB,a4);av.push(a3);aT.score--;a2.score--}if(z(aB,new RegExp(logmeonce.regex.words(true,"(last|lst|second|snd|family)","name")+"|surname|lname","i"))){var aQ=E(aB,a4);ad.push(aQ);aT.score--;a2.score--}if(z(aB,/middle(.)?name/i)){aT.score--;a2.score--}if(z(aB,/address|street/i)&&!z(aB,/blog(.)?address|mail(.)?address|ip(.)?address/i)&&a2.score>=0){if(z(aB,/address(.)?line|address\d|addr\d/i)){a2.score++}J.push(a2)}else{if(z(aB,/location/i)){O.push(a2)}}var aI=aO&&f.grep(aB.options,function(a9){return/(\+\d*)/i.test(a9.text)}).length>=aB.options.length-1;var aV=z(aB,/area(.)?code/i);var aE={cell:/mobile|cell/i,home:/home/i,fax:/fax/i,work:/work/i};var aG=function(a9){var ba=0;f.each(aE,function(bb,bc){ba+=z(a9,bc);return ba<=0});return ba>0};if(z(aB,/(country|dial)(.)?code|(phone|mobile)(.)?cc/i)||(aV&&aO)||aI){var aS=E(aB,a4);var aH=ay.length>0?ay[ay.length-1]:null;if(aH!=null&&aH.cc==null&&aH.index==a4-1){ay[ay.length-1].cc=aB}else{ay.push(f.extend(aS,{cc:aB,input:null}))}}else{if((f.inArray(aB.type,["text","tel"])>=0&&z(aB,/phon|mobile|mobno/i)&&!z(aB,/annotation/i))||(aB.type=="tel"&&aG(aB))){var aH=E(aB,a4,aV?-1:0);aH.types=0;f.each(aE,function(a9,ba){var bb=z(aB,ba);if(aH.types<bb){aH.types=bb;aH.type=a9}});var aY=ay.length>0?ay[ay.length-1]:null;if(aY!=null&&aY.cc!=null&&aY.input==null&&aY.index==a4-1){aY.input=aH.input;aY.type=aH.type}else{ay.push(aH)}}}if(aB.type=="text"||aB.type=="email"){if(au.length<=0||au[au.length-1].section!=aT.section){aT.score++}if(z(aB,/password/i)||z(aB,/token/i)||logmeonce.regex.is(aB.name,"captcha")){aT.score--}if(y!=null&&aB.getAttribute!=null&&aB.getAttribute("autocomplete")==="username"){aT.score++}if(z(aB,/user(.)?name/i)||z(aB,/user(.)?id/i)||z(aB,/user(.)?login/i)||z(aB,/login(.)?id/i)||z(aB,/email/i)||z(aB,/uname/i)){aT.score++;if(f.grep(["username","userlogin","userid"],function(a9){return aB.name==a9||aB.id==a9}).length>0){aT.score++}if((z(aB,/user(.)?name/i)||z(aB,/user(.)?id/i)||z(aB,/user(.)?login/i)||z(aB,/login(.)?id/i))&&aB.value!=null&&aB.value.length>0&&logmeonce.regex.is(aB.value,"email")){aT.score++}}ap.push(aT)}if(aB.type=="password"){var aR=E(aB,a4);if(ak!=null&&ak.anonymous){if(au.length>0&&au[au.length-1].section==aR.section&&au[au.length-1].visible&&aR.visible){au[au.length-1].score=-1;return}if(f.grep(N,function(a9){return a9.input==aB}).length>0){return}}if(au.length<=0||au[au.length-1].section!=aR.section){au.push(aR)}else{if((ak!=null&&ak.anonymous&&aR.dom&&aR.visible)||(ak!=null&&ak.submit&&aR.dom&&aR.input.lmoKeyup==true&&au[au.length-1].input.lmoKeyup!=true)){if(au[au.length-1].score>=0){au[au.length-1]=aR}}}}});for(var ar=au.length-1;ar>=0;ar--){for(var aq=ap.length-1;aq>=0;aq--){if(ap[aq].section==au[ar].section&&ap[aq].index<au[ar].index){ap[aq].score++;break}}}if(f.grep(R,function(az){return az.type==null}).length>0&&R.length>=2&&R[0].type==null){ap.push(E(R[0],0))}f.each(ap,function(az,aA){if(aA.input.value!=null&&aA.input.value.indexOf("*")>=0&&f.grep(["id","name"],function(aB){return logmeonce.regex.test(an(aA.input[aB],aB),"masked","i")}).length>0){f.each(ap,function(aC,aB){if(az!=aC&&logmeonce.equals(aB.input.value,aA.input.value,"*")){aA.score--;aB.score++;return false}})}});au=f.grep(au,function(az){return az.score>=0});au.sort(function(aA,az){return az.score-aA.score});ay=f.grep(ay,function(az){return az.input!=null});if(w){aw.multiPurpose=true;aw.password=[];aw.username=[];f.each(au,function(aA,az){if(aw.password.length>0&&au[0].score>az.score){return false}var aB=f.grep(ap,function(aC){return aC.section==az.section});if(aB.length>0){aw.password.push(az.input);aw.username.push(ao(aB,"username",{allowMultiple:false}))}});if(aw.password.length<=0||aw.username<=0){aw.multiPurpose=false;aw.password=ao(au,"password");aw.username=ao(ap,"username")}else{if(!X.allowMultiple||aw.password.length<=1||aw.username<=1){aw.password=aw.password[0];aw.username=aw.username[0]}}}else{aw.password=ao(au,"password");aw.username=ao(ap,"username")}aw.email=ao(U,"email");if(ai!=null&&aw.username!=ai){aw.fullname=ai}aw.firstname=ao(av,"firstname");aw.lastname=ao(ad,"lastname");aw.phone=ao(ay,"phone");aw.country=ao(ac,"country");aw.city=ao(ab,"city");aw.state=ao(al,"state");aw.zip=ao(B,"zip");aw.address=ao(J,"address",{onlyNeighbours:true});aw.location=ao(O,"location");aw.company=ao(G,"company");aw.jobtitle=ao(A,"jobtitle");aw.website=ao(C,"website");if(af.length>0){aw.card={};aw.card.number=ao(ah,"cardnumber");aw.card.type=ao(Q,"cardtype");aw.card.month=ao(T,"cardmonth");aw.card.year=ao(L,"cardyear");aw.card.date=ao(V,"carddate");aw.card.code=ao(N,"cardcode");aw.card.name=ao(aa,"cardname");aw.card.issuer=ao(am,"cardissuer");f.each(aw.card,function(az,aA){aA==null&&delete aw.card[az]})}if(aj.length>0||v.length>0||F.length>0){aw.birthdate={};if(aj.length>0){aw.birthdate.year=ao(aj,"birthyear",{allowMultiple:false})}if(v.length>0){aw.birthdate.month=ao(v,"birthmonth",{allowMultiple:false})}if(F.length>0){aw.birthdate.day=ao(F,"birthday",{allowMultiple:false})}var at,S=f.grep(["year","month","day"],function(aA){var az=aw.birthdate[aA];return az!=null&&(y==null||az.tagName==null||l(az,{cache:H}))}).length;if(aw.birthdate.year==null&&aw.birthdate.month==null&&aw.birthdate.day!=null&&z(aw.birthdate.day,/birthday/i)){aw.birthdate=aw.birthdate.day}else{if(S<=0&&(at=ao(Z,"birthdate",{allowMultiple:false}))!=null&&(y==null||at.tagName==null||l(at,{cache:H}))){aw.birthdate=at}}}else{aw.birthdate=ao(Z,"birthdate",{allowMultiple:false})}aw.age=ao(x,"age");X.mapping&&f.each(logmeonce.config.user.autofill.mapping,function(aC,aB){if(!logmeonce.regex.test(y.location.href,aB.url,"i")){return}var aA=aB.name.indexOf("card-")==0?aw.card:aw;var az=aB.name.indexOf("card-")==0?aB.name.substring(5):aB.name;f.each(logmeonce.findElements(ae,aB.element),function(aF,aE){aD(aw);function aD(aG){f.each(aG,function(aH,aI){if(aI!=null&&aH=="card"){return aD(aI)}if(aI!=null&&f.grep(aI instanceof Array?aI:[aI],function(aJ){return aE===aJ}).length>0){if(aG[aH] instanceof Array){aG[aH].splice(aI.indexOf(aE),1)}else{aG[aH]=undefined}}})}if(f.inArray(aB.name,["username","password"])>=0){aA[az]=aE}else{if(aA[az] instanceof Array){aA[az].splice(0,0,aE)}else{aA[az]=aA[az]!=null?[aA[az],aE]:aE}}})});return aw},passwordManagerWindow:function(v,y){var x=this.window(v,"tab");var z=this.window(v);var w=false;if(z!=z.top){try{w=f("frameset",z.parent.document).length>0&&f("frame",z.parent.document).filter(function(B,C){return z.location.href==C.contentWindow.location.href}).length>0}catch(A){}}return(z==z.top||w||z.name==y.window)&&(y.tab==null||y.tab.id==null||(x!=null&&x.id!=null&&x.id==y.tab.id))},passwordManager:function(v){if(typeof v==="function"){v.call(this.config.passwordManager)}else{this.config.passwordManager=v}return this.config.passwordManager},savePasswordManager:function(C,B){var w=B;if(B!=null&&B.ui!=null&&B.ui=="save"){w=this.config.passwordManager.form;if(B.id!=null&&!isNaN(B.id)){w.id=B.id}if(B.id==null&&B.username!=null){w.username=B.username;var A=f.grep(w.inputs,function(F){return F.flags&e});var z=f.grep(w.inputs,function(F){return F.flags&k});if(A.length>0){f.each(A,function(F,G){if(A.length<=1){G.value=B.username}else{if(G.value!=B.username){G.flags=G.flags&~e;if(A.length>1&&A.length==z.length){z[F].flags=z[F].flags&~k}}}})}else{w.id=true;w.inputs=[{flags:e,type:"text",value:B.username}].concat(w.inputs)}}if(B.group!=null){w.group=B.group}}if(B!=null&&B.ui!=null&&B.ui=="skip"){this.passwordManager(function(){this.skip=this.form.url;this.time=new Date().getTime();this.form=null});return false}if(B!=null&&B.ui!=null&&B.ui=="never"){return f.ajax({url:this.server+"rest/extension/never-remember/",data:{url:this.config.passwordManager.form.url},type:"POST",dataType:"logmeonce-binary"}).then(function(F){if(F.never!=null&&F.never.remember instanceof Array){logmeonce.config.user.never.remember=F.never.remember}},function(H,G,F){logmeonce.log("Password Manager - saving failed: "+G);return G}).always(function(){logmeonce.passwordManager({})})}if(this.config.user==null&&w!=null){this.config.passwordManager.time=new Date().getTime();this.injectUi(C,{name:"newtab",args:["about:blank"]});return false}this.passwordManager(function(){this.time=new Date().getTime();this.form=null});if(w==null){return false}var y=this.config.passwordManager.manual?"manual":"remember";var D=f.Deferred().resolve();if(w.id!=null&&w.id===true){var x=this.matchSite(C,{site:w,format:"id"});if(x!==false){var v=this.tools.parseHost(w.url);var E=this.translate._("This site already exists")+". ";if(w.username!=null){E+=this.translate.sprintf(this.translate._("Change Password for %s on %s?"),'"'+w.username+'"',v)}else{E+=this.translate.sprintf(this.translate._("Change Password on %s?"),v)}D=logmeonce.confirm(C,E).then(function(){w.id=x})}else{delete w.id}}return D.then(function(){if(w.id instanceof Array){f.each(w.id,function(F,G){logmeonce.saveSite(C,{site:f.extend(w,{id:G})})})}else{return logmeonce.saveSite(C,{site:f.extend(w,{created:y})})}}).then(function(F){if(F!=null&&F.site!=null){y=="manual"&&logmeonce.passwordManager(function(){this.verify=F.site.id});logmeonce.ssoRefresh(C,{id:F.site.id,created:y})}return F}).promise()},loadPasswordManager:function(v,A){var z=this.window(v);if(typeof A!=="undefined"){if((site=this.sites(v,{changepassword:true}))!=null&&site.changepassword.status.indexOf("changing")===0&&A!=null&&A.id==site.id){logmeonce.log("Change password for "+site.name+" - changing submitted");logmeonce.site("changepassword",function(){this.changepassword.form=A},site);return}this.passwordManager({form:A,manual:A!=null&&A.manual!=null,tab:logmeonce.window(v,"tab"),window:z!=null&&z!=z.top?z.name:null,time:new Date().getTime()})}var y=this.config.passwordManager;var x=f.grep(y.form.inputs,function(B){return B.type=="password"}).length>0;var w=this.config.user;if(w!=null&&w.offline===true){this.log("Password Manager - Offline mode");return}if(w!=null&&y.manual===true){if((this.allowed("site","create")||this.allowed("site","personal"))&&A==null){v.lmoPasswordManager=v.lmoPasswordManager++||1;this.injectUi(v,{name:"add-manually",listener:"all",args:[{form:y.form,groups:this.groups(),}]})}}else{if(w!=null&&x){if(y.form.id==null&&!(w.settings.flags&4)){this.log("Password Manager - Remember password setting disabled");return}if(y.form.id!=null&&!(w.settings.flags&8)){this.log("Password Manager - Change password setting disabled");return}if(this.allowed("site","create")||this.allowed("site","personal")){setTimeout(function(){v.lmoPasswordManager=v.lmoPasswordManager++||1;logmeonce.injectPasswordManagerUi(v)},A!=null?3000:0)}}else{if(x){this.config.get("offline.password-manager").then(function(B){B!=="0"&&setTimeout(function(){v.lmoPasswordManager=v.lmoPasswordManager++||1;logmeonce.injectPasswordManagerUi(v)},A!=null?3000:0)})}}}},injectFormTools:function(v){var x=logmeonce.window(v);var w=this.findElements(v,"form");var z=logmeonce.regex.test(v.location.href,logmeonce.regex.server(".*"),"i");var y=new RegExp(this.includeUrl("/")+".*");if(f("form:not([lmoId])",v).length>0){this.injectScript(v,{text:"("+(function(A){try{var D=function(G){if(A.all&&A.documentMode<=8){var F=A.createEventObject();F.propertyName="LMOSubmitEvent";F.targetForm=G;A.documentElement.fireEvent("onpropertychange",F)}else{var F=A.createEvent("Events");F.initEvent("LMOSubmitEvent",true,false);G.dispatchEvent(F)}};for(var B=0;B<A.forms.length;B++){var C=A.forms[B];if(C.getAttribute("lmoId")==null){C.setAttribute("lmoId",B);C.submit=function(G,F){return function(){D(G);return F.apply(this,arguments)}}(C,C.submit)}}}catch(E){}}).toString().replace(/\t|\n/g,"")+")(document); "})}logmeonce.attachEvent(x,"submit",function(A){logmeonce.formSubmited(A.target)},{useCapture:false});f.each(w,function(A,B){if(v.all&&v.documentMode<=8){logmeonce.attachEvent(B,"submit",function(C){logmeonce.formSubmited(C.target)})}f.each(B.elements,function(C,D){if(v.activeElement==D){D.lmoFocused=true}if(f.inArray(D.tagName,["INPUT","BUTTON"])>=0&&D.type=="submit"){logmeonce.attachEvent(D,"click",function(E){logmeonce.log("Form submitted via submit button click");logmeonce.formSubmited(B)},{useCapture:true})}if(D.tagName=="INPUT"&&D.type=="password"){logmeonce.attachEvent(D,"keypress",function(E){if(E.which==13||E.keyCode==13){logmeonce.log("Form submitted via Enter keypress");logmeonce.formSubmited(B)}},{useCapture:true})}if(f.inArray(D.tagName,["INPUT","SELECT","BUTTON"])>=0){if(D.tagName=="INPUT"&&D.lmoInitValue==null){D.lmoInitValue=D.value}if(D.tagName=="SELECT"&&D.lmoInitSelectedIndex==null){D.lmoInitSelectedIndex=D.selectedIndex}logmeonce.attachEvent(D,"focus",function(E){logmeonce.dispatchUiEvent(E.target,"lmoFocus");E.target.lmoFocused=true});logmeonce.attachEvent(D,"blur",function(E){logmeonce.dispatchUiEvent(E.target,"lmoBlur");E.target.lmoBlurred=new Date().getTime()});logmeonce.attachEvent(D,"click",function(E){logmeonce.dispatchUiEvent(E.target,"lmoClick");E.target.lmoClicked=true});logmeonce.attachEvent(D,"keydown",function(E){E.target.lmoKeydown=true});logmeonce.attachEvent(D,"keyup",function(F){if(F.target.tagName=="INPUT"&&F.target.type=="password"&&logmeonce.config.user!=null&&!z){if(this.value===logmeonce.config.password){this.lmoMasterPassword=true;var E=logmeonce.injectUiTarget(this);logmeonce.injectUi(v,{name:"notification",listener:"lmoKeyup",target:E.ui,top:false,args:[{target:E,title:logmeonce.translate._("Master password alert")+"!",message:logmeonce.translate._("Master password alert message")+"."}]})}else{if(this.lmoMasterPassword==true){this.lmoMasterPassword=false}}}logmeonce.dispatchUiEvent(F.target,"lmoKeyup");F.target.lmoKeyup=true;if(F.target.tagName=="INPUT"&&f.inArray(F.target.type,["text","email"])>=0){F.target.lmoKeyupValue=F.target.value}})}})});if(this.config.user==null){if(!z&&y.test(v.location.href)==false&&v.lmoEncourage==null&&(this.config.passwordManager.time==null||this.config.passwordManager.form==null||new Date().getTime()-this.config.passwordManager.time>30000)){f.each(w,function(A,B){var D=[];var C=f.grep(B.elements,function(E,F){if(E.tagName=="INPUT"&&E.type=="password"&&l(E)){D.push(E)}return E.tagName=="INPUT"&&(E.type=="text"||E.type=="email"||E.type=="password")&&l(E)});if(C.length>0&&D.length>0){f(B.elements).each(function(F,E){if(E.tagName=="INPUT"&&(E.type=="text"||E.type=="email"||E.type=="password")){E.setAttribute("lmoid","ui-encourage-"+A+"-"+F);E.setAttribute("autocomplete","off");logmeonce.attachEvent(E,"lmoEvent",function(I){var G=I.target.ownerDocument;if(I.name=="encourage-not-now"||I.name=="encourage-not-today"||I.name=="encourage-disable"){G.lmoEncourageNotNow=true}if(I.name=="encourage-not-today"||I.name=="encourage-disable"){var J=I.name=="encourage-not-today"?1:365;var H=new Date().getTime()+J*24*60*60*1000;logmeonce.config.set("offline.encourage",H)}});logmeonce.attachEvent(E,"mousedown",function(I){var G=I.target.ownerDocument;if(I.button==0&&logmeonce.config.user==null&&G.lmoEncourageNotNow!==true){function H(J,K){J.lmoEncourageNotToday=K;if(K==null||isNaN(K)||parseInt(K)<new Date().getTime()){var L=logmeonce.injectUiTarget(I.target);logmeonce.injectUi(J,{name:"encourage",target:L.ui,top:false,args:[{target:L}]})}}if(typeof G.lmoEncourageNotToday!="undefined"){H(G,G.lmoEncourageNotToday)}else{logmeonce.config.get("offline.encourage").then(function(J){H(G,J)})}}})}})}})}}else{if(!z){f.each(w,function(ai,T){T.lmoVisible=l(T,{coverage:false});var I={isVisible:[],findLabel:[]};var al=logmeonce.formPasswordsContiguous(T);var D=f.grep(T.elements,function(ap,ao){return ap.tagName=="INPUT"&&f.inArray(ap.type,["button","submit","hidden"])<0});var aj=f.grep(D,function(ap,ao){return ap.tagName=="INPUT"&&ap.type=="password"});var K=T.getAttribute("action")==null||T.getAttribute("action").length<=0||T.getAttribute("action")=="#";var N=((K&&logmeonce.regex.is(v.location.href,"password-forgot"))||f.grep(["id","name","class","action"],function(ap){var ao=ap=="action"?(T[ap].length>0?T[ap]:T.ownerDocument.location.href):T.getAttribute(ap);return logmeonce.regex.is(ao,"password-forgot")}).length>0);var E=((K&&logmeonce.regex.is(v.location.href,"password-change"))||f.grep(["id","name","class","action"],function(ap){var ao=ap=="action"?(T[ap].length>0?T[ap]:T.ownerDocument.location.href):T.getAttribute(ap);return logmeonce.regex.is(ao,"password-change")}).length>0);if(al&&aj.length>=2){var ae=0;var P=true;var B,A,W=[],aa;if(aj.length>=2){f.each(aj,function(ap,ao){if(f.grep(["id","name","class"],function(aq){return logmeonce.regex.is(f(ao).attr(aq),"password-current")}).length>0||f.inArray(ao.name,["current","curent"])>=0||logmeonce.regex.is(logmeonce.findLabel(ao,{cache:I},true),"password-current")){ae++;P=(ap==0);W.push(ao)}})}f.each(aj,function(ap,ao){if(f.inArray(ao,W)>=0){return}if(B==null&&(f.grep(["id","name","class"],function(aq){return logmeonce.regex.is(f(ao).attr(aq),"password-new")}).length>0||f.inArray(ao.name,["new"])>=0)){P=(ap>0);ae++;B=ao}if(A==null&&ao!=B&&(f.grep(["id","name","class"],function(aq){return logmeonce.regex.is(f(ao).attr(aq),"password-repeat")}).length>0||f.inArray(ao.name,["repeat","confirm"])>=0)){ae++;A=ao;if(ap>0&&B==null&&f.inArray(aj[ap-1],W)<0){B=aj[ap-1]}}return B==null||A==null});if(!(B&&A)){for(var ad=1;ad<=3;ad++){var am=D;var ag=false;var Z=-1;if(ad==1&&f.grep(aj,function(ao){return l(ao,{cache:I})}).length>=2){am=f.grep(D,function(ao){return l(ao,{cache:I})})}if(ad==1||ad==2){if(W.length>0){for(var ab=0;ab<am.length;ab++){if(f.inArray(am[ab],W)>=0){Z=ab+1}}}}else{Z=0}if(Z>=0){if(P){for(ab=am.length-1;ab>=Z;ab--){if(am[ab].type=="password"&&f.inArray(am[ab],W)<0){if(!(!ag&&B&&A)){A=B;B=am[ab];if(ag&&B&&A){break}}ag=true}else{ag=false}}}else{for(ab=Z;ab<am.length;ab++){if(am[ab].type=="password"&&f.inArray(am[ab],W)<0){if(!(!ag&&B&&A)){B=A;A=am[ab];if(ag&&B&&A){break}}ag=true}else{ag=false}}}if(B&&A){break}}}}if(B&&A){var M=B!=A?[B,A]:[B];f.each(M,function(ap,ao){ao.setAttribute("lmoName","password-generate-"+ap+"-"+ai);ao.lmoType="password-generate";logmeonce.attachPasswordGenerateEvent(ao,function(aq){f.each(M,function(ar,at){at.lmoType=="password-generate"&&logmeonce.inputFill(at,aq.password,{filled:false})})})});var X=E&&(aj.length==2||ae==2);var C=[];var G=f.grep(logmeonce.config.user.sites,function(ap,ao){if((ap.login.regex!=null&&logmeonce.regex.test(v.location.href,ap.login.regex,"i"))||(ap.login.url!=null&&ap.login.url.indexOf("http")===0&&logmeonce.regex.test(v.location.href,logmeonce.regex.url(ap.login.url),"i"))){C.push(ap.id);return true}});if(G.length>0){var D=f.grep(T.elements,function(ao){return(ao.tagName=="SELECT")||(ao.tagName=="INPUT"&&f.inArray(ao.type,["password","text","email","checkbox","radio","tel"])>=0)});var ac=f.grep(D,function(ao){return l(ao,{cache:I})});var F=function(ap,ao){return f.map(ap,function(aq){return f.inArray(aq,ao)<0?null:aq})};var Q=function(ap,ao){return ap.length==ao&&F(aj,ap).length==ao};if(W.length>0||X||(aj.length==2&&Q(ac,2))||(aj.length==3&&(Q(D,3)||Q(ac,3)))){T.lmoAction={name:"changePassword",id:C.length===1?C[0]:C,password:B};if(W.length<=0&&aj.length==3&&(Q(D,3)||Q(ac,3))){f.each(aj,function(ap,ao){if(ao!=B&&ao!=A){W.push(ao)}})}}f.each(W,function(ao,ap){ap.setAttribute("lmoName","password-current-"+ao+"-"+ai);ap.lmoType="password-current";logmeonce.attachEvent(ap,"lmoEvent",function(ar){if(ar.name=="fill"&&ar.args.id!=null){var aq=f.grep(G,function(au,at){return au.id==ar.args.id});if(aq.length>0&&logmeonce.fillPassword(this,aq[0])){T.lmoAction={name:"changePassword",id:ar.args.id,password:B}}}else{logmeonce.handleDefaultEvent(ar)}});logmeonce.attachEvent(ap,"lmoFocus",function(){if(v.lmoPasswordChanging!=null&&new Date().getTime()-v.lmoPasswordChanging<=200){return}logmeonce.injectPasswordFillUi(v,G,this)})})}else{if(W.length>0||X){T.lmoAction={name:"changePassword",id:[],password:B}}}}}else{if(aj.length==1&&(D.length==1||f.grep(D,function(ao){return l(ao,{cache:I})}).length==1)&&(E||N)){var R=aj[0];R.setAttribute("lmoName","password-generate-"+ai);R.lmoType="password-generate";logmeonce.attachPasswordGenerateEvent(R,true);var C=[];var G=f.grep(logmeonce.config.user.sites,function(ap,ao){if(ap.login.regex!=null&&(logmeonce.regex.test(v.location.href,ap.login.regex,"i")&&f.grep(ap.login.inputs,function(aq,ar){return aq.type=="password"&&(aq.flags==null||aq.flags&t)}).length==1)){C.push(ap.id);return true}});if(G.length>0){T.lmoAction={name:"changePassword",id:C,password:R}}}else{if(aj.length>=1&&logmeonce.formIsRegistration(T,{cache:I})){var V=aj.length>1?f.grep(aj,function(ao){return l(ao,{cache:I})}):[];if(aj.length==1||V.length==1){var R=aj.length==1?aj[0]:V[0];R.setAttribute("lmoName","password-generate-"+ai);R.lmoType="password-generate";logmeonce.attachPasswordGenerateEvent(R,true)}}}}if(f.inArray(logmeonce.browser.type,["android","iphone"])<0&&logmeonce.config.user.settings.flags&128){var O=T.getAttribute("lmoId");var ak=logmeonce.formAnalyze(T,{cache:I,allowMultiple:"address",autofill:true,mapping:true});var af=logmeonce.config.user.profile;var L=logmeonce.config.user.address;var an=logmeonce.config.user.phone;var H=logmeonce.config.user.company;var U=logmeonce.config.user.cards;function S(av){if(!(av.name=="fill"&&f.inArray(av.args.fill,["profile","address","phone","company"])>=0)){return logmeonce.handleDefaultEvent(av)}var at=af[av.args.fill=="profile"?av.args.index:0]||{};var aB=L[av.args.fill=="address"?av.args.index:0]||{};var ax=an[av.args.fill=="phone"?av.args.index:0]||{};var ay=H[av.args.fill=="company"?av.args.index:0]||{};var aw=this;var aA=function(aF,aE){return aE!=null&&(av.args.fill==aF||(f.inArray(aE.tagName,["INPUT","TEXTAREA"])>=0&&(aE.value.length<=0||aE.value===aE.lmoInitValue||!(aE.lmoFocused||aE.lmoClicked||aE.lmoKeydown||aE.lmoFilled)))||(aE.tagName=="SELECT"&&(aE.selectedIndex===aE.lmoInitSelectedIndex||!(aE.lmoFocused||aE.lmoClicked||aE.lmoKeydown||aE.lmoFilled))))};if(!(T.lmoAction!=null&&T.lmoAction.name=="changePassword")){var aC=ak.password!=null&&ak.password.lmoType=="password-generate"?ak.password:f.grep(aj,function(aE){return aE.lmoType=="password-generate"})[0];if(aC!=null&&aA(null,aC)){logmeonce.dispatchEvent(aC,"lmoEvent",{type:"custom",detail:{name:"pwdgen",args:{password:logmeonce.tools.passwordGenerate(),pwdgen:true}}})}}at.firstname!=null&&ak.firstname!=null&&f.each(ak.firstname instanceof Array?ak.firstname:[ak.firstname],function(aF,aE){if(aE.tagName=="INPUT"&&aA("profile",aE)){logmeonce.inputFill(aE,at.firstname,{events:false,filled:true})}});at.lastname!=null&&ak.lastname!=null&&f.each(ak.lastname instanceof Array?ak.lastname:[ak.lastname],function(aF,aE){if(aE.tagName=="INPUT"&&aA("profile",aE)){logmeonce.inputFill(aE,at.lastname,{events:false,filled:true})}});at.fullname!=null&&ak.fullname!=null&&f.each(ak.fullname instanceof Array?ak.fullname:[ak.fullname],function(aF,aE){if(aE.tagName=="INPUT"&&aA("profile",aE)){logmeonce.inputFill(aE,at.fullname,{events:false,filled:true})}});at.email!=null&&ak.email!=null&&f.each(ak.email instanceof Array?ak.email:[ak.email],function(aF,aE){if(aE.tagName=="INPUT"&&aA("profile",aE)){logmeonce.inputFill(aE,at.email,{events:false,filled:true})}});if(at.gender!=null&&ak.gender!=null){function ar(aF,aE){if(v.location.host.indexOf("facebook.com")>0){return(aE=="m"&&aF=="2")||(aE=="f"&&aF=="1")}return(aE=="m"&&aF=="1")||(aE=="f"&&aF=="2")}function ao(aE){aE=aE.toLowerCase();return((at.gender=="m"&&(aE=="m"||/^(?!fe)male/i.test(aE)||(f.inArray(aE,["1","2"])>=0&&ar(aE,"m"))))||(at.gender=="f"&&(aE=="f"||/female/i.test(aE)||(f.inArray(aE,["1","2"])>=0&&ar(aE,"f")))))}if(ak.gender instanceof Array&&f.grep(ak.gender,function(aE){return aE.tagName=="INPUT"&&aE.type=="radio"}).length==ak.gender.length){f.each(ak.gender,function(aF,aE){if(aA("profile",aE)&&ao(aE.value)){aE.checked=true;return false}})}else{if(ak.gender.tagName=="SELECT"&&aA("profile",ak.gender)){f("option",ak.gender).each(function(aE,aF){if(ao(aF.value)){logmeonce.inputFill(ak.gender,aF.index,{events:false,filled:true});return false}})}}}if(at.birthdate!=null&&ak.birthdate!=null){var ap=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"];var az={"appleid.apple.com":"mm/dd/yyyy","profile.weather.com":"mm / dd / yyyy"};var aq=(function(aF,aG,aE){return{year:parseInt(aF),month:parseInt(aG),day:parseInt(aE),date:new Date(parseInt(aF),parseInt(aG)-1,parseInt(aE))}}).apply(this,at.birthdate.split("-"));function au(aF,aE){if(aF=="month"&&isNaN(aE)){return new RegExp(ap[aq.month-1],"i").test(aE)}return parseInt(aE)==aq[aF]}if(f.isPlainObject(ak.birthdate)){f.each(ak.birthdate,function(aF,aE){if(aA("profile",aE)){if(aE.tagName=="SELECT"){f("option",aE).each(function(aG,aH){if(au(aF,aH.value)){logmeonce.inputFill(aE,aH.index,{events:false,filled:true});return false}})}else{logmeonce.inputFill(aE,aq[aF],{events:false,filled:true})}}})}else{f.each(ak.birthdate instanceof Array?ak.birthdate:[ak.birthdate],function(aF,aE){if(aE.tagName=="INPUT"&&aA("profile",aE)){logmeonce.inputFill(aE,az[v.location.host]!=null?logmeonce.tools.dateformat(aq.date,az[v.location.host]):aq.date.toLocaleDateString(),{events:false,filled:true})}})}}at.age!=null&&ak.age!=null&&f.each(ak.age instanceof Array?ak.age:[ak.age],function(aF,aE){if(aE.tagName=="INPUT"&&aA("profile",aE)){logmeonce.inputFill(aE,at.age,{events:false,filled:true})}});if(aB.address!=null&&ak.address!=null){if(ak.address instanceof Array){var aD=aB.address.split("\n");f.each(ak.address,function(aF,aE){if(aA("address",aE)&&aF<aD.length){logmeonce.inputFill(aE,aD[aF],{events:false,filled:true})}})}else{if(f.inArray(ak.address.tagName,["INPUT","TEXTAREA"])>=0&&aA("address",ak.address)){logmeonce.inputFill(ak.address,aB.address,{events:false,filled:true})}}}aB.country!=null&&ak.country!=null&&f.each(ak.country instanceof Array?ak.country:[ak.country],function(aF,aE){if(aE.tagName=="SELECT"&&aA("address",aE)){var aH=function(aJ,aI){return aJ.code.toLowerCase()==aI.value.toLowerCase()};var aG=function(aJ,aI){switch(aJ.code){case"US":return aJ.name.toLowerCase()==aI.text.toLowerCase()||["United States","United States of America","USA"].indexOf(aI.text)>=0;default:return aJ.name.toLowerCase()==aI.text.toLowerCase()}};f("option",aE).each(function(aI,aJ){if(aH(aB.country,aJ)||aG(aB.country,aJ)){logmeonce.inputFill(aE,aJ.index,{events:false,filled:true});return false}})}else{if(aE.tagName=="INPUT"&&aA("address",aE)){logmeonce.inputFill(aE,aB.country.name,{events:false,filled:true})}}});aB.state!=null&&ak.state!=null&&f.each(ak.state instanceof Array?ak.state:[ak.state],function(aF,aE){if(aE.tagName=="SELECT"&&aA("address",aE)){var aH=function(aJ,aI){return aJ.code.toLowerCase()==aI.value.toLowerCase()};var aG=function(aJ,aI){return aJ.name.toLowerCase()==aI.text.toLowerCase()};f("option",aE).each(function(aI,aJ){if(aH(aB.state,aJ)||aG(aB.state,aJ)){logmeonce.inputFill(aE,aJ.index,{events:false,filled:true});return false}})}else{if(aE.tagName=="INPUT"&&aA("address",aE)){logmeonce.inputFill(aE,aB.state.name,{events:false,filled:true})}}});aB.city!=null&&ak.city!=null&&f.each(ak.city instanceof Array?ak.city:[ak.city],function(aF,aE){if(aE.tagName=="INPUT"&&aA("address",aE)){logmeonce.inputFill(aE,aB.city,{events:false,filled:true})}});aB.zip!=null&&ak.zip!=null&&f.each(ak.zip instanceof Array?ak.zip:[ak.zip],function(aF,aE){if(aE.tagName=="INPUT"&&aA("address",aE)){logmeonce.inputFill(aE,aB.zip,{events:false,filled:true})}});aB.location!=null&&ak.location!=null&&f.each(ak.location instanceof Array?ak.location:[ak.location],function(aF,aE){if(aE.tagName=="INPUT"&&aA("address",aE)){logmeonce.inputFill(aE,aB.location,{events:false,filled:true})}});ak.phone!=null&&f.each(ak.phone instanceof Array?ak.phone:[ak.phone],function(aG,aF){var aH=f.grep(ak.phone instanceof Array?ak.phone:[ak.phone],function(aL){return aL!=aF});var aI=aF.number!=null?aF.number:aF;var aK=aI==aw||aF.cc==aw?"phone":"phone"+aG;var aJ=f.grep(an,function(aL){return aL.type==aF.type}).length>0;var aE=aK!="phone"&&aJ?f.grep(an,function(aL){return aL.type==aF.type})[0]:ax;if(aK!="phone"&&!aJ&&f.grep(aH,function(aL){return f.grep(an,function(aM){return aM.type==aL.type}).length>0}).length>0&&(!l(aI,{cache:I})||f.grep(aH,function(aL){return l(aL.number!=null?aL.number:aL,{cache:I})}).length>0)){return}if(aE.cc!=null&&aF.cc!=null&&aA(aK,aF.cc)){if(aF.cc.tagName=="SELECT"){f("option",aF.cc).each(function(aL,aM){if(aE.cc==aM.value||(aE.country!=null&&aE.country.toLowerCase()==aM.value.toLowerCase())){if(aF.cc.lmoFilled!=true||!aM.selected){logmeonce.inputFill(aF.cc,aM.index,{events:false,filled:true})}return false}});if(aI.id.length>0&&f(v).find(aI).length<=0){aI=f(v).find("#"+aI.id).get(0)}}else{if(aF.cc.tagName=="INPUT"){logmeonce.inputFill(aF.cc,"+"+aE.cc,{events:false,filled:true})}}}if(aE.number!=null&&aI.tagName=="INPUT"&&aA(aK,aI)){logmeonce.inputFill(aI,aE.cc!=null&&av.args.cc===true?"+"+aE.cc+aE.number:aE.number,{events:false,filled:true})}});ay.name!=null&&ak.company!=null&&f.each(ak.company instanceof Array?ak.company:[ak.company],function(aF,aE){if(aE.tagName=="INPUT"&&aA("company",aE)){logmeonce.inputFill(aE,ay.name,{events:false,filled:true})}});ay.jobtitle!=null&&ak.jobtitle!=null&&f.each(ak.jobtitle instanceof Array?ak.jobtitle:[ak.jobtitle],function(aF,aE){if(aE.tagName=="SELECT"&&aA("company",aE)){f("option",aE).each(function(aG,aH){if(aH.value.indexOf(ay.jobtitle)>=0||aH.text.indexOf(ay.jobtitle)>=0){logmeonce.inputFill(aE,aH.index,{events:false,filled:true});return false}})}else{if(aE.tagName=="INPUT"&&aA("company",aE)){logmeonce.inputFill(aE,ay.jobtitle,{events:false,filled:true})}}});ay.website!=null&&ak.website!=null&&f.each(ak.website instanceof Array?ak.website:[ak.website],function(aF,aE){if(aE.tagName=="INPUT"&&aA("company",aE)){logmeonce.inputFill(aE,ay.website,{events:false,filled:true})}});setTimeout(function(aE){aE.lmoContentLoaded=logmeonce.getContentHash(aE)},0,v)}function ah(au){if(!(au.name=="fill"&&f.inArray(au.args.fill,["card"])>=0)){return logmeonce.handleDefaultEvent(au)}var at=f.extend({},U[au.args.index]||{});var ap=f.each(at,function(aA,aB){try{at[aA]=f.inArray(aA,["id","color"])<0?logmeonce.decrypt(v,aB):aB}catch(aC){delete at[aA]}});var ay={events:false,filled:true};var av=this;f.each(ak.card,function(aA){ak.card[aA]!=null&&f.each(ak.card[aA] instanceof Array?ak.card[aA]:[ak.card[aA]],function(aC,aB){aB.lmoFocusLast=new Date().getTime()})});if(ap.type!=null&&ak.card.type!=null){var az=ap.type.replace(/ /g,"(.)?");ak.card.type.tagName=="SELECT"&&f("option",ak.card.type).each(function(aA,aB){if(logmeonce.regex.test(aB.value,az,"i")||logmeonce.regex.test(aB.text,az,"i")){logmeonce.inputFill(ak.card.type,aB.index,ay);return false}})}ap.number!=null&&ak.card.number!=null&&f.each(ak.card.number instanceof Array?ak.card.number:[ak.card.number],function(aB,aA){if(aA.tagName=="INPUT"){logmeonce.inputFill(aA,ap.number,ay)}});ap.code!=null&&ak.card.code!=null&&f.each(ak.card.code instanceof Array?ak.card.code:[ak.card.code],function(aB,aA){if(aA.tagName=="INPUT"){logmeonce.inputFill(aA,ap.code,ay)}});ap.name!=null&&ak.card.name!=null&&f.each(ak.card.name instanceof Array?ak.card.name:[ak.card.name],function(aB,aA){if(aA.tagName=="INPUT"){logmeonce.inputFill(aA,ap.name,ay)}});ap.issuer!=null&&ak.card.issuer!=null&&f.each(ak.card.issuer instanceof Array?ak.card.issuer:[ak.card.issuer],function(aB,aA){if(aA.tagName=="INPUT"){logmeonce.inputFill(aA,ap.issuer,ay)}});if(ap.year!=null&&ap.month!=null){function ao(aB,aC){var aA;if(((aA=aB.placeholder.match(/([M])\1+/))!=null&&aA[0].length==2)){return logmeonce.tools.pad(aC,2)}return aC}function aq(aB,aC){var aA;if(((aA=aB.placeholder.match(/([Y])\1+/))!=null&&aA[0].length>=2&&aA[0].length<=4)){return aC.substring(aC.length-aA[0].length)}return aC}function ar(aA){return function(aB,aC){if((parseInt(aC.text,10)||parseInt(aC.value,10))==aA){logmeonce.inputFill(aC.parentElement,aC.index,ay);return false}}}function ax(aA,aC,aB){return function(aD,aE){if(parseInt(aE[aC],10)==aB){logmeonce.inputFill(aE.parentElement,aE.index,ay);return aA.matching=false}}}function aw(aB,aC){var aA={matching:true};aA.matching&&f("option",aB).each(ax(aA,"text",aC));aA.matching&&f("option",aB).each(ax(aA,"value",aC))}ak.card.year!=null&&f.each(ak.card.year instanceof Array?ak.card.year:[ak.card.year],function(aB,aA){aA.tagName=="INPUT"&&logmeonce.inputFill(aA,aq(aA,ap.year),ay);aA.tagName=="SELECT"&&aw(aA,ap.year)});ak.card.month!=null&&f.each(ak.card.month instanceof Array?ak.card.month:[ak.card.month],function(aB,aA){aA.tagName=="INPUT"&&logmeonce.inputFill(aA,ao(aA,ap.month),ay);aA.tagName=="SELECT"&&aw(aA,ap.month)});ak.card.date!=null&&f.each(ak.card.date instanceof Array?ak.card.date:[ak.card.date],function(aB,aA){aA.tagName=="INPUT"&&logmeonce.inputFill(aA,ao(aA,ap.month)+"/"+aq(aA,ap.year),ay)})}}function J(ao,ap){if(!(ao.tagName=="INPUT"&&f.inArray(ao.type,["radio","checkbox"])<0)&&!(ao.tagName=="TEXTAREA")){return}if(ap!=null){logmeonce.attachEvent(ao,"lmoFocus",function(){logmeonce.injectAutofillProfileUi(v,ap,this)});logmeonce.attachEvent(ao,"lmoEvent",S);ao.lmoType="autofill-profile"}else{if(logmeonce.config.user!=null&&logmeonce.config.user.settings.flags&2048){logmeonce.attachIconEvent(ao,false)}}}function Y(ao,ap){if(!(ao.tagName=="INPUT"&&f.inArray(ao.type,["radio","checkbox"])<0)&&!(ao.tagName=="TEXTAREA")){return}if(ap!=null){logmeonce.attachEvent(ao,"lmoFocus",function(){logmeonce.injectAutofillCardsUi(v,ap,this)});logmeonce.attachEvent(ao,"lmoEvent",ah);ao.lmoType="autofill-cards"}else{if(logmeonce.config.user!=null&&logmeonce.config.user.settings.flags&2048){logmeonce.attachIconEvent(ao,false)}}}f.each(["firstname","lastname","fullname","email","birthdate","age"],function(ap,ao){ak[ao]!=null&&f.each(ak[ao] instanceof Array?ak[ao]:[ak[ao]],function(ar,aq){J(aq,f.grep(af,function(at){return at[ao]!=null}).length>0?{profiles:af}:null)})});f.each(["city","country","state","address","zip","location"],function(ap,ao){ak[ao]!=null&&f.each(ak[ao] instanceof Array?ak[ao]:[ak[ao]],function(ar,aq){J(aq,f.grep(L,function(at){return at[ao]!=null}).length>0?{addresses:L}:null)})});f.each(["company","website","jobtitle"],function(ap,ao){ak[ao]!=null&&f.each(ak[ao] instanceof Array?ak[ao]:[ak[ao]],function(ar,aq){J(aq,f.grep(H,function(at){return at[ao=="company"?"name":ao]!=null}).length>0?{companies:H}:null)})});ak.phone!=null&&f.each(ak.phone instanceof Array?ak.phone:[ak.phone],function(ap,ao){var ar=ao.cc!=null?ao.cc:null;var aq=ao.number!=null?ao.number:ao;f.each([ar,aq],function(au,at){at!=null&&J(at,an.length>0?{phones:an}:null)})});ak.card!=null&&f.each(ak.card,function(ao){ak.card[ao]!=null&&f.each(ak.card[ao] instanceof Array?ak.card[ao]:[ak.card[ao]],function(aq,ap){if(ap.type=="password"&&ap.lmoType=="password-generate"){ap.lmoType="password-cc-code"}Y(ap,f.grep(U,function(ar){if(ao==="date"){return ar.year!=null&&ar.month!=null}return ar[ao]!=null}).length>0?U:null)})})}});f.each(logmeonce.config.user.autofill.mapping,function(B,A){A.name.indexOf("note-")===0&&logmeonce.regex.test(v.location.href,A.url,"i")&&f.each(logmeonce.findElements(v,A.element),function(D,C){logmeonce.attachEvent(C,"lmoFocus",function(){var H=logmeonce.injectUiTarget(C);var F=A.name.substring(5);var G=F==="site"?f.grep(logmeonce.config.user.sites,function(I){return(I.login.regex!=null&&logmeonce.regex.test(v.location.href,I.login.regex,"i"))||(I.login.url!=null&&I.login.url.indexOf("http")===0&&logmeonce.regex.test(v.location.href,logmeonce.regex.url(I.login.url),"i"))}):[];var E=logmeonce.config.user;logmeonce.injectUi(v,{name:"autofill-notes",target:H.ui,top:false,args:[{target:H,category:F,sites:f.map(G,function(I){return{id:I.id,name:I.name,icon:I.icon,note:I.note,allowed:{"delete":logmeonce.allowed(I,"delete")},inputs:f.grep(I.login.inputs,function(J){return f.inArray(J.type,["radio","checkbox"])<0&&(I.privileges==null||I.privileges&2||J.mapping===3)})}}),user:{desktopmode:E.flags&4096,license:E.license,owner:E.owner}}]})});logmeonce.attachEvent(C,"lmoEvent",function(E){if(E.name=="autofill"&&E.autofill=="note"){if(typeof E.note==="object"&&E.note.id!=null){logmeonce.notes(v,{id:E.note.id,decrypt:true}).then(function(F){typeof F.body==="string"&&logmeonce.inputFill(C,F.body,{events:false,filled:true})})}else{if(typeof E.note==="string"){logmeonce.inputFill(C,E.note,{events:false,filled:true})}}}else{logmeonce.handleDefaultEvent(E)}});C.lmoType="autofill-notes"})})}}},passwordGenerated:function(v,w){this.copyToClipboard(w);if(this.notification!=null&&this.config.user!=null){this.notification.create({user:this.config.user.id,type:this.notification.type.PasswordGenerated,url:v.location.href,host:this.tools.parseHost(v.location.href),password:w})}},pageAction:function(v,y){var w=f.Deferred();var x=this.window(v);if((y.regex!=null&&logmeonce.regex.test(v.location.href,y.regex,"i")==false)||(y.window!=null&&y.window=="top"&&x!=x.top)){w.rejectWith(this,[v]);return w.promise()}if(y.click!=null){w.notifyWith(logmeonce,[v,setTimeout(function(){try{if(y.click.indexOf("regexp")>0){f.extend(f.expr[":"],{regexp:function(F,E,D,G){var C=JSON.parse(D[3]);return new RegExp(C[0],C[1]).test(F.textContent||F.innerText||"")}})}var z=0;var A=function(D,C){if(f(D,C).length>0){f(D,C).each(function(){if(this.ownerDocument.activeElement!=this){this.focus()}setTimeout(function(){w.resolveWith(logmeonce,[C])},y.resolve!=null?y.resolve:0);logmeonce.log("Page action - click on "+D);logmeonce.dispatchEvent(this,"click",{type:"mouse"});z++});return true}return false};if(A.call(this,y.click,v)==false){setTimeout(function(){f("iframe",v).each(function(C,D){return !A.call(this,y.click,D.contentWindow.document)});z<=0&&w.rejectWith(logmeonce,[v])},y.delay!=null?y.delay:0)}}catch(B){w.rejectWith(logmeonce,[v]);logmeonce.log("Click Action: "+B)}},y.delay!=null?y.delay:0)])}else{if(y.redirect!=null){w.notifyWith(logmeonce,[v,setTimeout(function(){try{w.resolveWith(logmeonce,[v]);logmeonce.log("Page action - redirect to "+y.redirect);v.location.href=y.redirect}catch(z){logmeonce.log("Redirect action: "+z)}},y.delay!=null?y.delay:0)])}else{w.notifyWith(logmeonce,[v,setTimeout(function(){w.rejectWith(logmeonce,[v])},y.delay!=null?y.delay:0)])}}return w.promise()},pageChangePasswords:function(v,x){var A=this.findElements(v,"input[type=password]");var z=x.changepassword.changing!=null&&x.changepassword.changing.current!=null?this.findElements(v,x.changepassword.changing.current):[];if(z.length<=0){z=f.grep(A,function(B){return B.lmoType=="password-current"})}var w=x.changepassword.changing!=null&&x.changepassword.changing["new"]!=null?this.findElements(v,x.changepassword.changing["new"]):[];if(w.length<=0){w=f.grep(A,function(B){return B.lmoType=="password-generate"&&(z.length!==1||B.form==z[0].form)})}var y=z.length==1?(z[0].form||z[0].lmoForm||v.lmoForm):(w.length>0?(w[0].form||w[0].lmoForm||v.lmoForm):null);if(z.length>1){z=f.grep(z,function(B){return(B.form||B.lmoForm||v.lmoForm)==y})}return{current:z,anew:w,form:y,total:z.length+w.length}},pageSecurityCheck:function(v,w,x){var z={question:null,answer:null,index:0};function y(A){logmeonce.dispatchEvent(A,"mousedown",{type:"mouse"});logmeonce.dispatchEvent(A,"click",{type:"mouse"});logmeonce.dispatchEvent(A,"mouseup",{type:"mouse"});setTimeout(function(B){B.lmoContentLoaded=logmeonce.getContentHash(B)},0,v)}this.browser.type=="logmeonce"&&w.changepassword.security!=null&&f.each(w.changepassword.security instanceof Array?w.changepassword.security:[w.changepassword.security],function(C,F){if(F.required!=null&&w.changepassword.status.indexOf(F.required)!=0&&w.changepassword.status.indexOf("security")!=0){return}var A=F.question!=null?logmeonce.findElements(v,F.question):[];var E=F.answer!=null?logmeonce.findElements(v,F.answer):[];if(A.length>0&&E.length<=0&&f.grep(A,function(H){return H.tagName=="INPUT"&&H.type=="radio"&&H.checked==false}).length==A.length){y(A[0]);E=F.answer!=null?logmeonce.findElements(v,F.answer):[]}if(A.length>0&&(E.length>0||F.answer===null)){var B=F.label!=null?logmeonce.findElements(v,F.label):[];var D=[],G=[];f.each(A,function(I,H){var J=f(H).text().trim();if(H.tagName=="INPUT"&&H.type=="radio"){if(H.id!=null&&H.id.length>0&&f("label[for="+H.id+"]",v).length==1){J=f("label[for="+H.id+"]",v).text().trim()}if(B.length==1&&A.length>1&&H.checked==false&&!!x==false){y(H);B=logmeonce.findElements(v,F.label);E=logmeonce.findElements(v,F.answer)}}if(B.length==1||B.length==A.length){D.push({question:J,label:f(B[B.length==1?0:I]).text().trim()})}else{D.push(J)}});z.index=C;z.question=D;z.elements=A;z.answer=E;z.message=F.message!=null?f(F.message,v):null;return false}});return z},pageChangePassword:function(F,v,D){if(F.lmoSSOLoaded===true&&v.changepassword.status=="login"){this.log("Change password for "+v.name+" - navigating");this.site("changepassword",function(){this.changepassword.passwords=logmeonce.pageChangePasswords(F,v).total;this.changepassword.status="navigating"},v)}else{if(F.lmoSSOLoaded===true&&v.changepassword.status=="navigating"&&!D){this.log("Change password for "+v.name+" failed at login page");this.site("changepassword",function(){this.changepassword.time=0;this.changepassword.status="failed";this.changepassword.failed="login"},v)}else{if(f.inArray(v.changepassword.status,["saving","completed","failed"])<0&&!(v.changepassword.changing!=null&&v.changepassword.changing.regex!=null&&logmeonce.regex.test(F.location.href,v.changepassword.changing.regex,"i")==false)){var B=this.window(F);var z=this.pageChangePasswords(F,v);var H=z.current;var C=z.anew;var x=z.form;var G=this.pageSecurityCheck(F,v);if(G.question!=null&&G.answer!=null){if(D!=null&&D.answers!=null&&D.answers.length>0){D.answers.length>1&&G.answer.length==1&&f.each(D.answers,function(I,J){if(J!=null&&J.length>0){if(G.question.length==D.answers.length){if(G.elements[I].tagName=="INPUT"&&G.elements[I].type=="radio"&&G.elements[I].checked==false){logmeonce.dispatchEvent(G.elements[I],"mousedown",{type:"mouse"});logmeonce.dispatchEvent(G.elements[I],"click",{type:"mouse"});logmeonce.dispatchEvent(G.elements[I],"mouseup",{type:"mouse"});setTimeout(function(K){K.lmoContentLoaded=logmeonce.getContentHash(K)},0,F);G=logmeonce.pageSecurityCheck(F,v,true)}else{if(G.elements[I].tagName=="OPTION"&&G.elements[I].selected==false){G.elements[I].selected=true}}}D.answers=[J];return false}});var w=null;if(G.answer.length>0){for(var A=0;A<D.answers.length&&A<G.answer.length;A++){this.log("Change password for "+v.name+" filling security answer "+A);this.inputFill(G.answer[A],D.answers[A])}w=G.answer[0].form||G.answer[0].lmoForm}else{if(G.elements[0].tagName=="INPUT"){w=G.elements[0].form||G.elements[0].lmoForm}}this.site("changepassword",function(){this.changepassword.status="security-answer"+(G.index>0?"-"+G.index:"");this.changepassword.security.data=null},v);this.formSubmit(w||F.lmoForm,function(){if(v.changepassword.security!=null&&v.changepassword.security.submit===false){return false}return v.changepassword.security!=null&&v.changepassword.security.submit!=null?f(v.changepassword.security.submit,F).get(0):null})}else{if(v.changepassword.status=="security-answer"+(G.index>0?"-"+G.index:"")){this.log("Change password for "+v.name+" failed at security page");this.site("changepassword",function(){this.changepassword.time=0;this.changepassword.status="failed";this.changepassword.failed="security"},v)}else{this.log("Change password for "+v.name+" pending for security check");logmeonce.site("changepassword",function(){this.changepassword.status="security-check"+(G.index>0?"-"+G.index:"");this.changepassword["security-index"]=G.index;this.changepassword["security-data"]={questions:G.question,answers:G.answer.length,message:G.message!=null&&G.message.length>0&&G.message.text().trim().length>0?G.message.text().trim():null}},v)}}}else{if(v.changepassword.status.indexOf("changing")==0&&v.changepassword.form!=null&&B==B.top){var E=v.changepassword.changing!=null&&v.changepassword.changing.error!=null?f(v.changepassword.changing.error,F):null;if(E!=null&&E.length>0&&E.text().trim().length>0){this.log("Change password for "+v.name+" failed: "+E.text().trim());this.site("changepassword",function(){this.changepassword.time=0;this.changepassword.status="failed";this.changepassword.failed=E.text().trim()},v)}else{this.log("Change password for "+v.name+" - saving");this.site("changepassword",function(){this.changepassword.status="saving"},v);this.savePasswordManager(F,v.changepassword.form).then(null,function(I){if(I.exception!=null){logmeonce.log("Change password for "+v.name+" - failed: "+I.exception.message);logmeonce.site("changepassword",function(){this.changepassword.time=0;this.changepassword.status="failed";this.changepassword.failed=I.exception.message},v)}})}}else{if(H.length==1||C.length>0){var y=H.length==1&&C.length>0?"changing":(H.length==1?"changing-current":"changing-new");F.lmoPasswordChanging=new Date().getTime();F.lmoPasswordTimeout!=null&&clearTimeout(F.lmoPasswordTimeout);if(v.changepassword.status==y){this.log("Change password for "+v.name+" failed at "+y+" page");this.site("changepassword",function(){this.changepassword.time=0;this.changepassword.status="failed";this.changepassword.failed=y},v)}else{F.lmoPasswordTimeout=setTimeout(function(I){I.lmoPasswordChanging=new Date().getTime();I.lmoPasswordTimeout!=null&&clearTimeout(I.lmoPasswordTimeout);if(v.changepassword.changing!=null&&v.changepassword.changing.action!=null){var L=f.grep(v.changepassword.changing.action instanceof Array?v.changepassword.changing.action:[v.changepassword.changing.action],function(M){return M.completed!==true&&!(M.regex!=null&&logmeonce.regex.test(I.location.href,M.regex,"i")==false)}).shift();if(L!=null){logmeonce.pageAction(I,L).progress(function(M,N){M.lmoPasswordTimeout=N}).then(function(M){return function(N){logmeonce.site("changepassword",function(){L.completed=true},v);N.lmoPasswordTimeout!=null&&clearTimeout(N.lmoPasswordTimeout);N.lmoPasswordTimeout=setTimeout(function(){M()},v.changepassword.changing!=null&&v.changepassword.changing.timeout!=null?v.changepassword.changing.timeout:0)}}(arguments.callee));if(I.lmoPasswordTimeout!=null){return}}}logmeonce.log("Change password for "+v.name+" - "+y);logmeonce.site("changepassword",function(){this.changepassword.status=y},v);if(H.length==1){f.each(H,function(N,M){logmeonce.log("Filling current password for "+v.name);logmeonce.fillPassword(M,v)});x.lmoAction={name:"skip"}}if(C.length>0){var K=logmeonce.tools.passwordGenerate(v.changepassword.policy);f.each(C,function(N,M){logmeonce.log("Filling new password for "+v.name);logmeonce.inputFill(M,K,{filled:false})});x.lmoAction={name:"changePassword",id:v.id,password:K}}I.lmoContentLoaded=logmeonce.getContentHash(I);f.each(logmeonce.findElements(I,"form"),function(M,N){N.lmoVisible=l(N,{coverage:false})});logmeonce.attachEvent(x,"lmoFormReseted",function(){logmeonce.log("Change password for "+v.name+" - changing form is reseted");setTimeout(function(){logmeonce.pageChangePassword(I,v)},5000)});if(v.changepassword.changing!=null&&v.changepassword.changing.submit==="security"&&v.changepassword.security!=null){logmeonce.pageChangePassword(I,v)}else{logmeonce.formSubmit(x,function(){if(v.changepassword.changing!=null&&v.changepassword.changing.submit===false){return false}var M=v.changepassword.changing!=null&&v.changepassword.changing.submit!=null?f(v.changepassword.changing.submit,I).get(0):null;I.lmoForm===x&&M!=null&&setTimeout(function(){logmeonce.log("Form submitted - virtual form");logmeonce.formSubmited(x)},0);return M}).then(function(N){var M=N.ownerDocument;if(v.changepassword.changing!=null&&v.changepassword.changing.submitted){M.lmoContentLoaded=logmeonce.getContentHash(M);f.each(logmeonce.findElements(M,"form"),function(O,P){P.lmoVisible=l(P,{coverage:false})})}})}if(v.changepassword.changing!=null&&(v.changepassword.changing.error!=null||v.changepassword.changing.success!=null)){var J=setInterval(function(){var M=v.changepassword.changing.error!=null?f(v.changepassword.changing.error,I):null;var N=v.changepassword.changing.success!=null?f(v.changepassword.changing.success,I):null;if(M!=null&&M.length>0&&M.text().trim().length>0){logmeonce.log("Change password for "+v.name+" failed: "+M.text().trim());clearInterval(J);logmeonce.site("changepassword",function(){this.changepassword.time=0;this.changepassword.status="failed";this.changepassword.failed=M.text().trim()},v)}if(N!=null&&N.length>0&&N.text().trim().length>0){logmeonce.log("Change password success message - "+N.text().trim());clearInterval(J);if(v.changepassword.form==null&&x.lmoAction!=null&&x.lmoAction.name=="changePassword"&&x.lmoAction.password!=null){v.changepassword.form={id:v.id,url:I.location.href,inputs:[{flags:k,type:"password",value:x.lmoAction.password}]}}logmeonce.pageChangePassword(I,v)}},1000)}},v.changepassword.changing!=null&&v.changepassword.changing.timeout!=null?v.changepassword.changing.timeout:0,F)}}else{if(v.changepassword.navigate instanceof Array&&v.changepassword.navigating<v.changepassword.navigate.length-1){if(v.changepassword.status=="login"&&v.changepassword.navigate[v.changepassword.navigating]=="login"&&F.lmoSSOLoaded!==true){return}if(typeof v.changepassword.navigate[v.changepassword.navigating+1]=="string"){B==B.top&&this.site("changepassword",function(){var I=this.changepassword.navigate[++this.changepassword.navigating];this.changepassword.status="navigating-"+this.changepassword.navigating;logmeonce.log("Change password for "+this.name+" - "+this.changepassword.status);setTimeout(function(){B.location.href=I},0)},v)}else{if(F.lmoNavigatingAction!=v.changepassword.navigating){F.lmoNavigatingAction=v.changepassword.navigating;this.pageAction(F,v.changepassword.navigate[v.changepassword.navigating+1]).then(function(){this.site("changepassword",function(){this.changepassword.navigating++;this.changepassword.status="navigating-"+this.changepassword.navigating;logmeonce.log("Change password for "+this.name+" - "+this.changepassword.status)},v)},function(){if(F.lmoNavigatingAction==v.changepassword.navigating){delete F.lmoNavigatingAction}})}}}}}}}}}},pageLoaded:function(O,A){if(this.config.user!=null&&this.config.user.sites!=null){var F=O.lmoReferrer;var E={};var I=[];var S=0;var K={isVisible:[]};var M=f.inArray(logmeonce.browser.type,["android","iphone"])>=0;var N=f.grep(this.config.user.sites,function(aa,Z){return((aa.login.regex!=null&&logmeonce.regex.test(O.location.href,aa.login.regex,"i"))||(F!=null&&aa.id==F.id&&F.parent==null))});var G=f.grep(N,function(Z){return f.grep(Z.login.inputs,function(aa){return aa.type=="password"}).length>0});var Y=f.grep(N,function(Z){return f.grep(Z.login.inputs,function(aa){return aa.flags&32}).length>0});if(N.length>0){K.forms=this.findElements(O,"form")}var V=f.grep(N,function(aa){var Z=logmeonce.findForm(O,aa,{cache:K});if(Z!=null){E[aa.id]=Z;f.each(Z.list!=null?f.merge([Z],Z.list):[Z],function(ab,ac){f.each(ac.inputs,function(ae,ad){if(ad.user.flags&t&&I.indexOf(ad.target)<0){I.push(ad.target)}})});S+=Z.visible?1:0;return !((Z.action!=null&&Z.action.name=="changePassword")||(aa.changepassword!=null&&aa.changepassword.changing!=null&&aa.changepassword.changing.regex!=null&&logmeonce.regex.test(O.location.href,aa.changepassword.changing.regex,"i")))&&(!Z.anonymous||Z.multiPurpose||!logmeonce.formIsRegistration(Z.form,{cache:K}))}});if(!M){f.each(I,function(aa,Z){Z.lmoType="select";Z.setAttribute("autocomplete","off");logmeonce.attachEvent(Z,"lmoFocus",function(ab){logmeonce.injectSiteSelectUi(O,N,this)});logmeonce.attachEvent(Z,"lmoEvent",logmeonce.handleDefaultEvent)})}if(G.length>0&&!M){f.each(K.forms,function(aa,ab){var ac=f.grep(ab.elements,function(ad,ae){return ad.tagName=="INPUT"&&ad.type=="password"});if(ac.length==1&&ac[0].lmoType==null){var Z=ac[0];Z.lmoType="password-current";logmeonce.attachEvent(Z,"lmoEvent",function(ae){if(ae.name=="fill"&&ae.args.id!=null){var ad=f.grep(N,function(ag,af){return ag.id==ae.args.id});if(ad.length>0&&logmeonce.fillPassword(this,ad[0])){this.form.lmoAction={name:"skip"}}}else{logmeonce.handleDefaultEvent(ae)}});logmeonce.attachEvent(Z,"lmoFocus",function(ad){logmeonce.injectPasswordFillUi(O,G,this)})}})}var z=false;var B=new Date().getTime();var x=this.config.loginList.length>0?this.config.loginList[this.config.loginList.length-1]:null;var W=x!=null&&x.flags&256&&(x.filled&k)===0&&B-x.time<10000&&f.grep(V,function(Z){return Z.id==x.id&&E[Z.id]!=null&&f.grep(E[Z.id].inputs,function(aa){return aa.target.type=="password"&&aa.user.flags&k}).length>0}).length==1;var H=x!=null&&x.totp!=null&&f(x.totp,O).length>0;var X=x!=null&&x.filled&k&&B-x.time<30000;if(Y.length>0&&!M&&(X||H)){f.each(K.forms,function(aa,ab){var ae=logmeonce.formIsTotp(ab);var ad=f.grep(ab.elements,function(af){return af.tagName=="INPUT"&&f.inArray(af.type,["text","number","tel"])>=0&&l(af,{cache:K})});if(ae&&ad.length==1&&ad[0].lmoType!="select"&&(x.totp==null||f(ad[0]).is(x.totp))){var Z=ad[0];Z.lmoType="2fa-totp";logmeonce.attachEvent(Z,"lmoEvent",logmeonce.handleDefaultEvent);logmeonce.attachEvent(Z,"lmoFocus",function(af){logmeonce.injectSiteSelectUi(O,Y,this,{action:"totp"})});var ac=f.grep(Y,function(af){return af.id==x.id}).shift();if(ac!=null){x.totp=logmeonce.mappingSelector(Z);logmeonce.loginList("update",x);logmeonce.fillTOTP(Z,ac)}}})}if(O.lmoSSOLoaded!=null&&!W){var T;if((T=this.sites(O,{changepassword:true}))!=null&&((T.changepassword.status.indexOf("navigating")===0&&T.changepassword.passwords!==this.pageChangePasswords(O,T).total)||(T.changepassword.status.indexOf("security-answer")===0&&T.changepassword["security-index"]!==this.pageSecurityCheck(O,T,true).index))){this.pageChangePassword(O,T,true)}return}if(O.lmoSSOMatched==null||O.lmoSSOMatched!=V.length){O.lmoSSOMatched=V.length;this.log("Matched "+V.length+" for SSO")}var y=function(ab,aa){var Z=new Date().getTime();return f.grep(ab,function(ac){return ac.referred!=null&&Z-ac.referred.time<aa}).sort(function(ad,ac){return ac.referred.time-ad.referred.time}).shift()};if(V.length>0){if(F!=null){if(f.grep(V,function(aa,Z){return aa.id==F.id}).length==1){V=[F];z=true;this.log("Referrer detected - "+F.name)}else{var C;if((C=y(this.config.user.sites,5000))!=null){var R=f.grep(V,function(aa,Z){return(C.parent instanceof Array?f.inArray(aa.id,C.parent)>=0:C.parent==aa.id)});if(R.length==1){V=R;z=true;this.log("Referrer detected - "+R[0].name+" - Parent referrer - "+C.name)}}}}else{if(W){z=true;V=f.grep(V,function(Z){return Z.id==x.id})}else{var C;if((C=y(this.config.user.sites,5000))!=null){var J=C;z=(logmeonce.equals(J.login.url,O.referrer,"url")&&J.referred.login==false)||(logmeonce.equals(J.referred.action,O.referrer,"url")&&J.referred.login==false);if(z){V=[C];this.log("Referrer detected - "+C.name+" - "+logmeonce.translate.duration((new Date().getTime()-C.referred.time)/1000)+" ago")}}}}if(V.length>1&&S<=0){logmeonce.log("Invisible forms - skipping SSO");V=[];var w=f.unique(f.map(E,function(Z){return Z.form}));f.each(w,function(Z,aa){var ac=[],ab=0;f.each(E,function(ae,ad){ad.form==aa&&f.each(ad.inputs,function(ag,af){if(af.user.flags&t&&ac.indexOf(af.target)<0){ac.push(af.target);ab+=af.visible?1:0}})});aa.lmoSSORequired={elements:ac,visible:ab}})}}else{var J=null;if(F!=null){J=F;this.log("Referrer detected - "+J.name)}else{var C;if((C=y(this.config.user.sites,10000))!=null&&!C.referred.action&&logmeonce.equals(C.referred.url,O.location.href,"url")){J=C;this.log("Referrer detected - "+J.name+" - "+logmeonce.translate.duration((new Date().getTime()-C.referred.time)/1000)+" ago")}else{if((C=y(this.config.user.sites,30000))!=null&&!C.referred.action&&x!=null&&(C.parent instanceof Array?f.inArray(x.id,C.parent)>=0:C.parent==x.id)){J=C;this.log("Referrer detected - "+J.name+" - "+logmeonce.translate.duration((new Date().getTime()-C.referred.time)/1000)+" ago - Parent Last Login - "+x.name)}}}J!=null&&J.login.action!=null&&this.pageAction(O,J.login.action).done(function(){logmeonce.site("referred",function(){this.referred.action=O.location.href},J)})}var U=(this.config.user.settings.flags&256)==256;var Q=f("iframe[name=ui-logmeonce-add-manually]",O.body).length>0;if(V.length>1&&!Q){O.lmoSSOLoaded=true;U&&this.injectSiteSelectUi(O,V)}else{if(V.length==1&&!Q){O.lmoSSOLoaded=true;var J=V[0];var B=new Date().getTime();var L=O.location.hostname;var v=this.loginGetContinuous(O,J);var D=O.lmoContinuousLogin===true||v.length>0;var P=(this.config.cookieList[L]!=null&&f.grep(this.config.cookieList[L].deleted,function(aa,Z){return B-aa.time<10000}).length>0)||(f.grep(this.config.logoutList,function(Z,aa){return Z.host==L&&B-Z.time<10000}).length>0);while(L.indexOf(".")>0&&!P){P=this.config.cookieList["."+L]!=null&&f.grep(this.config.cookieList["."+L].deleted,function(aa,Z){return B-aa.time<10000}).length>0;L=L.substring(L.indexOf(".")+1)}if(J.testing!=null&&J.testing.event!=null){P=false}if(J===F&&!J.referred.action&&J.login.action!=null){this.pageAction(O,J.login.action).always(function(Z){logmeonce.site("referred",function(){this.referred.action=Z.location.href},J);Z.lmoSSOLoaded=null;logmeonce.pageLoaded(Z,A)});return}this.log("Matched for SSO: matchedIsReferred: "+z+" - passwordManagerTriggered: "+(O.lmoPasswordManager!=null)+"  - continuousLogin:"+D+" - continuousLogout:"+P);if((J.flags&i)&&!z&&(D||P||O.lmoPasswordManager!=null)){if(v.length>0&&D){O.lmoContinuousLogin=true;f.each(v,function(aa,Z){Z.time=0;logmeonce.loginList("update",Z)})}if(S>0&&J.testing!=null&&J.testing.event!=null){this.testing(O,J,{remove:c})}if(S>0){this.injectSiteSelectUi(O,V)}else{O.lmoSSOLoaded=null}}else{if(S>0||z){var T=J.changepassword!=null&&J.changepassword.status=="login"&&(A==null||J.changepassword.tab==A.id);if(J.flags&i||T){this.loginSite(O,{id:J.id,force:z,sso:T||"auto"})}else{U&&this.injectSiteSelectUi(O,V)}}else{O.lmoSSOLoaded=null}}}}var T;if((T=this.sites(O,{changepassword:true}))!=null){this.pageChangePassword(O,T,W)}}},pageRedirected:function(y,A){if(A.indexOf("/")===0){var z=this.tools.parseUri(y);A=z.protocol+"://"+z.host+(z.port.length>0?":"+z.port:"")+A}if(this.config.user!=null){f.each(this.config.user.sites,function(C,B){if(B.referred!=null&&logmeonce.equals(B.referred.url,y,"url")){logmeonce.site("referred",function(){this.referred.url=A},B)}})}if(y.match(/logout/i)||A.match(/logout/i)){var v=this.tools.parseUri(y);var x=this.tools.parseUri(A);var w=[];if(v.protocol.length>0&&v.host.length>0){w.push(v.host);this.log("Logout detected (pageRedirected from): "+y)}if(x.protocol.length>0&&x.host.length>0){w.push(x.host);this.log("Logout detected (pageRedirected to): "+A)}f.each(w,function(C,D){var B=f.grep(logmeonce.config.logoutList,function(E){return E.host==D}).shift();if(B!=null){B.time=new Date().getTime();logmeonce.logoutList("update",B)}else{logmeonce.logoutList("add",{host:D,time:new Date().getTime()})}})}},ssoRefresh:function(v,x){var w,y=typeof x=="number"?x:x.id;if((w=this.sites(v,{id:y}))!=null){if(typeof x==="object"&&x.created==="manual"){setTimeout(function(){v.lmoPasswordManager=v.lmoPasswordManager++||1;logmeonce.injectUi(v,{name:"password-verify",args:[{site:w}]})},5000)}this.site("referred",function(){this.referred=logmeonce.config.referred={url:w.login.url,time:new Date().getTime(),action:false,loaded:true,login:false,logout:false}},w);v.lmoReferrer=w;v.lmoContentLoaded=null;v.lmoSSOLoaded=null}},sso:function(G,F){var w,y=typeof F=="number"?F:F.id;if((w=this.sites(G,{id:y}))!=null){if(F!=null&&F.tab=="self"){F.tab=logmeonce.window(G,"tab")}if(w.login.url==null){logmeonce.urlGoto("/dashboard/edit/"+w.id,F!=null&&F.tab!=null?{tab:F.tab}:{newtab:true});return}var C,z=new RegExp("^app://?((?:[^\\\\\\s]+|\\\\.)+)\\s?([\\s\\S]*)","gmi");if((C=z.exec(w.login.url))!=null){if(logmeonce.plugin==null){return f.Deferred().reject({exception:{message:logmeonce.translate._("Plugin is not installed"),plugin:false}})}if(C[1].length<=0||C[1]==="/"){return f.Deferred().reject({exception:{message:"Application name is empty."}})}var E=[];var x=C[1].replace(/\\\s/g," ");var F=C[2].replace(/(?:\r\n|\r|\n)/g," ");var v=new RegExp("{([^}]*)}","i");while((C=v.exec(F))!=null){var H=f.grep(w.login.inputs,function(L){return L.name==C[1]}).shift();if(H==null&&C[1]==="username"){H=f.grep(w.login.inputs,function(L){return L.flags&e}).shift()}if(H==null&&C[1]==="password"){H=f.grep(w.login.inputs,function(L){return L.flags&k}).shift()}if(H!=null){var J=logmeonce.aesKey(G,false,w);try{F=F.replace(new RegExp(C[0],"g"),logmeonce.tools.decrypt(H.value,J))}catch(D){E.push(C[1]);F=F.replace(new RegExp(C[0],"g"),"$"+C[1]+"$")}}else{E.push(C[1]);F=F.replace(new RegExp(C[0],"g"),"$"+C[1]+"$")}}f.each(E,function(L,M){F=F.replace(new RegExp("\\$"+M+"\\$","g"),"{"+M+"}")});return logmeonce.plugin.processStart(x,F).then(null,function(L){return{exception:L}})}logmeonce.site("referred",function(){this.referred=logmeonce.config.referred={url:w.login.url,time:new Date().getTime(),action:false,loaded:false,login:false,logout:false}},w);if(F.changepassword===true&&w.changepassword!=null){logmeonce.log("Change password for "+w.name+" - login");logmeonce.site("changepassword",function(){this.changepassword.time=new Date().getTime();this.changepassword.navigating=0;this.changepassword.status="login"},w);var A;if((A=typeof w.changepassword.navigate=="string"?w.changepassword.navigate:w.changepassword.navigate[w.changepassword.navigating])!=="login"){logmeonce.site("referred",function(){this.referred.url=A},w)}}if(this.regex.test(w.login.url,this.regex.server(".*sso.*"),"i")){logmeonce.urlGoto(w.login.url,F!=null&&F.tab!=null?{tab:F.tab}:{newtab:true})}else{if(w.logout!=null&&w.logout.url!=null){logmeonce.site("referred",function(){this.referred.url=w.logout.url},w);logmeonce.urlGoto(w.logout.url,F!=null&&F.tab!=null?{tab:F.tab}:{newtab:true})}else{var B=1000;var I=f.grep(this.config.loginList,function(L){return f.grep(L.url instanceof Array?L.url:[L.url],function(M){return new RegExp(w.login.regex,"i").test(M)}).length>0}).sort(function(M,L){return L.time-M.time});logmeonce.site("referred",function(){this.referred.time+=B;this.referred.logout=true},w);if(I.length>0){this.log("SSO for "+w.name+" - Logging out from "+I[0].name);this.siteLogout(I[0],{reload:false})}else{var K=this.tools.parseUri(w.login.url).host;this.log("SSO for "+w.name+" - Clearing cookies for "+K);this.removeCookies({host:K,path:"/"})}if(F!=null&&F.tab!=null){setTimeout(function(){if(w.changepassword!=null&&w.changepassword.status=="login"){logmeonce.site("changepassword",function(){this.changepassword.tab=F.tab.id},w)}logmeonce.urlGoto(w.referred.url,{tab:F.tab})},B)}else{logmeonce.urlGoto(this.includeUrl("/html/sso.html"),{newtab:true})}}}}else{this.log("SSO for "+y+" - site not found");this.loadApp(G,{id:y}).then(function(L){L.id!=null&&logmeonce.sso(G,F)})}},contentLoaded:function(K,x){K.lmoContentLoaded=true;this.config.session.idle=new Date().getTime();this.log("Content Loaded: "+K.location.href);var G=this.window(K);var L=new RegExp(logmeonce.regex.server(".*"),"i");var z=new RegExp(logmeonce.regex.server("([^?]*)?sso.php*"),"i");var F=new RegExp(logmeonce.regex.server("login"),"i");var D=new RegExp("^(http|https)://*","i");if(this.config.user!=null&&this.config.user.sites!=null){var y=null;f.each(this.config.user.sites,function(P,O){if(O.referred!=null&&O.referred.time>(y!=null?y.referred.time:0)){y=O}});if(y!=null&&!y.referred.loaded&&(logmeonce.equals(K.location.href,y.referred.url,"url")||logmeonce.findForm(K,y)!=null)){logmeonce.site("referred",function(){this.referred.loaded=true;this.referred.time=new Date().getTime()},y);if(y.referred.logout===false){logmeonce.site("referred",function(){this.referred.logout=true},y);var N,A=y.login.url;if(y.changepassword!=null&&y.changepassword.status=="login"){if((N=typeof y.changepassword.navigate=="string"?y.changepassword.navigate:y.changepassword.navigate[y.changepassword.navigating])!=="login"){A=N}logmeonce.site("changepassword",function(){this.changepassword.tab=x.id},y)}if(logmeonce.equals(K.location.href,A,"url")==false){logmeonce.urlGoto(A,{tab:x});return}}K.lmoReferrer=y}if(z.test(K.referrer)){var E=this.tools.parseUri(K.referrer);var J=f.grep(this.config.user.sites,function(P,O){return P.id==E.queryKey.id}).shift();if(J!=null){logmeonce.site("referred",function(){this.referred={url:K.location.href,time:new Date().getTime(),action:false,loaded:true}},J);K.lmoReferrer=J}}if(z.test(K.location.href)){var J,E=this.tools.parseUri(K.location.href);if(E.queryKey.id!=null&&E.queryKey.testing!=null&&(J=this.sites(K,{id:E.queryKey.id}))!=null){J.flags|=i;this.testing(K,J,"start")}}}if(F.test(K.location.href)&&f("#login",K).length>0&&G==G.top){this.disable(K);this.injectFormTools(K);return}if(L.test(K.location.href)){this.injectFormTools(K);return}var H=this.config.passwordManager;var w=this.passwordManagerWindow(K,H);if(w&&H.form!=null&&H.time!=null&&((new Date().getTime()-H.time<30000)||H.manual)){this.loadPasswordManager(K)}if(w&&H.form==null&&H.verify!=null){var J=this.sites(K,{id:this.config.passwordManager.verify});J!=null&&this.injectUi(K,{name:"password-verify",args:[{site:J}]})}var v=f.grep(this.config.loginList,function(O,P){return new Date().getTime()-O.time<5000&&(x==null||O.tab==null||x.id==O.tab.id)});if(D.test(K.location.href)&&v.length>0){var I=v.sort(function(P,O){return O.time-P.time})[0];if(f.grep(I.hosts,function(P,O){return P==K.location.hostname}).length<=0){I.hosts.push(K.location.hostname);this.loginList("update",I);this.log("Host Management - Last Login Host list: "+v[0].name+" -> ("+v[0].hosts.length+") "+v[0].hosts.join(", "))}}var B=function(P){var O=f.grep(logmeonce.config.logoutList,function(Q){return Q.host==P}).shift();if(O!=null){O.time=new Date().getTime();logmeonce.logoutList("update",O)}else{logmeonce.logoutList("add",{host:P,time:new Date().getTime()})}};if(D.test(K.location.href)&&(/log(.)?out/i.test(K.location.href)||/sign(.)?out/i.test(K.location.href))){B(K.location.hostname);this.log("Logout detected (contentLoaded): "+K.location.href)}this.attachEvent(K,"click",function(O){f.each(["id","name","value","class","href"],function(R,Q){var P=O.target.getAttribute(Q);if(P!=null&&(/log(.)?out/i.test(P)||/sign(.)?out/i.test(P))){B(K.location.hostname);if(Q=="href"&&D.test(P)){B(logmeonce.tools.parseUri(P).host)}logmeonce.log("Logout detected (click on "+O.target.tagName+" - "+Q+"="+P+")")}})});if(K.lmoContentLoaded!=null){K.lmoContentLoaded=logmeonce.getContentHash(K);this.injectFormTools(K);this.pageLoaded(K,x);K.lmoLastHref=K.location.href;K.lmoContentInterval=G.setInterval(function(O){try{var P=logmeonce.findElements(O,"form");if(f.grep(P,function(T){return T.lmoFormSubmitting!=null&&new Date().getTime()-T.lmoFormSubmitting<1000}).length>0){return}var R=logmeonce.getContentHash(O);var S=f.grep(P,function(W){var T=W.ownerDocument;var Y=false;var U=[];var V=[];var X=l(W,{coverage:false});if(W.lmoVisible!=X){W.lmoVisible=X;Y=true}if(W.lmoSSORequired!=null&&f.grep(W.lmoSSORequired.elements,function(Z){return l(Z)}).length!==W.lmoSSORequired.visible){delete W.lmoSSORequired;Y=true}if(W.getAttribute("lmoId")!=null){f.each(W.elements,function(aa,Z){if(typeof Z.lmoFilled!="undefined"&&Z.value.length<=0){U.push(Z.lmoFilled==true);delete Z.lmoFilled;logmeonce.inputUnmark(Z);logmeonce.log("Reseting Input - Name: "+Z.name+" Type: "+Z.type)}if(typeof Z.lmoFilled!="undefined"){V.push(Z.lmoFilled==true)}})}if(U.length>0&&V.length<=0){logmeonce.dispatchEvent(W,"lmoFormReseted");U=f.grep(U,function(Z){return Z==true});V=f.grep(V,function(Z){return Z==true});if(T.lmoSSOLoaded!=null&&W.lmoFormSubmitted==null&&U.length>0&&V.length<=0){T.lmoSSOLoaded=null;Y=true}}return Y}).length>0;if(O.lmoContentLoaded!=R||O.lmoLastHref!=O.location.href||S){O.lmoContentLoaded=R;if(O.lmoLastHref!=O.location.href){O.lmoLastHref=O.location.href;O.lmoSSOLoaded=null}logmeonce.dispatchUiEvent(O,"lmoContentLoaded");logmeonce.injectFormTools(O);logmeonce.pageLoaded(O,x)}}catch(Q){G.clearInterval(O.lmoContentInterval);logmeonce.log("Page Loaded: "+Q+": "+O.location.href)}},1000,K);if(G.MutationObserver){var C=K;var M=new MutationObserver(function(O){O.forEach(function(P){if(P.addedNodes.length>0&&f.grep(P.addedNodes,function(Q){return f(Q).is("input[type!=hidden][type!=file][type!=reset][type!=search], select, button")}).length>0){C.lmoContentLoaded=null}})});M.observe(K,{childList:true,subtree:true})}}},ajaxRequest:function(D,w,v,E,y){var A={};try{A=JSON.parse(E)}catch(C){f.each(E.split("&"),function(J,K){var I=K.split("=");if(I.length==2){var H=decodeURIComponent(I[0]);var L=decodeURIComponent(I[1]);var G=0;while(A[H]!=null&&A[H+"["+G+"]"]!=null){G++}if(A[H]!=null||G>0){A[H+"["+G+"]"]=L}else{A[H]=L}}else{A.fake_name=K}})}var F=0;var x=logmeonce.regex.is(w,"password-strength-meter");z(A);function z(H){for(var G in H){if(typeof H[G]=="object"){z(H[G])}else{if(logmeonce.regex.test(""+H[G],"login|authenticate|authorize","i")){F++}}}}function B(I,H){for(var G in I){if((typeof I[G]=="object"&&B(I[G],H))||(typeof I[G]!="object"&&H(G,""+I[G]))){return true}}}setTimeout(function(){var G=D.activeElement;if(x&&G!=null&&G.tagName=="INPUT"&&G.type=="password"&&B(A,function(H,I){return H==G.name||I.indexOf(G.value)>=0})){return}f!=null&&f.each(logmeonce.findElements(D,"form"),function(H,I){if(f(I).attr("lmoId")!=null&&f.grep(I.elements,function(J){return f.inArray(J.tagName,["INPUT","BUTTON"])>=0&&J.type=="submit"&&l(J)}).length>0){return}if(x&&f.grep(I.elements,function(J){return J.tagName=="INPUT"&&J.type=="password"&&J.value.length>0&&J.lmoBlurred!=null&&new Date().getTime()-J.lmoBlurred<500}).length>0){return}f.each(I.elements,function(K,J){if(J.tagName=="INPUT"&&J.type=="password"&&!(x&&G==J)&&J.value.length>0&&B(A,function(L,M){return L==J.name||M.indexOf(J.value)>=0})){logmeonce.log("Form submitted via AJAX Request: "+w);logmeonce.formSubmited(I);return false}if(J.tagName=="INPUT"&&f.inArray(J.type,["text","email"])>=0&&J.value.length>0&&F>=1&&B(A,function(L,M){return J.value==M})){logmeonce.log("Form submitted via AJAX Request: "+w);logmeonce.formSubmited(I);return false}})})},100)},cookieChanged:function(x,A){var y=this.tools.parseUri(this.server);var C=["s_cc","s_vi","s_sq"];var v=["__utma","__utmb","__utmc","__utmz"];if((x.host.indexOf(".")===0?y.host.toLowerCase().indexOf(x.host.substring(1))!=-1:(y.host.toLowerCase()==x.host||y.host.toLowerCase()=="."+x.host))||f.inArray(x.name,C)>=0||f.inArray(x.name,v)>=0){return}if(A=="added"||A=="changed"){var D=this.tools.parseHost({host:this.tools.trim(x.host,".")});var w=D.indexOf(".")>0?D.substring(0,D.indexOf(".")):D;if(x.path==null||x.path.length<=0){x.path="/"}f.each(this.config.loginList,function(F,E){if(new Date().getTime()-E.time<5000&&f.grep(E.hosts,function(H,G){return H.indexOf(w)>=0}).length>0&&f.grep(E.cookies,function(H,G){return H.host.indexOf(x.host)>=0&&H.path==x.path}).length<=0){E.cookies.push({host:x.host,path:x.path});logmeonce.loginList("update",E);logmeonce.log("Cookie Management - Login Cookie list: "+E.name+" -> "+JSON.stringify(E.cookies))}})}if(A=="deleted"&&!(this.config.referred!=null&&this.config.referred.time>new Date().getTime())){if(this.config.cookieList[x.host]==null){this.config.cookieList[x.host]={deleted:[]}}var z=f.grep(this.config.cookieList[x.host].deleted,function(F,E){return F.name==x.name});if(z.length>0){z[0].time=new Date().getTime()}else{this.config.cookieList[x.host].deleted.push({name:x.name,time:new Date().getTime()})}var B="";f.each(this.config.cookieList[x.host].deleted,function(E,F){B+=F.name+", "});this.log("Cookie Management - Cookie deleted list: "+x.host+" -> "+B)}}}})();